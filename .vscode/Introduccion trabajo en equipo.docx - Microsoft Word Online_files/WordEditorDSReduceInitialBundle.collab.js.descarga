'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1405:function(I,J,d){d.r(J);d.d(J,"RtcUtils",function(){return l});I=d(0);var m=d(8),f=d(28),a=d(1593);class l{static RLb(w,z=a.a.OVb){let x;try{x=f.c(w)}catch(u){throw w=String.format("Failed to JSON-serialize payload : {0}",u),m.ULS.sendTraceTag(508396173,500,10,w),Error.argument("payload",w);}if(x.length>z)throw w=String.format("Payload exceeds maximum length: {0} > {1}.",x.length,z),m.ULS.sendTraceTag(508396171,
500,10,w),Error.argument("payload",w);return x}static deserialize(w,z,x){if(!w)return null;if(Object.getType(w)!==String){var u=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",z,Object.getType(w).getName(),x);m.ULS.sendTraceTag(508396170,500,10,u);return null}u=null;try{u=f.a(w)}catch(v){w=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",z,v,x),m.ULS.sendTraceTag(508396168,
500,10,w)}return u}static Jma(w){if(!w)return"";if("string"===typeof w)return w.toString();try{return f.c(w)}catch(z){return w.toString()}}static KCf(w){let z,x,u;z=0;u=x=null;if(!w)return{L6c:z,M6c:x,zk:u};try{const v=w.source;v&&Object.getType(v)===String&&(u=v);const F=w.context;F&&(w=F,z=w.status?w.status:0,x=w.statusText?w.statusText:null)}catch(v){}return{L6c:z,M6c:x,zk:u}}}Object(I.a)(l,"RtcUtils",null,[])},1449:function(I,J,d){d.r(J);I=d(0);var m=d(8),f=d(108),a=d(80),l;(function(u){u[u.SendNotification=
0]="SendNotification";u[u.SendPersistentState=1]="SendPersistentState";u[u.FindSession=2]="FindSession";u[u.Last=3]="Last"})(l||(l={}));Object(I.b)("ApiType",l);var w;(function(u){u[u.AttemptCount=0]="AttemptCount";u[u.SuccessCount=1]="SuccessCount";u[u.DropCount=2]="DropCount";u[u.FailedCount=3]="FailedCount";u[u.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";u[u.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";u[u.ThrottledCount=6]="ThrottledCount";u[u.Last=7]="Last"})(w||(w=
{}));Object(I.b)("EventCountType",w);var z=d(1592);d.d(J,"FrequentLoggingMetrics",function(){return x});class x{constructor(u){this.EWc=this.U0c=null;this.ddd=this.G1c=0;this.Rk=null;this.vLc=this.SFb=0;this.Gf=u;this.DVf();this.GDb=this.XHc=this.bGb=!1;this.C3a=0}get yCf(){return this.GDb}tFg(u){this.vLc=u;window.setInterval(Object(f.a)(this,this.oVb,"logMetricsBatchAndReset"),u);this.SFb=(new Date).getTime()}Ws(u,v){this.VBg(u)&&!this.XHc||this.yCf||!window.navigator.onLine||this.Gf.yta||(this.Rk[u][v]++,
this.bGb=!0)}DVf(){this.Rk=Array(3);for(let u=0;3>u;u++){this.Rk[u]=Array(7);for(let v=0;7>v;v++)this.Rk[u][v]=0}}ymf(){const u={};for(let v=0;3>v;v++)for(let F=0;7>F;F++)this.e2f(v,F)&&(u[l[v]+w[F]]=this.Rk[v][F]);u.FSDomain=this.U0c;u.ConnectionDomain=this.EWc;u.FSRetryInterval=this.G1c;u.MaxPayloadSize=this.ddd;u.LogNumber=this.C3a;1===this.C3a&&(u.FSLatencies=z.a.instance.TJf(),u.ConLatencies=z.a.instance.oIf());return u}e2f(u,v){return 2===u&&3!==v&&0!==v?!1:!0}VBg(u){return 2===u?!1:!0}oVb(){if(this.bGb){this.C3a++;
if((new Date).getTime()-this.SFb<5E3+this.vLc){var u=a.a.toJSON(this.ymf());m.ULS.sendTraceTag(50644352,500,15,u)}this.SFb=(new Date).getTime();for(u=0;3>u;u++)for(let v=0;7>v;v++)this.Rk[u][v]=0;this.bGb=!1}}n8f(){this.XHc=!0}static get instance(){return x._instance}static create(u){x.instance||(x._instance=new x(u));return x.instance}}x._instance=null;Object(I.a)(x,"FrequentLoggingMetrics",null,[1815])},1592:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m{constructor(){this.KQc=!1;
this.bHa=null;this.MFc=0;this.PDb=this.lYc(6);this.P1a=this.lYc(6);this.nda=this.qpa=0;this.eq=()=>new Date}get sGg(){return this.KQc}lYc(f){f=Array(f);for(let a=0;a<f.length;a++)f[a]=0;return f}TJf(){return this.PDb.toString()}oIf(){return this.P1a.toString()}uFg(){this.bHa=this.eq()}xNa(f,a,l=!1){this.sGg||(l&&(this.KQc=!0),l=this.eq(),0===f&&5<this.qpa||1===f&&5<this.nda||(this.MFc<f?(1===this.qpa%2&&(this.PDb[this.qpa]=-1,this.qpa++),this.MFc=f,1===a&&(this.P1a[this.nda]=-1,this.nda++),this.P1a[this.nda]=
this.n1b(l),this.nda++):0===f?(this.PDb[this.qpa]=this.n1b(l),this.qpa++):(this.P1a[this.nda]=this.n1b(l),this.nda++)))}n1b(f){const a=f.getTime()-this.bHa.getTime();this.bHa=f;return a}static get instance(){m._instance||(m._instance=new m);return m._instance}static set instance(f){m._instance=f}}m._instance=null;Object(I.a)(m,"LatencyMetrics",null,[])},1593:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m{}m.edd=31E3;m.OVb=8E3;Object(I.a)(m,"RealtimeChannelStaticConstants",null,[])},
1624:function(I,J,d){d.r(J);I=d(0);var m=d(8),f=d(108),a=d(334),l=d(880),w=d(94),z=d(2),x=d(1909),u=d(44),v=d(1592);class F{constructor(va,Pa){this.data=va;this.timeStamp=Pa}}Object(I.a)(F,"PresenceData",null,[]);class y{constructor(va){this.i6=!1;this.yHa=0;this.wCb=!1;this.U6f=()=>{m.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Hk)};this.setTimeout=y.zNb;this.clearTimeout=y.xNb;this.g7f=this.U6f;this.Hk=va}Reg(){this.i6||(this.yHa=this.setTimeout(()=>
{this.i6=!1;this.tcd()},8E3),this.i6=!0,this.wCb=!1)}cfg(){this.$T()}uhg(){this.tcd()}tcd(){this.$T();this.wCb||(this.wCb=!0,this.g7f())}$T(){this.i6&&this.clearTimeout(this.yHa);this.yHa=0;this.i6=!1}static zNb(va,Pa){return window.setTimeout(va,Pa)}static xNb(va){window.clearTimeout(va)}}Object(I.a)(y,"ConnectedUsageKpiLogger",null,[1839]);class G{constructor(){this.Mjd=this.YYb;this.Pjd=this.aZb;this.Ojd=this.$Yb;this.Rjd=this.cZb;this.Qjd=this.bZb;this.hZb=this.iZb;this.sdb=this.fZb;this.Zga=
this.dZb;this.Xua=this.eZb;this.Njd=this.ZYb;this.HCa=this.iWb;this.CYa=this.jWb}YYb(){}aZb(){}$Yb(){}cZb(){}bZb(){}fZb(){}eZb(){}dZb(){}iZb(){}ZYb(){}iWb(){}jWb(){}}Object(I.a)(G,"NoopRealtimeChannelMetrics",null,[1825,264]);class C{}C.sPa="presenceUpdated";C.updateNotification="updateNotification";C.mhd="persistentStateCleared";C.updatePersistentState="persistentStateUpdated";Object(I.a)(C,"RtcClientMethodNames",null,[]);class H{}H.YTf="realtimeChannelHub";H.sPa="UpdatePresence";H.tC="SendUpdateNotification";
H.MPb="GetCompletePersistentStateWithMetadata";H.updatePersistentState="UpdatePersistentState";H.o9="UpdateClientInfo";Object(I.a)(H,"RtcHubMethodNames",null,[]);class K{constructor(va){this.Yp=va}Drg(va){this.Yp.on(C.sPa,va)}Krg(va){this.Yp.on(C.updateNotification,va)}Crg(va){this.Yp.on(C.updatePersistentState,va)}Brg(va){this.Yp.on(C.mhd,va)}sLg(va){this.Yp.off(C.sPa,va)}vLg(va){this.Yp.off(C.updateNotification,va)}rLg(va){this.Yp.off(C.updatePersistentState,va)}qLg(va){this.Yp.off(C.mhd,va)}sPa(va){return this.Yp.invoke(H.sPa,
va)}o9(va){return this.Yp.invoke(H.o9,va)}tC(va,Pa){return this.Yp.invoke(H.tC,va,Pa)}MPb(va){return this.Yp.invoke(H.MPb,va)}updatePersistentState(va,Pa){return this.Yp.invoke(H.updatePersistentState,va,Pa)}}Object(I.a)(K,"RealtimeChannelProxy",null,[1835,1836,1837]);var R=d(1593);class E{constructor(){this.RBb=this.aEc=!1;this.QBb=0;this.kCb=this.uIb=this.tIb=this.HBb=!1;this.QDb=0;this.hPc=!1;this.gPc=this.fPc=0;this.UHb=!1;this.YHb=this.WHb=this.ZHb=this.VHb=0;this.XHb=!1}get lkf(){return this.RBb}get kkf(){return this.QBb}get oRh(){return this.HBb}get pCg(){return this.tIb}get qCg(){return this.uIb}get wpf(){return this.kCb}get J8a(){return this.QDb}get ywg(){return this.hPc}get tmd(){return this.fPc}get xwg(){return this.gPc}get uwg(){return this.UHb}get vwg(){return this.VHb}get zmd(){return this.ZHb}get vmd(){return this.WHb}get xmd(){return this.YHb}get wmd(){return this.XHb}static createInstance(va){return va?
Object.assign(new E,{aEc:va.$("AwayStatusManagerIsEnabled"),RBb:va.$("AwayStatusOneMinuteTimeoutIsEnabled"),QBb:va.fc("AwayCoauthorThresholdMs",9E5),HBb:va.$("RtcAllowCrossDomainAccessEnabled"),tIb:va.$("ShouldLogOnContentNotification"),uIb:va.$("ShouldLogOnHostSubscriptionNotification"),kCb:va.$("RtcClientMetricsEnabled"),QDb:va.fc("RtcFindSessionRequestTimeoutInMS",6E4),hPc:va.$("RtcJsClientFrequentlyLogsMetrics"),fPc:va.fc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),gPc:va.fc("RtcJsClientFrequentMetricsLogIntervalInMS",
3E5),UHb:va.$("RtcClientMessageTelemetryEnabled"),VHb:va.fc("RtcClientMessageTelemetrySampleSize",5),ZHb:va.fc("RtcSendTelemetryMessageIntervalInMS",3E5),WHb:va.fc("RtcLogClientMessageMetricsTimeOutInMs",2E4),YHb:va.fc("RtcMaxPayloadSizeInCharactersOverride",R.a.OVb),XHb:va.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new E,{aEc:!1,RBb:!1,QBb:9E5,HBb:!1,tIb:!1,uIb:!0,kCb:!1,QDb:9E4,UHb:!1,VHb:5,ZHb:3E5,WHb:2E4,YHb:R.a.OVb,XHb:!1})}}Object(I.a)(E,
"RealtimeChannelSettings",null,[1838]);var L=d(1776),O=d(82),V=d(154);class Z{constructor(va){this.jea=null;this.uV=0;this.kfa=!1;this.ze=va;this.ze.a_(Object(f.a)(this,this.mK,"onConnectionStateChanged"))}mK(va,Pa){this.uV=Pa.newState}Vfd(){m.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.ze.ndb()}mVf(va){this.jea.init(va)}}Object(I.a)(Z,"ARtcMessageHandler",null,[]);var W=d(276),P=d(1722),S=d(80);class aa{constructor(va,Pa=""){this.iIb=va;this.uZ=
Pa}send(){return this.iIb()}get messageId(){return this.uZ}}Object(I.a)(aa,"MessageHandler",null,[1849]);var Y=d(1637);class X extends Sys.EventArgs{constructor(va,Pa,Ta,kb){super();this.LZb=va;this.reconnectDelay=Pa;this.reason=Ta;this.E_b=kb}}Object(I.a)(X,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var ca=d(1718);class fa{constructor(){this.KIb=this.ki=null}get Hi(){return this.ki?this.KIb?this.KIb.getTime()-this.ki.getTime():(new Date).getTime()-this.ki.getTime():0}start(){this.ki=new Date}stop(){this.KIb=
new Date}}Object(I.a)(fa,"SimpleStopwatch",null,[]);var ja=d(1723),ra=d(1911),ya=d(542),Ha=d(600),Wa=d(601);class Ma extends Z{constructor(va,Pa,Ta,kb,gb,tb,hb,Xa,$a,La){super(hb);this.Yp=null;this.qLc=this.rLc=!1;this.uZ=0;this.bHb=new V.a;this.DZe=Ma.DIf();this.NGb=z.AFrameworkApplication.J.jb("OwningFeatureCrewForRtcNotificationKpis");this.Ne=va;this.AMc=this.zMc=0;this.jea=Pa;this.jea.f6a(Object(f.a)(this,this.Vfd,"onTooManyUndeliveredMessages"));this._clientId=Ta;this.v5e=gb;this.ze.Fgf(Object(f.a)(this,
this.Mfd,"onRefreshProxyRequired"));this.ze.Dgf(Object(f.a)(this,this.Lfd,"onRefreshAllPersistentStateRequest"));this.ze.Jgf(Object(f.a)(this,this.tC,"sendUpdateNotification"));this.ze.fgf(Object(f.a)(this,this.ufd,"onInternalPresenceUpdated"));this.ze.ggf(Object(f.a)(this,this.vfd,"onInternalUpdateNotificationReceived"));this.ze.egf(Object(f.a)(this,this.tfd,"onInternalPersistentStateUpdated"));this.ze.dgf(Object(f.a)(this,this.sfd,"onInternalPersistentStateCleared"));this.ze.Igf(Object(f.a)(this,
this.cEa,"sendPersistentState"));this.ze.Ogf(Object(f.a)(this,this.o9,"updateClientInfo"));this.Zd=tb;this.Hk=kb;this.Rk=Xa;this.dw=$a;this.FGa=La;this.qia=Object(O.a)(String,z.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Mfd(va,Pa){this.Yp=this.v5e(Pa.hubConnection);this.jea.reset();this.Yp.Drg(Object(f.a)(this,this.gV,"onPresenceUpdated"));this.Yp.Crg(Object(f.a)(this,this.Iga,"onPersistentStateUpdated"));this.Yp.Brg(Object(f.a)(this,this.TYa,"onPersistentStateCleared"));this.Yp.Krg(Object(f.a)(this,
this.nS,"onUpdateNotificationReceived"))}mK(va,Pa){this.uV=Pa.newState;2===Pa.newState&&this.eyg()}eyg(){for(const va of this.bHb)this.tC(null,new ca.a(va.key,va.value,!1,new a.a));this.bHb=new V.a}Lfd(va,Pa){Pa.VLb();for(va=0;3>va;++va)this.Zxg(va,Pa)}Zxg(va,Pa){try{this.Yp.MPb(va).done(Ta=>{Pa.kwa(Pa.tUa,"GetCompletePresenceSuccess")&&(Pa.lrf.uhg(),m.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}] of type [{1}]",this.Hk,va),this.ze.$pg(),this.Ngg(va,Ta),
this.ze.Npg(Ta),Pa.i0c.mb(va)&&this.ze.zjd(va,Pa.i0c.K(va),new a.a))}).fail(Ta=>{const {RtcUtils:kb}=d(1405);Pa.kwa(Pa.tUa,"GetCompletePresenceFail")&&(m.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}] of type [{2}]",kb.Jma(Ta),this.Hk,va),this.ze.ndb())}).always(()=>{Pa.rz&&Pa.rz.stop()})}catch(Ta){m.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",
Pa.tUa,Ta.message)}}cEa(va,Pa){var {RtcUtils:Ta}=d(1405);va=Pa.WI;let kb;const gb=Pa.Zna;this.dw.Ws(1,0);try{kb=Ta.RLb(va,this.FGa)}catch(hb){this.dw.Ws(1,3);m.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",hb.message);gb.setException(hb);return}Ta=new w.a;Ta.W(this._clientId,Object.assign(new P.a,{Presence:va,TimeStamp:(new Date).getTime()}));this.ze.Bjd(Pa.type,Ta);if(2!==this.uV)this.Rk.Zga(),this.dw.Ws(1,2),gb.hg(null);else{var tb=
this.uZ.toString();++this.uZ;va=new aa(()=>this.fyg(Pa.type,kb,tb),tb);va=this.Ard(0,Pa.type).add(va);va.xcb(hb=>{2===hb&&(this.dw.Ws(1,6),this.qLc||2!==Pa.type||m.ULS.sendTraceTag(508651234,500,15,"First persistent state update of type LiveMeeting for [{0}] was throttled",this.Hk));gb.hg(null)});va.wcb(()=>{})}}fyg(va,Pa,Ta){let kb=null;const gb=new fa,tb=new Y.a;m.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}] of type [{1}]",this.Hk,va);if(2!==this.uV)return this.Rk.Zga(),this.dw.Ws(1,
2),m.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}] of type [{1}]",this.Hk,va),tb.GVb(),tb;this.Zd&&20>this.zMc&&(kb=this.Zd.Xf("WebServiceCall","Send Presence Message"),this.zMc++);gb.start();tb.kMa(1);try{this.Yp.updatePersistentState(va,Pa).done(()=>{this.Rk.sdb();this.dw.Ws(1,1);m.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}] of type [{2}]",Ta,this.Hk,va);tb.Z7(1);gb&&(gb.stop(),gb.Hi>this.Ne.tmd?this.dw.Ws(1,
4):this.dw.Ws(1,5))}).fail(hb=>{const {RtcUtils:Xa}=d(1405);this.kfa||(this.Rk.Zga(),this.dw.Ws(1,3),this.qLc||2!==va||m.ULS.sendTraceTag(508651233,500,15,"First persistent state update of type LiveMeeting for [{0}] failed",this.Hk),m.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Ta,Xa.Jma(hb),this.Hk));tb.Z7(2)}).always(()=>{kb&&kb.stop()})}catch(hb){m.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",
hb.message),this.dw.Ws(1,3),this.qLc||2!==va||m.ULS.sendTraceTag(508651232,500,15,"First persistent state update of type LiveMeeting for [{0}] hit an exception",this.Hk),tb.Z7(2)}return tb}o9(va,Pa){({RtcUtils:va}=d(1405));const Ta=Pa.t3h,kb=Pa.Zna;let gb;try{gb=va.RLb(Ta,this.FGa)}catch(tb){m.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",tb.message);kb.setException(tb);return}try{this.Yp.o9(gb).done(()=>{m.ULS.sendTraceTag(544319E3,
500,50,"Successfully delivered clientInfo.")}).fail(tb=>{const {RtcUtils:hb}=d(1405);this.kfa||m.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",hb.Jma(tb));kb.hg(null)})}catch(tb){m.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",tb.message),kb.hg(null)}}tC(va,Pa){({RtcUtils:va}=d(1405));const Ta=Pa.type,kb=Pa.pA,gb=Pa.Twf,tb=Pa.Zna;let hb;this.dw.Ws(0,0);try{hb=va.RLb(kb,this.FGa)}catch($a){this.dw.Ws(0,3);
m.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",$a.message);tb.setException($a);return}if(2!==this.uV)gb?this.bHb.W(Ta,kb):(this.Rk.Zga(),this.dw.Ws(0,2)),tb.hg(null);else{var Xa=this.uZ.toString();++this.uZ;Pa=new aa(()=>this.xyg(Ta,hb,Xa),Xa);Pa=this.Ard(1,Ta).add(Pa);Pa.xcb($a=>{2===$a&&this.dw.Ws(0,6);tb.hg(null)});Pa.wcb(()=>{})}}xyg(va,Pa,Ta){let kb=null;const gb=new fa,tb=new Y.a;m.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}] of type [{1}]",
this.Hk,va);if(2!==this.uV)return this.Rk.Zga(),this.dw.Ws(0,2),m.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.Hk),tb.GVb(),tb;this.Zd&&3===va&&20>this.AMc&&(kb=this.Zd.Xf("WebServiceCall","Send WetContent Update"),this.AMc++);gb.start();tb.kMa(1);this.Yp.tC(va,Pa).done(()=>{this.Rk.sdb();this.dw.Ws(0,1);m.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}] of type [{2}]",Ta,this.Hk,va);tb.Z7(1);gb&&
(gb.stop(),gb.Hi>this.Ne.tmd?this.dw.Ws(0,4):this.dw.Ws(0,5))}).fail(hb=>{const {RtcUtils:Xa}=d(1405);this.kfa||(this.Rk.Zga(),this.dw.Ws(0,3),m.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Ta,Xa.Jma(hb),this.Hk));tb.Z7(2)}).always(()=>{kb&&kb.stop()});return tb}IY(){this.Yp.sLg(Object(f.a)(this,this.gV,"onPresenceUpdated"));this.Yp.rLg(Object(f.a)(this,this.Iga,"onPersistentStateUpdated"));this.Yp.qLg(Object(f.a)(this,this.TYa,
"onPersistentStateCleared"));this.Yp.vLg(Object(f.a)(this,this.nS,"onUpdateNotificationReceived"))}mxf(){this.Rug();this.ze.KDa(Object(f.a)(this,this.mK,"onConnectionStateChanged"));this.ze.otg(Object(f.a)(this,this.Mfd,"onRefreshProxyRequired"));this.ze.mtg(Object(f.a)(this,this.Lfd,"onRefreshAllPersistentStateRequest"));this.ze.stg(Object(f.a)(this,this.tC,"sendUpdateNotification"));this.ze.btg(Object(f.a)(this,this.ufd,"onInternalPresenceUpdated"));this.ze.ctg(Object(f.a)(this,this.vfd,"onInternalUpdateNotificationReceived"));
this.ze.atg(Object(f.a)(this,this.tfd,"onInternalPersistentStateUpdated"));this.ze.$sg(Object(f.a)(this,this.sfd,"onInternalPersistentStateCleared"));this.ze.rtg(Object(f.a)(this,this.cEa,"sendPersistentState"));this.ze.utg(Object(f.a)(this,this.o9,"updateClientInfo"))}ufd(va,Pa){this.gV(Pa.hia,Pa.xZc)}gV(va){this.Rk.Xua();this.Iga(0,va)}tfd(va,Pa){this.Iga(Pa.type,Pa.hia)}Ngg(va,Pa){const Ta={};for(const kb in Pa)Ta[kb]=Pa[kb].Presence;this.Gfd(va,Ta,Pa)}Iga(va,Pa){this.Rk.Xua();this.Gfd(va,Pa)}Gfd(va,
Pa,Ta=null){var {RtcUtils:kb}=d(1405);if(m.ULS.x4(500,100))for(var gb in Pa);delete Pa[this._clientId];if(!S.a.isEmpty(Pa)){for(var tb in Pa)gb=tb,Pa[gb]=kb.deserialize(Pa[tb],"Presence",gb,!1,this.FGa);kb=new w.a;tb=(new Date).getTime();for(const hb in Pa){gb=Pa[hb];const Xa=hb;let $a;Ta?($a=Ta[Xa],$a.Presence=gb):$a=Object.assign(new P.a,{Presence:gb,TimeStamp:tb});kb.W(Xa,$a)}this.ze.Bjd(va,kb);switch(va){case 0:this.rLc||(m.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",
this.Hk),this.rLc=!0,z.AFrameworkApplication.fh&&z.AFrameworkApplication.fh.Bcj());this.ze.vjd(Pa,[]);break;case 2:this.qLc||(m.ULS.sendTraceTag(508867081,500,50,"Raising first live meeting update notification for [{0}]",this.Hk),this.qLc=!0);this.ze.cte(va,Pa);break;default:this.ze.cte(va,Pa)}}}sfd(va,Pa){this.TYa(Pa.Hnb)}TYa(va){this.Rk.Xua();if(m.ULS.x4(500,100))for(let Pa=0;Pa<va.length;++Pa);va.length&&(this.ze.cqg(va),this.ze.Vpg(va),this.ze.vjd({},va))}vfd(va,Pa){this.nS(Pa.type,Pa.pA)}nS(va,
Pa=null){this.Ne.pCg&&0===va&&m.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===va&&this.NGb&&0<this.NGb.length){var Ta=Object.assign(new ya.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.NGb,vetoPillar:"RealTimeCoauth"});(Ta=W.a.getInstance(Ta))&&Ta.logKpiUsage(this.DZe)}this.Ne.qCg&&13===va&&m.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",
Pa||"<none>"));this.Rk.Xua();5===va?(Pa=(va=this.bkg(Pa))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",va.reason,va.reconnectDelay):"Received client reconnection request from the server without params.",m.ULS.sendTraceTag(18637071,500,50,Pa),this.ze.ndb(va)):(Pa=d(1405).RtcUtils.deserialize(Pa,String.format("UpdateNotification-{0}",ra.a[va]),null,!1,this.FGa),this.ze.bqg(va,Pa))}bkg(va){try{if(!va||""===va)return null;const Pa=JSON.parse(va);
return new X(Pa[ja.a.n_b],Pa[ja.a.twg],Pa[ja.a.wwg],Pa[ja.a.E_b])}catch(Pa){return m.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",Pa.message),null}}Ard(va,Pa){return this.jea.iPf(this.jPf(va,Pa))}jPf(va,Pa){return va+","+Pa}Rug(){this.jea.reset();this.jea.Xkd(Object(f.a)(this,this.Vfd,"onTooManyUndeliveredMessages"))}static DIf(){var va=new Map;va.set("SkipAria","True");va=Object.assign(new Ha.a,{extendedProperties:va});return Object.assign(new Wa.a,{kpiName:"ContentUpdateNotificationReceived",
kpiType:0,optionalProperties:va,blockFutureEmissionDurationInMs:3E5})}}Object(I.a)(Ma,"RtcMessageHandler",Z,[]);class ua{XXc(va,Pa=""){const {MaxOutstandingThrottler:Ta}=d(1719);return Ta.createInstance(va,Pa)}Stf(va,Pa=""){const {MaxRateThrottler:Ta}=d(1721);return Ta.createInstance(va,Pa)}}Object(I.a)(ua,"ThrottlerFactory",null,[1827]);var Ka=d(86),za=d(1724);class Fa{constructor(va){this.Ne=null;this.vi=!1;this.sa=new Ka.a;this.YFb=new w.a;this.XFb=new w.a;this.eJb=va;this.wpa=this.eJb.XXc(Pa=>
Pa.send(),"GlobalMaxOustandingThrottler");this.wpa.f6a(()=>{this.sa.raiseEvent("TMUDM")})}init(va){this.vi||(this.Ne=va,this.wpa.init(this.Ne.g9,this.Ne.mQf),this.vi=!0)}iPf(va){var {MaxRateThrottler:Pa}=d(1721),{MaxOutstandingThrottler:Ta}=d(1719);this.vi||this.init(new za.a(Pa.OYc,Ta.SYc,Ta.QYc,Fa.D8f));({value:Pa}=this.YFb.Ec(va)).returnValue||(({value:Pa}=this.XFb.Ec(va)).returnValue||(Pa="MaxOutstandingThrottler-"+va,Pa=this.eJb.XXc(Object(f.a)(this.wpa,this.wpa.add,"add"),Pa),Pa.init(this.Ne.g9,
this.Ne.C8f),Pa.f6a(()=>{this.sa.raiseEvent("TMUDM")}),this.XFb.add(va,Pa)),Ta="MaxRateThrottler-"+va,Pa=this.eJb.Stf(Object(f.a)(Pa,Pa.add,"add"),Ta),Pa.init(this.Ne.k9f),this.YFb.add(va,Pa));return Pa}reset(){for(const va of this.YFb)va.value.gZb();for(const va of this.XFb)va.value.gZb(),va.value.reset();this.wpa.gZb();this.wpa.reset()}f6a(va){this.sa.addHandler("TMUDM",va)}Xkd(va){this.sa.removeHandler("TMUDM",va)}}Fa.D8f=1E3;Object(I.a)(Fa,"ThrottlerManager",null,[1826]);var ea=d(1912);const la=
(va,Pa,Ta,kb,gb,tb,hb,Xa,$a=null,La=null,bb=null,Gb=null)=>{const qb=E.createInstance(z.AFrameworkApplication.J),Sa=z.AFrameworkApplication.buildVersion?z.AFrameworkApplication.buildVersion:"1.0",cb=Na(va,Pa,hb,Sa),pb=qb.wpf?d(1910).RealtimeChannelMetrics.createInstance(cb):new G;var vb=d(1449).FrequentLoggingMetrics.create(gb);qb.ywg&&vb.tFg(qb.xwg);var xb="";xb=$a&&""!==$a?$a:"/rtc2/";vb.U0c=u.a.yU(xb);const Bb=xb+"signalr";$a=xb+"findsession";const jc=H.YTf;xb=new ua;bb=bb||L.a.getInstance();m.ULS.shipAssertTag(508396228,
500,qb.xmd<=R.a.edd,"Client attempting to override max payload size beyond absolute limit");const xc=Math.min(qb.xmd,R.a.edd);vb.ddd=xc;vb=new Ma(qb,new Fa(xb),va,cb,Qc=>new K(Qc.createHubProxy(jc)),Xa,bb,pb,vb,xc);La||(La=d(2004).FindSessionStrategy.createInstance(Pa,gb,$a,Xa,Sa,hb,va,cb,bb,tb,kb,Gb));La.J8a=qb.J8a;Pa=new y(cb);Ta=Ta?Ta.split(","):null;va=new (d(1624).RealtimeChannel)(va,Ta,cb,Xa,()=>$.hubConnection(Bb),La,vb,Pa,bb,pb,qb,gb);va.init();return va},Na=(va,Pa,Ta)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",
va,Aa(ea.a[Ta]),Aa("browser"),Pa),Aa=va=>va?va.charAt(0).toLocaleUpperCase()+va.substring(1,va.length):va;d.d(J,"RealtimeChannel",function(){return wa});class wa{constructor(va,Pa,Ta,kb,gb,tb,hb,Xa,$a,La,bb,Gb){this.JIb=!1;this.NH=null;this.Py=new w.a;this.Iwa=1;this.Aia=null;this.jm=!1;this.T8b=(new Date(0)).getTime();this.tlb=0;this.rqd=()=>{const qb=this.Iwa;this.JIb=!1;this.Rk.Mjd();this.A9.LNf(this.jrf,this.ifd,Object(f.a)(this.M0,this.M0.mVf,"initThrottlerManager"),Object(f.a)(this,this.kwa,
"verifyConnectionToken"),qb)};this.ifd=(qb=null)=>{this.Rk.Ojd();let Sa=null;!qb||"documentsessiondeleted"!==(Sa=qb.toLowerCase())&&"documentsessionexpired"!==Sa?this.DJa():(m.ULS.sendTraceTag(508396225,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.Hk,qb),this.disconnect())};this.DJa=(qb,Sa=null)=>{m.ULS.sendTraceTag(508396224,500,50,"Disconnecting the connection [{0}]",this.NH);qb=(qb=2===this.lk||1===this.lk)&&
!this.M0.kfa;let cb=!0,pb=0;Sa&&Object.getType(Sa)!==Object.getType(Sys.EventArgs.Empty)&&Sa.LZb&&""!==Sa.LZb&&(qb=!0,this.A9.DAg(Sa.LZb),cb=Sa.E_b,pb=Sa.reconnectDelay);qb&&this.mK(1,this.lk);++this.Iwa;this.M0.IY();this.NFg(cb);this.A9.xyf();this.$Xc();qb&&window.setTimeout(this.rqd,Math.min(pb,3E4))};this.Zsd=()=>{let qb=null;const Sa=({correlationId:qb}=this.A9.i3c()).returnValue;this.Aia.qs=Sa;m.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",
this.Hk,qb)};this.jrf=qb=>{const {FrequentLoggingMetrics:Sa}=d(1449);this.T8b=(new Date).getTime();let cb=null;this.Aia.qs=({correlationId:cb}=this.A9.i3c()).returnValue;this.Ne.oRh&&(this.Aia.url=qb,Sa.instance&&(Sa.instance.EWc=u.a.yU(qb)));let pb=null;this.Zd&&(pb=this.Zd.Xf("WebServiceCall","ConnectToServer"));m.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.Hk);qb={};this.wRc&&(qb.transport=1===this.wRc.length?this.wRc[0]:this.wRc);qb.pingInterval=null;v.a.instance.xNa(1,
0);qb.waitForPageLoad=!1;this.Aia.start(qb,null).done(vb=>{this.Rk.Pjd();v.a.instance.xNa(1,1,!0);m.ULS.sendTraceTag(508396195,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",vb.id,cb)}).fail(vb=>{m.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.A9.lw,cb,this.Hk);this.ifd();this.Rk.Njd(vb);v.a.instance.xNa(1,1,!1);this.ze.xjd(0,{["CorrelationId"]:cb,["ErrorDetails"]:vb,["ConnectionState"]:l.a[this.lk]})}).always(()=>
{const {FrequentLoggingMetrics:vb}=d(1449);pb&&pb.stop();vb.instance&&(vb.instance.GDb=!1)})};this.Yfd=(qb,Sa)=>{for(const cb of Sa.lNg)this.Py.mb(cb.key)||this.Py.W(cb.key,new V.a),qb=cb.value,this.Py.K(cb.key).W(Sa.type,new F(qb.Presence,new Date(qb.TimeStamp))),cb.key===this._clientId&&0===Sa.type&&this.ze.Rpg(qb.Presence)};this.Xfd=(qb,Sa)=>{for(const cb of Sa.Hnb)this.Py.remove(cb)};this.VLb=()=>{let qb;const Sa=[];({value:qb}=this.Py.Ec(this._clientId)).returnValue&&this.Py.remove(this._clientId);
for(const cb of this.Py.keys)Array.add(Sa,cb);for(const cb of Sa)this.Py.remove(cb);qb&&this.Py.W(this._clientId,qb);this.ze.Ppg(Sa)};this._clientId=va;this.wRc=Pa;this.lk=0;this.Zd=kb;this.vCb=Xa;this.o7e=hb;this.mJe=$a;this.QNe=gb;this.A9=tb;this.Hk=Ta;this.Rk=La;this.Ne=bb;this.Gf=Gb;this.kQc=1>100*Math.random()}get Lba(){return this.A9.Lba}set Lba(va){this.A9.Lba=va}get M0(){return this.o7e}get ze(){return this.mJe}init(){this.ze.Egf(this.DJa);this.ze.Qgf(this.Yfd);this.ze.Pgf(this.Xfd);this.Gf.Y5a(this.Rk);
z.AFrameworkApplication.JH(()=>{const {FrequentLoggingMetrics:va}=d(1449);this.Rk.hZb();va.instance&&va.instance.oVb()});this.$Xc();this.EVl();this.ze.Kgf(this.Zsd)}EVl(){try{const Ta=$.signalR;if(!Ta)throw Error.invalidOperation("Failed to retrieve Signalr object");const kb=Ta.version;if(!kb)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===kb){var va=Ta.transports;if(!va)throw Error.invalidOperation("Failed to retrieve transports object");var Pa=va.longPolling;
if(!Pa)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!Pa.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");Pa.supportsKeepAlive=this.nLl()}}catch(Ta){m.ULS.sendTraceTag(508396227,500,15,"Failed to disable longPolling KeepAlives: {0}",Ta.message)}}nLl(){return()=>!1}$Xc(){const va=++this.Iwa;this.T8b=(new Date(0)).getTime();this.Aia=this.QNe();this.ze.Zpg(this.Aia);this.Aia.stateChanged(Pa=>{this.Seg(Pa,va)});
this.Aia.connectionSlow(Object(f.a)(this,this.Vne,"onSlowConnection"));this.Aia.error(Object(f.a)(this,this.Tne,"onSignalRError"));this.Aia.log=Object(f.a)(this,this.Une,"onSignalRLog")}kwa(va,Pa){return va!==this.Iwa?(m.ULS.sendTraceTag(508396226,500,50,"ConnectionToken verification failed for {0}",Pa),!1):!0}connect(){2!==this.lk&&1!==this.lk&&(m.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.Hk),this.vCb.Reg(),v.a.instance.uFg(),this.mK(1,this.lk),this.rqd())}disconnect(){const {FrequentLoggingMetrics:va}=
d(1449);0===this.lk?m.ULS.sendTraceTag(508396194,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Hk):(this.Rk.Qjd(),va.instance&&(va.instance.GDb=!0),m.ULS.sendTraceTag(508396193,500,50,"Starting explicit disconnect for [{0}]",this.Hk),this.M0.kfa=!0,this.vCb.cfg(),this.mK(0,this.lk),this.DJa(),this.M0.kfa=!1)}NFg(va){const Pa=this.mnf(),Ta=this.Aia,kb=this.NH,gb=()=>{if(this.JIb)m.ULS.sendTraceTag(508396191,500,15,"Stop connection was called twice, possibly on the same connection.");
else try{this.JIb=!0,Ta.stop(!0,va)}catch(tb){m.ULS.sendTraceTag(508396192,500,15,"Stopping connection failed: {0}",tb.message)}};0<Pa?(m.ULS.sendTraceTag(508396190,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",kb,Pa),window.setTimeout(gb,Pa)):(m.ULS.sendTraceTag(508396189,500,50,"Stopping connection [{0}].",kb),gb())}mnf(){let va=0;0===this.Aia.state&&(va=this.T8b+wa.Abk-(new Date).getTime(),0>va&&(va=0));return va}get connectionState(){return this.lk}a_(va){this.ze.a_(va)}KDa(va){this.ze.KDa(va)}gyg(va){this.cEa(0,
va)}cEa(va,Pa){const Ta=new a.a;this.ze.zjd(va,Pa,Ta);return Ta.task}Wya(va){this.ze.Wya(va)}b_a(va){this.ze.b_a(va)}vmb(va){this.ze.vmb(va)}rxb(va){this.ze.rxb(va)}umb(va){this.ze.umb(va)}qxb(va){this.ze.qxb(va)}Elc(va){return this.MPf(va,0)}xqb(){return this.wqb(0)}wqb(va){const Pa={};for(const Ta of this.Py)Ta.value.mb(va)&&(Pa[Ta.key]=Ta.value.K(va).data);return Pa}MPf(va,Pa){return this.Py.mb(va)&&this.Py.K(va).mb(Pa)?this.Py.K(va).K(Pa).data:null}XGf(){const va=new V.a;if(!this.Py.mb(this._clientId))return va;
for(const Pa of this.Py.K(this._clientId))va.W(Pa.key,Pa.value.data);return va}tC(va,Pa=null,Ta=!1){const kb=new a.a;this.ze.TYb(va,Pa,Ta,kb);return kb.task}TO(va){this.ze.TO(va)}MDa(va){this.ze.MDa(va)}jWa(va){let Pa,Ta;return({value:Pa}=this.Py.Ec(va)).returnValue&&({value:Ta}=Pa.Ec(0)).returnValue?new x.a(this.NPf(Ta),Ta.timeStamp):null}zjc(){const va={};for(const Pa of this.Py)Pa.value.Ec(0).returnValue&&(va[Pa.key]=this.jWa(Pa.key));return va}o9(va){const Pa=new a.a;this.ze.ete(va,Pa);return Pa.task}get clientId(){return this._clientId}get oEg(){return this.kQc}dispose(){var va;
const {FrequentLoggingMetrics:Pa}=d(1449);if(!this.jm){if(null===(va=z.AFrameworkApplication.J)||void 0===va?0:va.$("DetachRtcEventHandlerOnDispose"))this.lxf(),this.M0.mxf();this.M0.IY();this.Gf.Bvc(this.Rk);this.Rk.hZb();Pa.instance&&Pa.instance.oVb();this.jm=!0}}Seg(va,Pa){this.kwa(Pa,"StateChangedSignalR")&&this.mK(this.iXc(va.newState),this.iXc(va.oldState))}mK(va,Pa){var {FrequentLoggingMetrics:Ta}=d(1449),{ClientToClientMessageTelemetry:kb}=d(1791);if((1!==this.lk||0!==Pa||1!==va)&&this.lk!==
Pa){const gb=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.lk,Pa,va]));m.ULS.sendTraceTag(508396188,500,10,gb)}if(this.lk!==va){switch(va){case 2:Ta.instance&&Ta.instance.n8f();this.NH=this.Aia.id;m.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.NH,this.Hk);this.c7f(this.Aia);m.ULS.sendTraceTag(508396186,500,50,"Retrieving complete session state");Ta=null;
this.Zd&&(Ta=this.Zd.Xf("WebServiceCall","Receive First Presence"));kb=this.Iwa;this.ze.Ypg(Object(f.a)(this,this.kwa,"verifyConnectionToken"),kb,this.vCb,this.VLb,this.XGf(),Ta);this.Ne.uwg&&(Ta=100*Math.random()<=this.Ne.vwg,d(1791).ClientToClientMessageTelemetry.erb(this.ze,this.Ne,Ta).start());break;case 1:2===Pa&&m.ULS.sendTraceTag(508396185,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.NH);break;case 0:if(kb.instance&&kb.instance.stop(),this.M0.kfa)m.ULS.sendTraceTag(508396182,
500,50,"Connection [{0}] has been explicitly closed",this.NH);else{1===Pa&&(m.ULS.sendTraceTag(508396184,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.NH),this.Rk.Rjd());2===Pa&&m.ULS.sendTraceTag(508396183,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.NH);this.DJa();return}}this.lk=va;
this.ze.Ipg(va,Pa)}}lxf(){this.ze.ntg(this.DJa);this.ze.wtg(this.Yfd);this.ze.vtg(this.Xfd);this.ze.ttg(this.Zsd)}c7f(va){if(va&&va.transport&&va.transport.name){va=va.transport.name;var Pa=va.toLowerCase();"websockets"===Pa?m.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",va,this.Hk):"serversentevents"===Pa?m.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",va,this.Hk):"foreverframe"===Pa?m.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",va,this.Hk):
"longpolling"===Pa?m.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",va,this.Hk):"mocktransport"!==Pa&&m.ULS.sendTraceTag(508396180,500,15,"Unknown transport protocol encountered - '{0}'",va)}else m.ULS.sendTraceTag(508396181,500,10,"Transport protocol name is missing")}Vne(){if(this.Ne.wmd){const va=u.a.KL(this.Lba,"mid");m.ULS.sendTraceTag(508396178,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.NH,va)}else m.ULS.sendTraceTag(508396177,500,50,
"Detected that the connection [{0}] is slow",this.NH)}Tne(){m.ULS.sendTraceTag(508396176,600,15,"SignalR ERROR for connection [{0}];",this.NH)}Une(va){va=d(1405).RtcUtils.Jma(va);if(this.Ne.wmd&&va.startsWith("Keep alive timed out.")){const Pa=u.a.KL(this.Lba,"mid");m.ULS.sendTraceTag(508396175,500,15,"SignalR lib: {0}. Target Machine: {1}",va,Pa)}else this.oEg&&2E3>this.tlb&&!va.startsWith("Invok")&&!va.startsWith("Trigger")&&(m.ULS.sendTraceTag(508396174,500,50,"SignalR lib: {0}",va),this.tlb++)}iXc(va){switch(va){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",va,"Unknown SignalR state");}}NPf(va){return va&&va.timeStamp?(new Date).getTime()-va.timeStamp.getTime()>(this.Ne.lkf?6E4:this.Ne.kkf)?2:1:1}static createInstance(va,Pa,Ta,kb,gb,tb,hb,Xa=null,$a=null,La=null,bb=null,Gb=null,qb=null){return la(va,Pa,Ta,qb,kb,gb,tb,hb,Xa,$a,La,Gb,bb)}}wa.Abk=15E3;Object(I.a)(wa,"RealtimeChannel",null,[1800,1587])},1637:function(I,J,d){I=d(0);class m{constructor(){this.CEc=
this.rCb=!1;this.callback=null}Ovb(a){this.callback=a;this.qsd()}Scd(a){this.rCb||(this.rCb=!0,this.KNe=a,this.qsd())}qsd(){this.rCb&&this.callback&&!this.CEc&&(this.CEc=!0,this.callback(this.KNe))}}Object(I.a)(m,"CompletionTask",null,[]);d.d(J,"a",function(){return f});class f{constructor(){this.VLc=new m;this.TLc=new m}xcb(a){this.VLc.Ovb(a)}wcb(a){this.TLc.Ovb(a)}kMa(a){this.VLc.Scd(a)}Z7(a){this.TLc.Scd(a)}GVb(){this.kMa(2);this.Z7(2)}}Object(I.a)(f,"MessageStatus",null,[1848])},1718:function(I,
J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f,a,l,w){super();this.type=f;this.pA=a;this.Twf=l;this.Zna=w}}Object(I.a)(m,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1719:function(I,J,d){d.r(J);d.d(J,"MaxOutstandingThrottler",function(){return a});I=d(0);var m=d(86);J=d(1720);var f=d(1637);class a extends J.a{constructor(l,w=""){super(l,w);this.gua=this.g9=0;this.sa=new m.a;this.Fpa=!1;this.Y1a=this.Q1a=this.dJb=0;this.ryg=()=>{this.Fpa=!1;if(this.xta){const z=
this.w5a,x=this.zqa;this.DIa(!1);this.WNa(z,x)}};this.mgg=()=>{++this.Y1a;this.Y1a>Math.floor(this.gua/2)&&(this.Y1a=-1E9,this.sa.raiseEvent("TMUDM"))};this.R3a=0;this.SQ=[];this.clearTimeout=a.xNb}add(l){this.Gpa||this.init(a.SYc,a.QYc);this.kea++;const w=new f.a;this.xta?this.zeb(l,w):this.R3a<this.gua?this.WNa(l,w):(this.zeb(l,w),this.Fpa=!1);return w}WNa(l,w){l=this.LPc(l);const z=this.setTimeout(this.mgg,this.g9);++this.R3a;Array.add(this.SQ,z);const x=this.Q1a;l.xcb(u=>{w.kMa(u)});l.wcb(u=>
{this.Q1a===x&&(this.lgg(x,z),w.Z7(u))})}lgg(l,w){this.Q1a===l&&(--this.R3a,this.clearTimeout(w),Array.remove(this.SQ,w),this.xta&&this.qyg())}qyg(){this.xta&&!this.Fpa&&(this.dJb=this.setTimeout(this.ryg,0),this.Fpa=!0)}f6a(l){this.sa.addHandler("TMUDM",l)}Xkd(l){this.sa.removeHandler("TMUDM",l)}reset(){this.kea=this.xHa=this.ZFa=this.Y1a=0;++this.Q1a;for(const l of this.SQ)this.clearTimeout(l);this.R3a=0;this.SQ=[];this.DIa(!0);this.Fpa&&(this.clearTimeout(this.dJb),this.dJb=0,this.Fpa=!1)}init(l,
w){this.Gpa||(this.g9=l,this.gua=w,this.Gpa=!0)}static createInstance(l,w=""){return new a(l,w)}static xNb(l){window.clearTimeout(l)}}a.SYc=15E3;a.QYc=5;Object(I.a)(a,"MaxOutstandingThrottler",J.a,[1840,1841])},1720:function(I,J,d){d.d(J,"a",function(){return f});I=d(0);var m=d(8);class f{constructor(a,l=""){this.ZFa=this.xHa=0;this.WEb=!1;this.zqa=this.w5a=null;this.Gpa=!1;this.LPc=a;this.Brd=l;this.setTimeout=f.zNb;this.kea=this.xHa=this.ZFa=0}gZb(){0<this.kea&&0<this.ZFa&&m.ULS.sendTraceTag(36545635,
500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.Brd,this.ZFa,this.kea);0<this.kea&&0<this.xHa&&m.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.Brd,this.xHa,this.kea)}get xta(){return this.WEb}zeb(a,l){this.xHa++;this.DIa(!0);this.WEb=!0;this.w5a=a;this.zqa=l}DIa(a){this.WEb=!1;this.zqa&&a&&(this.ZFa++,this.zqa.GVb());this.zqa=this.w5a=null}static zNb(a,l){return window.setTimeout(a,l)}}Object(I.a)(f,"ThrottlerBase",null,[])},1721:function(I,
J,d){d.r(J);d.d(J,"MaxRateThrottler",function(){return f});I=d(0);J=d(1720);var m=d(1637);class f extends J.a{constructor(a,l=""){super(a,l);this.lua=0;this.pyg=()=>{if(this.xta){const w=this.w5a,z=this.zqa;this.DIa(!1);this.WNa(w,z)}};this.BGa=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(a){this.Gpa||(this.lua=a,this.Gpa=!0)}add(a){this.Gpa||this.init(f.OYc);this.kea++;const l=this.currentTime(),w=new m.a;this.BGa>l&&(this.BGa=l);this.xta?(this.DIa(!0),this.zeb(a,w)):this.BGa+
this.lua<=l?this.WNa(a,w):(this.zeb(a,w),this.setTimeout(this.pyg,this.BGa+this.lua-l));return w}WNa(a,l){this.BGa=this.currentTime();a=this.LPc(a);a.xcb(w=>{l.kMa(w)});a.wcb(w=>{l.Z7(w)})}static createInstance(a,l=""){return new f(a,l)}}f.OYc=200;Object(I.a)(f,"MaxRateThrottler",J.a,[1842,1841])},1722:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m{constructor(){this.Presence=null;this.TimeStamp=0}}Object(I.a)(m,"PresenceDataEntryForClients",null,[])},1723:function(I,J,d){d.d(J,"a",
function(){return m});I=d(0);class m{}m.n_b="rr";m.wwg="rd";m.twg="rbp";m.E_b="sa";Object(I.a)(m,"RtcReconnectParams",null,[])},1724:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m{constructor(f,a,l,w){this.k9f=f;this.g9=a;this.C8f=l;this.mQf=w}}Object(I.a)(m,"ThrottlerManagerSettings",null,[])},1776:function(I,J,d){I=d(0);var m=d(1903),f=d(1908),a=d(1904),l=d(1907),w=d(1906),z=d(1902),x=d(1905);class u extends Sys.EventArgs{constructor(){super()}}Object(I.a)(u,"GotCompletePersistentStateWithMetadataEventArgs",
Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(O,V,Z,W,P,S){super();this.kwa=O;this.tUa=V;this.lrf=Z;this.i0c=P;this.VLb=W;this.rz=S}}Object(I.a)(v,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class F extends Sys.EventArgs{constructor(O){super();this.hubConnection=O}}Object(I.a)(F,"RefreshProxyEventArgs",Sys.EventArgs,[]);class y extends Sys.EventArgs{constructor(O,V){super();this.mfa=O;this.errorMessage=V}}Object(I.a)(y,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class G extends Sys.EventArgs{constructor(O,
V,Z){super();this.type=O;this.WI=V;this.Zna=Z}}Object(I.a)(G,"SendPersistentStateEventArgs",Sys.EventArgs,[]);var C=d(1718);class H extends Sys.EventArgs{constructor(){super()}}Object(I.a)(H,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class K extends Sys.EventArgs{constructor(O){super();this.Hnb=O}}Object(I.a)(K,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class R extends Sys.EventArgs{constructor(O,V){super();this.type=O;this.lNg=V}}Object(I.a)(R,"UpdatePersistentStateRequestEventArgs",
Sys.EventArgs,[]);var E=d(86);d.d(J,"a",function(){return L});class L{constructor(){this.sa=new E.a}Ipg(O,V){this.sa.raiseEvent("CSC",new m.a(O,V))}Zpg(O){this.sa.raiseEvent("RP",new F(O))}ndb(O){this.sa.raiseEvent("RC",O)}$pg(){this.sa.raiseEvent("RMID")}Ypg(O,V,Z,W,P,S){this.sa.raiseEvent("RPS",new v(O,V,Z,W,P,S))}Bjd(O,V){this.sa.raiseEvent("UPSR",new R(O,V))}vjd(O,V){this.sa.raiseEvent("PU",new z.a(O,V))}Rpg(O){this.sa.raiseEvent("MPU",new a.a(O))}TYb(O,V,Z,W){this.sa.raiseEvent("SUN",new C.a(O,
V,Z,W))}bqg(O,V){this.sa.raiseEvent("UNR",new x.a(O,V))}zjd(O,V,Z){this.sa.raiseEvent("SP",new G(O,V,Z))}cte(O,V){this.sa.raiseEvent("PSU",new w.a(O,V))}Vpg(O){this.sa.raiseEvent("PSC",new l.a(O))}Ppg(O){this.sa.raiseEvent("IPSC",new l.a(O))}cqg(O){this.sa.raiseEvent("UPSC",new K(O))}aqg(O,V){this.sa.raiseEvent("SPC",new H(O,V))}xjd(O,V){this.sa.raiseEvent("RCF",new y(O,V))}Npg(O){this.sa.raiseEvent("CPSWM",new u(O))}ete(O,V){this.sa.raiseEvent("UCI",new f.a(O,V))}a_(O){this.sa.addHandler("CSC",O)}KDa(O){this.sa.removeHandler("CSC",
O)}Fgf(O){this.sa.addHandler("RP",O)}otg(O){this.sa.removeHandler("RP",O)}Egf(O){this.sa.addHandler("RC",O)}ntg(O){this.sa.removeHandler("RC",O)}Ggf(O){this.sa.addHandler("RMID",O)}Dgf(O){this.sa.addHandler("RPS",O)}mtg(O){this.sa.removeHandler("RPS",O)}Qgf(O){this.sa.addHandler("UPSR",O)}wtg(O){this.sa.removeHandler("UPSR",O)}Wya(O){this.sa.addHandler("PU",O)}b_a(O){this.sa.removeHandler("PU",O)}fgf(O){this.sa.addHandler("IPU",O)}btg(O){this.sa.removeHandler("IPU",O)}Ogf(O){this.sa.addHandler("UCI",
O)}utg(O){this.sa.removeHandler("UCI",O)}Jgf(O){this.sa.addHandler("SUN",O)}stg(O){this.sa.removeHandler("SUN",O)}ggf(O){this.sa.addHandler("IUNR",O)}ctg(O){this.sa.removeHandler("IUNR",O)}TO(O){this.sa.addHandler("UNR",O)}MDa(O){this.sa.removeHandler("UNR",O)}vmb(O){this.sa.addHandler("PSU",O)}rxb(O){this.sa.removeHandler("PSU",O)}egf(O){this.sa.addHandler("IPSU",O)}atg(O){this.sa.removeHandler("IPSU",O)}umb(O){this.sa.addHandler("PSC",O)}qxb(O){this.sa.removeHandler("PSC",O)}dgf(O){this.sa.addHandler("IPSC",
O)}$sg(O){this.sa.removeHandler("IPSC",O)}Pgf(O){this.sa.addHandler("UPSC",O)}vtg(O){this.sa.removeHandler("UPSC",O)}Igf(O){this.sa.addHandler("SP",O)}rtg(O){this.sa.removeHandler("SP",O)}Kgf(O){this.sa.addHandler("SPC",O)}ttg(O){this.sa.removeHandler("SPC",O)}static getInstance(){return L._instance||(L._instance=new L)}}L._instance=null;Object(I.a)(L,"RtcEventHub",null,[1607])},1791:function(I,J,d){d.r(J);I=d(0);var m=d(8),f=d(334),a=d(46),l=d(72);class w{constructor(x){this.messageId=x;this.syg=
(new Date).getTime();this.HUb=new l.a}}Object(I.a)(w,"MessageLatencyDetails",null,[]);d.d(J,"ClientToClientMessageTelemetry",function(){return z});class z{constructor(x,u,v){this.pT=null;this.TFb=this.jIb=0;this.sendMessage=()=>{if(this.oHa){const F=a.a.create().toString();this.pT=new w(F);this.ze.TYb(16,F,!1,new f.a);window.setTimeout(()=>{this.K6f(F)},this.TFb)}};this.uqg=(F,y)=>{16===y.type?this.ze.TYb(17,y.pA,!1,new f.a):17===y.type&&this.oHa&&y.pA&&this.processMessage(y.pA)};this.Ne=u;this.WLc=
v;this.oHa=!1;this.ze=x;this.ze.TO(this.uqg)}start(){if(this.WLc&&!this.oHa){const x=this.Ne.zmd;this.TFb=this.Ne.vmd;x<=this.TFb?(m.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.Ne.zmd,this.Ne.vmd),this.WLc=!1):(this.oHa=!0,this.jIb=window.setInterval(this.sendMessage,x))}}K6f(x){this.pT&&this.pT.messageId===x&&(0<this.pT.HUb.count?
(x=this.pT.HUb.toArray().join(","),m.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",x)):m.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.pT=null)}stop(){this.jIb&&(window.clearInterval(this.jIb),this.oHa=!1)}processMessage(x){x&&this.pT&&x.toString()===this.pT.messageId&&(x=(new Date).getTime()-this.pT.syg,this.pT.HUb.add(x))}static get instance(){return z._instance}static erb(x,u,v){return z.instance||(z._instance=new z(x,u,v))}}z._instance=null;
Object(I.a)(z,"ClientToClientMessageTelemetry",null,[])},1902:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f,a){super();this.hia=f;this.xZc=a}}Object(I.a)(m,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1903:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f,a){super();this.newState=f;this.oldState=a}}Object(I.a)(m,"ChangedConnectionStateEventArgs",Sys.EventArgs,[])},1904:function(I,J,d){d.d(J,"a",
function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f){super();this.WI=f}}Object(I.a)(m,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[])},1905:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f,a=null){super();this.Sk=f;this.rSk=a}get type(){return this.Sk}get pA(){return this.rSk}}Object(I.a)(m,"UpdateNotificationEventArgs",Sys.EventArgs,[])},1906:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f,
a){super();this.type=f;this.hia=a}}Object(I.a)(m,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1907:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f){super();this.Hnb=f}}Object(I.a)(m,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},1908:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);class m extends Sys.EventArgs{constructor(f,a){super();this.t3h=f;this.Zna=a}}Object(I.a)(m,"ClientInfoEventArgs",Sys.EventArgs,[])},1909:function(I,
J,d){d.d(J,"a",function(){return m});I=d(0);class m{constructor(f,a){this.status=f;this.vqc=a}}Object(I.a)(m,"UserStatusInfo",null,[])},1910:function(I,J,d){d.r(J);d.d(J,"RealtimeChannelMetrics",function(){return w});I=d(0);var m=d(8),f=d(181),a=d(80),l=d(1405);class w{constructor(){this.FMc=this.GMc=this.HMc=this.CMc=this.BMc=this.DMc=this.NGa=this.qGb=0;this.vda=this.BFb=this.CGa=this.vFb=this.Jpa=this.sFb=this.O5=this.zGa=this.Ipa=this.rFb=this.K2a=this.mpa=null;this.WFb=this.EGa=this.QPc=this.WEc=
0;this.ZLc=!1;this.Mjd=this.YYb;this.Pjd=this.aZb;this.Ojd=this.$Yb;this.Rjd=this.cZb;this.Qjd=this.bZb;this.hZb=this.iZb;this.sdb=this.fZb;this.Zga=this.dZb;this.Xua=this.eZb;this.Njd=this.ZYb;this.HCa=this.iWb;this.CYa=this.jWb}YYb(){this.qGb++;this.rFb=new Date;this.mpa||(this.mpa=new Date)}aZb(){this.NGa++;this.O5=new Date;this.K2a||(this.K2a=this.O5);this.CGa=this.O5;this.$qf()}$Yb(){this.DMc++;this.sFb=new Date}cZb(){this.BMc++;this.Ipa=new Date}bZb(){this.CMc++;this.zGa=new Date}fZb(){this.Jpa=
new Date;this.HMc++}eZb(){this.vda||(this.vda=new Date);this.GMc++}dZb(){this.vFb=new Date;this.FMc++}iZb(){!this.ZLc&&this.qGb&&(m.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.bqf())),this.ZLc=!0)}ZYb(z){const {L6c:x,M6c:u,zk:v}=l.RtcUtils.KCf(z);x&&x!==f.a.xz&&(m.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:x,["HttpErrorStatus"]:u,["Exception"]:v})),f.a.kde(x)&&this.WEc++,f.a.Sfe(x)&&this.QPc++)}iWb(){this.BFb=new Date}jWb(){this.Ipa=this.CGa=new Date}bqf(){return{["numberOfConnectionAttempts"]:this.qGb,
["numberOfSuccessfulConnections"]:this.NGa,["numberOfFailedConnections"]:this.DMc,["numberOfDisconnectedConnections"]:this.BMc,["numberOfExplicitDisconnectedConnections"]:this.CMc,["numberOfSentMessages"]:this.HMc,["numberOfReceivedMessages"]:this.GMc,["numberOfLostMessages"]:this.FMc,["firstConnectionAttempt"]:this.mpa?this.mpa:null,["firstMessageReceived"]:this.vda?this.vda:null,["firstConnectionSuccess"]:this.K2a?this.K2a:null,["lastConnectionAttempt"]:this.rFb?this.rFb:null,["lastConnectionSuccess"]:this.O5?
this.O5:null,["lastConnectionFailure"]:this.sFb?this.sFb:null,["lastMessageSent"]:this.Jpa?this.Jpa:null,["lastMessageLost"]:this.vFb?this.vFb:null,["lastDisconnect"]:this.Ipa?this.Ipa:null,["lastExplicitDisconnect"]:this.zGa?this.zGa:null,["lastTimeOnline"]:this.CGa?this.CGa:null,["lastTimeOffline"]:this.BFb?this.BFb:null,["maxDisconnectedTimeMs"]:this.EGa,["maxExplicitDisconnectedTimeMs"]:this.WFb,["clientConnectionErrors"]:this.WEc,["serverConnectionErrors"]:this.QPc}}$qf(){this.mpa&&1===this.NGa&&
(this.EGa=Math.max(this.EGa,this.O5.getTime()-this.mpa.getTime()));this.Ipa&&1<this.NGa&&(this.EGa=Math.max(this.EGa,this.O5.getTime()-this.Ipa.getTime()));this.zGa&&1<this.NGa&&(this.WFb=Math.max(this.WFb,this.O5.getTime()-this.zGa.getTime()))}static createInstance(z){w._instance||(w._instance=new w,m.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",z));return w._instance}}w._instance=null;Object(I.a)(w,"RealtimeChannelMetrics",null,[1825,264])},1911:function(I,
J,d){d.d(J,"a",function(){return m});I=d(0);var m;(function(f){f[f.B7h=0]="contentUpdate";f[f.K0p=1]="editorsTableUpdate";f[f.OOb=2]="fileNameUpdate";f[f.yIp=3]="wetContentUpdate";f[f.Niq=4]="persistedContentUpdate";f[f.eul=5]="clientRtcReconnectRequest";f[f.Skq=6]="replicationTelemetry";f[f.O9p=7]="lockUpdate";f[f.oYp=8]="collabServiceContentUpdate";f[f.grq=9]="trackChangeSettingUpdate";f[f.hmq=10]="saveTargetUpdate";f[f.ksq=11]="uploadToOcsUpdate";f[f.P8p=12]="labelUpdate";f[f.V3m=13]="hostNotificationSubscriptionStatus";
f[f.zpq=14]="subscribeOrExtend";f[f.P0p=15]="elapsedBootTelemetry";f[f.y3h=16]="clientToClientTelemetryMessage";f[f.x3h=17]="clientToClientResponseMessage";f[f.Bsq=18]="verifyNotificationPipeline";f[f.k6p=19]="hostNotificationHeartbeat";f[f.Hmq=20]="secondaryMetadataUpdate";f[f.last=21]="last"})(m||(m={}));Object(I.b)("UpdateNotificationType",m)},1912:function(I,J,d){d.d(J,"a",function(){return m});I=d(0);var m;(function(f){f[f.unspecified=0]="unspecified";f[f.word=1]="word";f[f.r4l=2]="excel";f[f.Guj=
3]="powerPoint";f[f.test=4]="test";f[f.wacFrontEnd=5]="wacFrontEnd";f[f.Cpj=6]="oneNote";f[f.GHp=7]="visio";f[f.Kgq=8]="officeMobile";f[f.rZp=9]="cosmosDBChangefeed";f[f.last=10]="last"})(m||(m={}));Object(I.b)("RtcClientAppName",m)},2004:function(I,J,d){d.r(J);I=d(0);var m=d(8),f=d(108),a=d(72),l=d(880);class w{}w.lua="throttling_messageDelay";w.RLa="enabled";w.g9="throttling_timeToWaitForResponse";w.gua="throttling_maxNumberOfOutstandingMessages";w.l5c="throttling_globalMaxNumberOfOutstandingMessages";
w.errorMessage="errorMessage";w.Spd="url";w.QP="queryString";w.lw="connectionString";w.Ywc="netcore";Object(I.a)(w,"RtcFindSessionOutputFieldNameConstants",null,[]);var z=d(2),x=d(44),u=d(39),v=d(1261),F=d(80),y=d(16),G=d(117);class C{constructor(){this.m5c=this.bdd=this.cdd=this.fdd=0;this.Pab=!1;this.correlationId=this.lw=this.QP=this.nMb=this.errorMessage=null}get Rqf(){return this.nMb+"?"+this.QP}}Object(I.a)(C,"FindSessionResponse",null,[]);var H=d(591);class K{constructor(Y,X,ca,fa,ja,ra){this.T5=
null;this.x5e=Y;Y=String.format("{0}={1}",H.a.clientId,y.a.ej(fa));Y=String.format("{0}&{1}={2}",Y,H.a.userSessionId,y.a.ej(ja));Y=String.format("{0}&{1}={2}",Y,H.a.PFe,y.a.ej(ca.toString()));Y=String.format("{0}&{1}={2}",Y,H.a.userType,y.a.ej("1"));Y=String.format("{0}&{1}={2}",Y,H.a.VFe,y.a.ej(X));Y=String.format("{0}&{1}={2}",Y,H.a.dWd,y.a.ej(K.aul));(X=K.h2c(ca,ra))&&(Y=String.format("{0}&{1}",Y,X));this.RNe=Y}$jd(){this.T5=this.x5e()}generate(){this.T5&&""!==this.T5||(this.$jd(),m.ULS.sendTraceTag(575784194,
500,this.T5&&""!==this.T5?50:15,"Query signature delegate called for refresh returned: {0} ",this.T5));const Y=String.format("{0}={1}",H.a.mdb,y.a.ej(this.T5));return String.format("{0}&{1}",Y,this.RNe)}static h2c(Y,X){return 4===Y?String.format("{0}={1}",H.a.hle,"1"):X?X.OPf():null}}K.aul="1.0";Object(I.a)(K,"FindSessionQueryStringGenerator",null,[]);var R=d(1449),E=d(1592),L=d(1405),O=d(1724);class V{}V.VDf="FSType";Object(I.a)(V,"RtcFindSessionRequestHeaders",null,[]);class Z{}Z.nqg="polling";
Object(I.a)(Z,"RtcFindSessionTypes",null,[]);var W=d(1723);class P{}P.hOg="RTC-TokenProofkey";P.n2f="RTC-IsWacJsBootFsRequest";Object(I.a)(P,"RtcRequestHeaders",null,[]);var S=d(67);d.d(J,"FindSessionStrategy",function(){return aa});class aa{constructor(Y,X,ca,fa,ja,ra,ya,Ha,Wa,Ma,ua,Ka,za=null){this.HKc=(new Date(0)).getTime();this.BLc=0;this.F3a=!1;this.RPc=null;this.qZb=36E5;this.Xoa=aa.C7c;this.fGa=0;this.kha=null;this.uV=0;this.nva=this.FWc=null;this.E6e=[w.RLa,w.errorMessage,w.Spd,w.lw,w.QP,
w.l5c,w.gua,w.g9,w.lua];this.D6e=[w.RLa,w.errorMessage];this.lw=this.Lba=null;this.THc=new K(ua?ua:()=>z.AFrameworkApplication.xm,ja,ra,ya,Y,X);this.CFa=Ka;this.Zd=fa;this.Gf=X;this.UHc=ca;this.Hk=Ha;this.ze=Wa;this.hxa=za;this.VHc=!1;this.J8a=9E4;Ma&&Ma.execute(Fa=>{Fa.DTa(()=>{m.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Hk);this.THc.$jd()})});2>=100*Math.random()&&(this.qZb=3E5);R.FrequentLoggingMetrics.instance&&(R.FrequentLoggingMetrics.instance.G1c=
this.qZb)}DAg(Y){this.nva=Y}init(){this.ze.Ggf(Object(f.a)(this,this.Uug,"resetGetMachineIdDelay"));this.ze.a_(Object(f.a)(this,this.mK,"onConnectionStateChanged"))}mK(Y,X){this.uV=X.newState;2===X.newState&&(this.fGa=0)}i3c(){let Y;Y=this.kha.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.kha.QP,aa.hYd,y.a.ej(Y)),correlationId:Y}}LNf(Y,X,ca,fa,ja){this.Yxg(()=>{fa(ja,"GetMachineIdSuccess")&&(m.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",
this.lw,this.Hk),Y(this.RPc),ca(this.kPf()))},ra=>{fa(ja,"GetMachineIdFailure")&&(m.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Hk),X(ra))},fa,ja)}xyf(){this.MVc();this.VUf()}Yxg(Y,X,ca,fa){m.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.lw);if(this.lw)Y();else{var ja=this.enf();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(Y,X,ca,fa)},ja)}}sendFindSessionRequestToServerInternal(Y,
X,ca,fa){ca(fa,"RequestMachineId")&&(this.HKc=(new Date).getTime(),ca=u.a.Le(),this.XPb(ja=>{const ra=u.a.Le();this.Sgd(ja);this.Z_b();Y();ja=u.a.Le()-ra;m.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",ja)},ja=>{const ra=u.a.Le();this.MVc();R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.Ws(2,3);X(ja);ja=u.a.Le()-ra;m.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",ja)},!1),ca=u.a.Le()-ca,m.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",
ca))}VUf(){this.Xoa+=aa.HLf;this.Xoa=Math.min(this.Xoa,aa.z8f)}enf(){var Y=(new Date).getTime();Y=this.HKc+this.Xoa-Y;0>Y&&(Y=0);return Y}Sgd(Y){try{this.kha=Y,this.Lba=Y.Rqf,this.lw=Y.lw,this.FWc=Y.QP,this.RPc=Y.nMb}catch(X){m.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",X.toString())}}MVc(){this.lw=null;this.NVc()}Z_b(){this.NVc();this.F3a=!0;this.BLc=window.setTimeout(Object(f.a)(this,this.Zqg,"refreshMachineId"),this.qZb)}NVc(){this.F3a&&
(window.clearTimeout(this.BLc),this.F3a=!1)}Zqg(){this.F3a=!1;this.XPb(Y=>{const X=this.FWc!==Y.QP,ca=this.lw!==Y.lw,fa=this.lw;this.Sgd(Y);0!==this.uV&&(ca?(m.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",fa||"null",Y.lw),this.ze.ndb()):(this.ze.aqg(X,ca),this.Z_b()))},()=>{R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.Ws(2,3);this.Z_b()},!0)}Uug(){this.Xoa=aa.C7c}kPf(){return new O.a(this.kha.fdd,this.kha.cdd,this.kha.bdd,
this.kha.m5c)}dKg(Y){if(Object.getType(Y)!==Object)return null;for(let X in Y);return this.otf(Y)}otf(Y){if(!(w.RLa in Y))return null;const X=Y[w.RLa];var ca=X?this.E6e:this.D6e;for(const fa of ca)if(!(fa in Y))return null;ca=Object.assign(new C,{Pab:Y[w.RLa],errorMessage:Y[w.errorMessage],correlationId:G.a.create().toString()});X&&(ca.nMb=Y[w.Spd],ca.QP=Y[w.QP],ca.lw=Y[w.lw],ca.m5c=Y[w.l5c],ca.bdd=Y[w.gua],ca.cdd=Y[w.g9],ca.fdd=Y[w.lua]);return ca}UJf(Y,X){m.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");
this.hxa.r3d.continueWith(()=>{this.hxa.r3d.result?(m.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),Y(this.hxa.s3d)):(m.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),X(this.hxa.s3d))})}Bld(Y,X,ca,fa,ja=!1){return ra=>{E.a.instance.xNa(0,1);Y&&Y.stop();this.CFa=this.nva=null;this.scd(ra.data,!0,X);var ya=L.RtcUtils.deserialize(ra.data.Ee,"FindSession",null);if(ya)if(ya=this.dKg(ya)){if(ya.Pab&&ya.QP&&ya.lw){m.ULS.sendTraceTag(4317446,
500,50,"Successfully retrieved MachineId from server for [{0}]",this.Hk);this.r6f(ra.data);ca(ya);return}X.FindSessionFailureReason="FindSessionInvalidResponse";X.IsRtcEnabled=ya.Pab;X.IsQueryStringEmpty=!ya.QP;X.IsConnectionStringEmpty=!ya.lw;m.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.Hk,ya.Pab,!ya.QP,!ya.lw)}else X.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",
m.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Hk);else X.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",m.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",this.Hk);this.yjd(X,ja);fa(null)}}yld(Y,X,ca,fa=!1){return ja=>{E.a.instance.xNa(0,1);Y&&Y.stop();this.CFa=this.nva=null;this.scd(ja.data,!1,X);let ra=null;var ya="unknown";let Ha="unknown";ja.data&&((ya=ja.data.wi)&&aa.ONa in ya&&
(ra=ya[aa.ONa].toString()),ya=v.a[ja.data.status],Ha=ja.data.He.toString());X.FindSessionFailureReason="FindSessionRequestFailed";X.HttpErrorCode=Ha;X.HttpErrorStatus=ya;X[aa.ONa]=ra;m.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",ya,Ha,this.Hk,ra,fa);this.yjd(X,fa);ca(Ha)}}XPb(Y,X,ca=!1){let fa=null;m.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.Hk);const ja={};var ra=
this.THc.generate();ja[S.a.H2]=G.a.create().toString();this.nva&&""!==this.nva?ra=String.format("{0}&{1}={2}",ra,W.a.n_b,this.nva):this.CFa&&""!==this.CFa&&(ra=String.format("{0}&{1}={2}",ra,W.a.n_b,this.CFa),ja[P.hOg]="True",ja[P.n2f]="True");ra=this.UHc+"?"+ra;ca&&(ja[V.VDf]=Z.nqg);const ya={};ya.IsNetworkOfflineBeforeSendRequest=this.Gf.yta;ya.HasAvailableConnectionsBeforeSendRequest=this.Gf.V5c;ya.MaxConnectionsAllowed=this.Gf.NVb;ya.IsRefreshMachineId=ca;this.hxa&&!this.VHc?(this.UJf(this.Bld(null,
ya,Y,X,ca),this.yld(null,ya,X,ca)),this.VHc=!0):(this.Zd&&(fa=this.Zd.Xf("WebServiceCall","GetMachineIdFromTheServer")),R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.Ws(2,0),0>this.Gf.$5a(ra,1,null,ja,[aa.u7a,aa.ONa,aa.DMa,aa.m_b,aa.Rdd,aa.Fed,aa.Eed],1,this.Bld(fa,ya,Y,X,ca),this.yld(fa,ya,X,ca),null,!1,null,this.J8a,"3",null,!0)&&(5<this.fGa&&200>this.fGa&&m.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",
this.fGa),window.setTimeout(()=>{this.fGa++;X("-1")},1E3)))}scd(Y,X,ca){ca||(ca={});ca.IsNetworkOfflineAfterRequestComplete=this.Gf.yta;ca.IsRequestSucceeded=X;Y&&(ca.EnqueueTime=Y.gsa,ca.InvokedTime=Y.rH,ca.CompletedTime=Y.bP,Y.wi&&(aa.u7a in Y.wi&&(ca.CorrelationId=Y.wi[aa.u7a]),aa.DMa in Y.wi&&(ca[aa.DMa]=Y.wi[aa.DMa])));m.ULS.sendTraceTag(38633565,500,X?50:15,L.RtcUtils.Jma(ca))}yjd(Y,X){Y||(Y={});Y.ConnectionState=l.a[this.uV];X||this.ze.xjd(1,Y)}r6f(Y){try{var X=!1,ca=!1,fa=Y.wi,ja=x.a.yU(Y.request.get_url());
if(fa&&aa.m_b in fa){const Ma=fa[aa.m_b].toString().toLocaleLowerCase();ca="true"===Ma;X="false"===Ma}fa=!1;const Wa=0<=ja.toLocaleLowerCase().indexOf("collab");ca&&!Wa?fa=!0:X&&Wa&&(fa=!0);if(fa){X={};X.HostName=ja;X.Status=v.a[Y.status];X.HttpStatus=Y.He.toString();var ra=Y.request.get_headers();for(let Ma in ra){var ya=ra[Ma];(ja=Ma)&&0<ja.length&&(ca=0,ya&&(ca=ya.toString().length),X["r_"+ja]=ca)}if(Y.wi){const Ma=new a.a;Ma.add(aa.u7a);Ma.add(aa.DMa);Ma.add(aa.ONa);Ma.add(aa.Fed);Ma.add(aa.Eed);
Ma.add(aa.Rdd);aa.uff(X,Y.wi,Ma)}aa.qff(Y.request.get_url(),X);var Ha=F.a.toJSON(X);m.ULS.sendTraceTag(559437006,500,15,Ha)}}catch(Wa){m.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Wa.toString())}}static createInstance(Y,X,ca,fa,ja,ra,ya,Ha,Wa,Ma,ua,Ka=null){return aa.Ltf(Y,X,ca,fa,ja,ra,ya,Ha,Wa,Ma,null,ua,Ka)}static Ltf(Y,X,ca,fa,ja,ra,ya,Ha,Wa,Ma,ua,Ka,za=null){Y=Y||G.a.create().toString();Y=new aa(Y,X,ca,fa,ja,ra,ya,Ha,Wa,Ma,ua,Ka,za);Y.init();return Y}static uff(Y,
X,ca){for(let fa of ca)fa in X&&(Y[fa]=X[fa])}static qff(Y,X){if(Y){var ca=Y.indexOf("?");if(-1!==ca)for(Y=Y.substr(ca+1).split("&"),ca=0;ca<Y.length;++ca){var fa=Y[ca].split("=");if(2===fa.length){const ja=fa[0];if(ja&&0<ja.length){let ra=0;if(fa=fa[1])ra=fa.length;X["q_"+ja]=ra}}}}}}aa.HLf=3E3;aa.z8f=3E5;aa.C7c=1E3;aa.u7a="X-CorrelationId";aa.hYd="corrid";aa.ONa="RtcErrorCode";aa.DMa="X-OfficeCluster";aa.m_b="X-NewEnv";aa.Rdd="X-MSEdge-Ref";aa.Eed="X-OFFICEFD";aa.Fed="X-OfficeFE";Object(I.a)(aa,
"FindSessionStrategy",null,[1824])},2148:function(I,J,d){d.r(J);var m=d(2),f=d(0);class a{constructor(pa,Fb){this.Xxa=null;this.Lga=()=>{a.kUh(this.Xxa.yqb())&&(this.Xxa.xtg(this.Lga),this.LJk.IsRealCoauthSession=!0)};this.QNc=pa;this.LJk=Fb}init(){this.QNc.continueWith(()=>{this.Xxa=this.QNc.result;this.Xxa.cdc(this.Lga)})}static kUh(pa){let Fb=null;for(const Mb of pa)if(Mb)if(pa=Mb.isAnonymous||!Mb.email?Mb.clientId:Mb.email.toUpperCase(),!Fb)Fb=pa;else if(Fb!==pa)return!0;return!1}}Object(f.a)(a,
"CoauthTelemetry",null,[864]);var l=d(8),w=d(334),z=d(82),x;(function(pa){pa[pa.AWp=0]="badStatePreventedTelemetry";pa[pa.notImplemented=1]="notImplemented";pa[pa.Ikq=2]="renderHandled";pa[pa.Jkq=3]="renderHandledWithVeto"})(x||(x={}));Object(f.b)("CoauthorGalleryTelemetryEndResult",x);var u=d(85),v=d(80),F=d(136);class y{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf){this.Ezh=this.Mbh=this.pF=null;this.uoe=()=>{this.Lga()};this.Rfg=()=>{const Fg=this.pg.nv("AppInitStatus_interactivityReady");l.ULS.shipAssertTag(42259235,
325,!!this.HOd);const ah=this.HOd-Fg,Rg={};Rg.InteractiveTime=Fg;Rg.ReactRenderComplete=this.HOd;Rg.HadTabSwitch=this.ZBb();Rg.IsModernGallery=this.RRc;l.ULS.sendTraceTag(594883104,325,20,v.a.toJSON(Rg));this.RRc?(l.ULS.sendTraceTag(42062997,325,15,ah.toString()),this.qNd.IV(this.bHp(ah)?3:2)):l.ULS.sendTraceTag(594883103,325,15,ah.toString())};this.v9=pa;this.qNd=new w.a;this.Ga=Mb;this.qNe=Fb;this.h1=Ic;this.pg=ld;this.h4e=Kd;this.ukb=ue;this.Iok=Ye;this.Wkh=this.Qkh=!1;this.HOd=0;this.Kbh=1;this.ZBb=
Bf;this.RRc=this.Ga.$("PeoplesWellExtraButtonInfoIsEnabled");this.qia=Object(z.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get zYj(){return this.qNd.task}init(){F.Task.WAA.call(null,this.ukb,this.qNe,this.h4e).continueWith(()=>{this.pF=this.ukb.result;this.Mbh=this.qNe.result;this.Ezh=this.h4e.result;F.Task.WAA.call(null,this.qNe.result.jfc,this.h4e.result.r1j).continueWith(()=>{this.Kbh=this.Mbh.jfc.result;this.HOd=this.Ezh.r1j.result;this.pF.cdc(this.uoe);this.pF.yqb().length&&
this.Lga()})})}Lga(){this.Iok(this.pF.yqb())?(this.pF.xtg(this.uoe),this.C_n(this.Qkh)):this.qNd.IV(1);this.Qkh=!0}C_n(pa){this.Wkh?this.zYj.continueWith(()=>{l.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",x[this.zYj.result])}):(this.Wkh=!0,this.yko(0===this.Kbh&&!pa))}yko(pa){pa?this.h1.$k(4,this.Rfg):this.qNd.IV(1)}bHp(pa){const Fb=pa>this.Ga.fc("CoauthorGalleryTimeToRenderDurationMs",1E4);var Mb="Word"===this.qia;const Ic="PowerPoint"===this.qia;
if(this.ZBb())return l.ULS.sendTraceTag(50455714,325,50,Fb.toString()),!1;Mb&&u.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);Fb&&(Mb&&u.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),Mb=m.AFrameworkApplication.J.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientCoauthorGalleryRenderLatencyQoSError"),Ic&&Mb&&pa<this.Ga.fc("CoauthorGalleryTimeToRenderCutoffThresholdMs",
3E4)&&u.Health.instance.recordQosError("CoauthorGalleryTimeToRenderDurationIsTooLong",["CoauthGalleryExperienceDegraded"],!1,!0,!0,!1,null),l.ULS.sendTraceTag(42062998,325,15,pa.toString()));return Fb}}Object(f.a)(y,"CoauthorGalleryTelemetry",null,[863]);class G{constructor(pa){this.pF=null;this.cyd={};this.wJd={};this.uJc=null;this.Lga=()=>{this.j9j()};this.Dyl=(Fb,Mb)=>Fb.SXa>Mb.SXa?1:Fb.SXa<Mb.SXa?-1:0;this.ukb=pa}w8d(pa){const Fb=new w.a;this.init().continueWith(()=>{pa in this.cyd?Fb.IV(this.cyd[pa]):
this.wJd[pa]=Fb});return Fb.task}init(){if(this.uJc)return this.uJc.task;this.uJc=new w.a;this.ukb.continueWith(()=>{this.pF=this.ukb.result;this.pF.cdc(this.Lga);this.j9j();this.uJc.hg(null)});return this.uJc.task}j9j(){const pa=this.pF.yqb();pa.sort(this.Dyl);this.cyd={};for(let Fb=0;Fb<pa.length&&pa[Fb]&&pa[Fb].SXa;Fb++)this.DZk(this.cyd,pa[Fb].clientId,Fb)}DZk(pa,Fb,Mb){pa[Fb]=Mb;Fb in this.wJd&&(this.wJd[Fb].IV(Mb),delete this.wJd[Fb])}}Object(f.a)(G,"CoauthorPositionFinder",null,[862]);var C=
d(592),H=d(277),K=d(515),R=d(72),E=d(117);class L{constructor(){this.FHa=null;this.wEc=Array(32)}xor(pa){if(!pa)throw Error.argumentNull("Guid argument cannot be null");const Fb=new L,Mb=new Sys.StringBuilder;for(let Ic=0;Ic<pa.wEc.length;Ic++){const ld=this.wEc[Ic]^pa.wEc[Ic];Fb.wEc[Ic]=ld;Mb.append(ld.toString(16));7!==Ic&&11!==Ic&&15!==Ic&&19!==Ic||Mb.append("-")}Fb.FHa=E.a.Af(Mb.toString());return Fb}toString(){return this.FHa.toString()}equals(pa){if(!pa)throw Error.argumentNull("Guid argument cannot be null");
return this.FHa.equals(pa.FHa)}static kqb(pa){if(!pa)throw Error.argumentNull("String input cannot be null");const Fb=new L;Fb.FHa=E.a.Af(pa);const Mb=Fb.FHa.toString();let Ic=0;for(let Kd=0;Kd<Mb.length;Kd++){var ld=pa.charAt(Kd);if(L.Gmn(ld))ld=L.p1m(ld,pa.charCodeAt(Kd)),Fb.wEc[Ic++]=ld;else if(!L.amn(ld))throw Error.argument("String contains characters not valid in Guids");}return Fb}static Gmn(pa){return"0"<=pa&&"9">=pa||"A"<=pa&&"F">=pa||"a"<=pa&&"f">=pa}static amn(pa){return"{"===pa||"}"===
pa||"-"===pa}static p1m(pa,Fb){if("0"<=pa&&"9">=pa)return Fb-48;if("A"<=pa&&"F">=pa)return Fb-65+10;if("a"<=pa&&"f">=pa)return Fb-97+10;throw Error.argument("Char is not valid hex digit");}}Object(f.a)(L,"Guid",null,[]);class O{constructor(pa,Fb,Mb,Ic){this.Xxa=null;this.eeh=this.Evh=!1;this.Jsh=0;this.Lga=()=>{this.Rvl(this.Xxa.yqb())};this.QNc=pa;this.M$e=Fb;this.Ga=Mb;this.C9b=Ic;this.bok=m.AFrameworkApplication.g3b||m.AFrameworkApplication.Vta;this.Vth=new C.a(H.a.vh())}get Bvf(){return this.Ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",
!1)}init(){this.QNc.continueWith(()=>{this.Xxa=this.QNc.result;this.Xxa.cdc(this.Lga)})}Rvl(pa){var Fb=0;const Mb=new K.a(H.a.vh());for(const Ic of pa)if(Ic&&Ic.isAnonymous){m.AFrameworkApplication.nd("70eb6120;2gfeb930");if(Mb.mb(Ic.userName))Mb.K(Ic.userName).add(Ic.clientId);else{let ld;Mb.add(Ic.userName,(ld=new R.a,ld.add(Ic.clientId),ld))}Ic.clientId!==this.C9b?(Fb++,2<=Fb&&!this.Evh&&this.fHn()):!this.eeh&&this.Bvf&&"Guest"===Ic.userName&&(l.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),
this.eeh=!0)}if(this.Bvf&&this.Jsh!==Fb){l.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",Fb+(this.bok?1:0));this.Jsh=Fb;for(const Ic of Mb.keys)2<=Mb.K(Ic).count&&(pa=this.Frm(Mb.K(Ic)),this.Vth.contains(pa)||(Fb={},Fb.guestsWithSameName=Mb.K(Ic).count,Fb.identifier=pa,l.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",Fb),this.Vth.add(pa)))}}fHn(){l.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.Evh=!0;this.Bvf&&
this.M$e&&this.M$e.continueWith(()=>{window.setTimeout(()=>{this.M$e.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}Frm(pa){if(!pa||1>=pa.count)return"";let Fb=L.kqb(pa.K(0));for(let Mb=1;Mb<pa.count;Mb++)Fb=Fb.xor(L.kqb(pa.K(Mb)));return Fb.toString()}}Object(f.a)(O,"GuestCoauthTelemetry",null,[]);var V=d(267);class Z{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(f.a)(Z,"PL",null,[]);var W=d(28);class P{constructor(){this.ct=this.vt=
this.d=0}static CMj(pa,Fb,Mb){const Ic=new P;Ic.d=pa;Ic.vt=Fb;Ic.ct=Mb;return W.c(Ic)}}Object(f.a)(P,"VD",null,[]);var S=d(91);class aa{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf){this.ki=0;this.sEh=!1;this._id=pa;this.kGh=Fb;this.rt=Mb;this.j1e=Ic;this.zaf=ld;this.EJb=Kd;this.UCb=ue;this.mrk=Ye;this.ZBb=Bf;this.qia=Object(z.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}GBc(pa){F.Task.WAA(this.kGh,this.j1e,this.zaf).continueWith(()=>{if(this.j1e.result<=this.zaf.result)pa.IV(!1);
else{this.ki=this.kGh.result;var Fb=this.rt-this.ki,Mb=new Z;Mb.id=this._id;Mb.et=this.rt;Mb.st=this.ki;Mb.d=this.rt-this.ki;Mb.mp=this.j1e.result;Mb.tp=this.zaf.result;Mb.ct=this.Omm(this.mrk);Mb.vc=this.ZBb();var Ic=W.c(Mb),ld="Word"===this.qia,Kd="PowerPoint"===this.qia;l.ULS.sendTraceTag(42078597,302,15,Ic);if(ld){const ue=new Map;ue.set("data",Ic);u.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",ue)}Fb>this.EJb.value&&!this.sEh&&!Mb.vc&&(this.sEh=!0,pa.IV(!0),Mb=
Object.assign(new S.a,{inStaging:!0,extendedProperties:new Map}),Mb.extendedProperties.set("data",Ic),ld&&u.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Mb),Fb<this.UCb.value&&(l.ULS.sendTraceTag(42078598,302,15,P.CMj(Fb,this.EJb.value,this.UCb.value)),Fb=m.AFrameworkApplication.J.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),Kd&&Fb&&(Mb.inStaging=!1,u.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",
["PresenceExperienceDegraded"],!1,!0,!0,!1,Mb))));pa.task.isCompleted||pa.IV(!1)}})}Omm(pa){switch(pa){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(f.a)(aa,"PresenceLatencyActivityLogger",null,[]);class Y{constructor(pa,Fb,Mb){this.wah=this.Ibh=this.Ixd=this.byd=this.t4b=0;this._id=pa;this.EJb=Fb;this.UCb=Mb;this.qia=Object(z.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get $Qh(){return this.t4b}set $Qh(pa){this.t4b=
pa;this.vof()}get b4h(){return this.byd}set b4h(pa){this.byd=pa;this.vof()}get X_h(){return this.Ixd}set X_h(pa){this.Ixd=pa;this.vof()}get c4h(){return 0!==this.Ibh}get Y_h(){return 0!==this.wah}vof(){!this.c4h&&this.t4b&&this.byd&&(this.Ibh=this.GBc(this.byd,"CoauthGalleryLightupDurationTooLong"));!this.Y_h&&this.t4b&&this.Ixd&&(this.wah=this.GBc(this.Ixd,"CanvasPresenceLightupDurationTooLong"))}GBc(pa,Fb){const Mb=pa-this.t4b;var Ic=new Z;Ic.id=this._id;Ic.et=pa;Ic.st=this.t4b;Ic.d=Mb;var ld=W.c(Ic);
pa="Word"===this.qia;Ic="CanvasPresenceLightupDurationTooLong"===Fb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===Fb?l.ULS.sendTraceTag(572289499,302,15,ld):l.ULS.sendTraceTag(571524118,302,15,ld);if(pa){var Kd=new Map;Kd.set("data",ld);u.Health.instance.recordKpiUsage(Ic,0,"wordcollabrel",Kd)}return Mb>this.EJb.value?(Kd=Object.assign(new S.a,{inStaging:!0,extendedProperties:new Map}),Kd.extendedProperties.set("data",ld),ld=Mb<this.UCb.value,
Kd.extendedProperties.set("cash",ld?"true":"false"),pa&&u.Health.instance.recordKpiFailure(Ic,Fb,!1,!0,Kd),l.ULS.sendTraceTag(572289500,302,15,P.CMj(Mb,this.EJb.value,this.UCb.value)),ld?2:1):3}}Object(f.a)(Y,"PresenceLightupLatencyLogger",null,[]);class X{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye=null,Bf=null,Fg=null){this.HAh={};this.pNe={};this.lrh=new R.a;this.pxd=this.vJc=this.pF=this.Zh=null;this.jGh=this.iGh=0;this.G4n=(ah,Rg)=>{if(!this.y$g&&2===Rg.newState){var Dh=this.BAi();Dh.continueWith(()=>
{var ej=Dh.result;ej=Date.now()-ej;const ak={};ak.clientId=this.wgj;ak.bootTime=ej;this.y$g=!0;this.Zh.tC(15,ak)})}};this.CYn=(ah,Rg)=>{if(15===Rg.type){ah=Date.now();Rg=Rg.pA;var Dh=Rg.bootTime;this.oLf(Rg.clientId).$Qh=ah-Dh}};this.uoe=()=>{this.Lga()};this.EJb=new V.a(()=>Ye.c3("PresenceBootLatencyThreshold",1E4));this.UCb=new V.a(()=>Ye.c3("PresenceBootLatencyCutoffThreshold",6E4));this.iTk=new V.a(()=>Ye.c3("PresenceLightupLatencyThreshold",2E3));this.utk=new V.a(()=>Ye.c3("PresenceLightupLatencyCutoffThreshold",
1E4));this.h1=Ic;this.TJk=ld;this.Lbh=pa;this.iDh=Fb;this.ukb=Mb;this.pg=Kd;this.C9b=Bf;this.ZBb=ue;this.clh=Fg;this.y$g=!1;this.init()}C_c(pa,Fb,Mb=null,Ic=0){Mb&&(l.ULS.shipAssertTag(42274970,302,!this.C9b||this.C9b===Mb,"_myClientId is already set and you are trying to update it to something different"),this.C9b=Mb);const ld=new w.a;this.init().continueWith(()=>{this.p3n(pa);this.E1l(ld,pa,Fb,Ic)})}get wgj(){return this.C9b||"{"+m.AFrameworkApplication.userSessionId+"}"}init(){if(this.vJc)return this.vJc.task;
this.vJc=new w.a;this.ZBb()&&l.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.Lbh.continueWith(()=>{const pa=this.Lbh.result,Fb=pa.jfc,Mb=pa.lQn;Mb.continueWith(()=>{Fb.continueWith(()=>{this.clh&&this.clh.addQosPillar("RealTimeCoauth");this.CFg(Fb.result,Mb.result);this.vJc.hg(null)})})});this.iDh.continueWith(()=>{this.Zh=this.iDh.result;this.Zh.a_(this.G4n);this.Zh.TO(this.CYn)});this.ukb.continueWith(()=>{this.pF=this.ukb.result;this.pF.cdc(this.uoe);0<this.pF.yqb().length&&this.Lga()});
return this.vJc.task}BAi(){this.pxd||(this.pxd=new w.a,this.h1.$k(4,()=>{this.pxd.IV(this.pg.nv("AppInitStatus_interactivityReady"))}));return this.pxd.task}Lga(){const pa=Date.now();var Fb=this.pF.yqb();const Mb=new R.a;for(const Ic of Fb)this.lrh.contains(Ic.clientId)||(this.lrh.add(Ic.clientId),Mb.add(Ic.clientId));if(0<Mb.count)for(const Ic of Mb)Fb=this.oLf(Ic),Fb.c4h||(Fb.b4h=pa)}p3n(pa){pa=this.oLf(pa);pa.Y_h||(pa.X_h=Date.now())}oLf(pa){return pa in this.pNe?this.pNe[pa]:this.pNe[pa]=new Y(pa,
this.iTk,this.utk)}CFg(pa,Fb=0){this.iGh=pa;this.jGh=Fb?Fb:(new Date).getTime()}E1l(pa,Fb,Mb,Ic){Mb=Mb?Mb.getTime():(new Date).getTime();Fb in this.HAh?pa.hoa():(Ic=new aa(Fb,this.ZMm(),Mb,this.w8d(this.wgj),this.w8d(Fb),this.EJb,this.UCb,Ic,this.ZBb),this.HAh[Fb]=Ic,Ic.GBc(pa))}ZMm(){return 1===this.iGh?F.Task.j7(this.jGh):this.BAi()}w8d(pa){return this.TJk.w8d(pa)}}Object(f.a)(X,"PresenceBootTelemetry",null,[861]);var ca=d(124),fa=d(179),ja=d(37),ra=d(168),ya=d(156),Ha=d(19),Wa=d(537);class Ma{get name(){return"Common.App.CoauthTelemetry"}uc(pa){pa.register(a,
1638).as("Common.App.CoauthTelemetry.ICoauthTelemetry").ha().Sd(()=>new a(Wa.a.iq(pa.Ra(615)),m.AFrameworkApplication.fh));pa.register(y,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as(1640).ha().Sd(()=>new y(m.AFrameworkApplication.va,Wa.a.iq(pa.Ra(157)),m.AFrameworkApplication.J,ca.a.get_instance(),ra.a.instance,Wa.a.iq(pa.Ra(1636)),Wa.a.iq(pa.Ra(615)),a.kUh,()=>this.EXh()));pa.register(X,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as(1641).ha().Sd(()=>new X(Wa.a.iq(pa.Ra(157)),
Wa.a.iq(pa.Ra(138)),Wa.a.iq(pa.Ra(615)),ca.a.get_instance(),pa.resolve(1637),ra.a.instance,()=>this.EXh(),m.AFrameworkApplication.J,null,u.Health.instance));pa.register(G,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as(1637).ha().Sd(()=>new G(Wa.a.iq(pa.Ra(615))));pa.register(O,1639).ha().Sd(()=>new O(Wa.a.iq(pa.Ra(615)),Wa.a.iq(pa.Ra(2)),m.AFrameworkApplication.J,"{"+m.AFrameworkApplication.userSessionId+"}"))}init(){m.AFrameworkApplication.J.xp(()=>{Ha.a.instance.resolve(1638).init();Ha.a.instance.resolve(1639).init();
m.AFrameworkApplication.J.$("CoauthorGalleryTelemetryIsEnabled")&&Ha.a.instance.resolve(1640).init();m.AFrameworkApplication.J.$("CashTelemetryIsEnabled")&&(Ha.a.instance.resolve(1641),Ha.a.instance.resolve(1637))})}dispose(){}EXh(){return ya.a.qLb&&ra.a.instance.OJ(ja.a.Std)?0<ra.a.instance.nv(ja.a.Std)[ja.a.qbk]:!1}static main(){fa.a.instance.Mc(new Ma)}}Object(f.a)(Ma,"CoauthTelemetryPackage",null,[0,1]);class ua extends Sys.EventArgs{constructor(){super()}}Object(f.a)(ua,"RtcHostNotificationEventArgs",
Sys.EventArgs,[]);var Ka;(function(pa){pa[pa.igq=0]="notYetStarted";pa[pa.Yiq=1]="polling";pa[pa.Apq=2]="subscribed";pa[pa.mWh=3]="blocked";pa[pa.Miq=4]="permanentlyStopped"})(Ka||(Ka={}));Object(f.b)("RtcHostNotificationSubscriptionState",Ka);var za=d(92),Fa=d(1292),ea=d(86);class la{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf){this.ji=!1;this.cea=this.F$b=this.Fja=this.K4a=null;this.oyg=()=>{this.K4a=null;if(this.g2i){l.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",
Ka[this.Zyc]);let Fg=null;this.m7e&&this.m7e.length&&(Fg={},Fg.etts=this.m7e);this.F$b.tC(14,Fg,!0);this.tKj(this.GMk)}else this.ylb.event(3)};this.Wpp=()=>{this.Fja=null;2===this.Zyc&&(this.ylb.event(1),l.ULS.shipAssertTag(573100185,502,!!this.K4a,"Missing task to ensure that we re-subscribe."))};this.Tma=()=>{this.MVm()};this.nS=(Fg,ah)=>{if(13===ah.type&&(Fg=ah.pA,l.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:Fg,
["DurationBeforeExpirationToResubscribeInSec"]:this.GLd}),ah=Fg.cts,!this.Nsp(ah))){if(Fg.sb){var Rg=2;this.tOo(Fg.cts)}else Rg=1,this.IQc=la.oJe,this.Fja&&(this.Gb.uf(this.Fja),this.Fja=null);this.ylb.event(Rg);this.K4a?this.Gb.l4(this.K4a,1E3*ah):this.tKj(ah)}};this.H5n=(Fg,ah)=>{Fg=ah.newState;const Rg=ah.Jmg,Dh={};Dh.NewState=Ka[Fg];Dh.PreviousState=Ka[Rg];Dh.PreviousStateHits=ah.Kmg;Dh.PreviousStateTransitionTime=ah.Lmg.toISOString();Dh.IsSubscribed=this.J2i;this.IQc!==la.oJe&&(Dh.SubscriptionExpiringTime=
this.IQc.toISOString());l.ULS.sendTraceTag(572346515,502,4===Fg?15:50,"HostNotificationChanged: {0}",Dh);this.sa.raiseEvent("HN",new ua(Rg,Fg))};this.IQc=la.oJe;this.sa=new ea.a;this.ylb=new Fa.a(0);this.ylb.Mgf(this.H5n);this.GMk=pa;this.GLd=Fb;this.FMk=Mb;this.m7e=Ic;this.Gb=ld;this.lf=Kd;ue.execute(Fg=>{this.ji||(this.F$b=Fg,this.F$b.TO(this.nS),this.start())});Ye.execute(Fg=>{this.ji||(this.cea=Fg,Fg.DTa(this.Tma))});this.EOd=Bf}get Zyc(){return this.ylb.currentState}get g2i(){return!this.lf||
this.lf.rCa}get J2i(){return 2===this.Zyc&&this.EOd()<this.IQc}start(){0!==this.Zyc?l.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",Ka[this.Zyc]):(this.ylb.event(1),this.oyg(null))}tKj(pa){this.K4a=za.a.Aaa(1E3*pa,this.oyg,this.GLd,192,"RtcHostNotificationSubscribe");this.Gb.Yb(this.K4a)}tOo(pa){pa=1E3*(pa+this.FMk);const Fb=this.EOd().getTime()+pa;this.IQc=new Date(Fb);pa-=this.GLd;this.Fja?this.Gb.l4(this.Fja,pa):(this.Fja=za.a.Aaa(pa,this.Wpp,this.GLd/
2,194,"RtcHostNotificationTransitionToPolling"),this.Gb.Yb(this.Fja))}MVm(){3===this.Zyc&&this.g2i&&(this.ylb.event(this.J2i?2:1),this.oyg(null))}Nsp(pa){if(!isNaN(pa)&&isFinite(pa)&&0<pa)return!1;this.OYj(!1);return!0}OYj(pa){this.K4a&&(this.Gb.uf(this.K4a),this.K4a=null);this.Fja&&(this.Gb.uf(this.Fja),this.Fja=null);this.F$b&&(this.F$b.MDa(this.nS),this.F$b=null);this.cea&&(this.cea.HZb(this.Tma),this.cea=null);pa||this.ylb.event(4)}dispose(){this.ji||(this.ji=!0,this.OYj(!0),this.Fja&&(this.Gb.uf(this.Fja),
this.Fja=null))}}la.oJe=new Date(0);Object(f.a)(la,"RtcHostNotificationSubscriptionManager",null,[867,11]);var Na=d(469);class Aa{constructor(){this.vi=this.ji=!1}get name(){return"RtcHostNotificationSubscription"}uc(pa){pa.register(la,1643).as(1642).ha().Sd(()=>{const Fb=m.AFrameworkApplication.J;return new la(Fb.fc("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),Fb.fc("RtcHostNotificationRetryIntervalBufferInSeconds",120),Fb.fc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.FKm(Fb),
m.AFrameworkApplication.oc,Na.SessionStatusManager.instance,pa.Ra(138),pa.Ra(723),()=>new Date)})}init(){m.AFrameworkApplication.J.xp(()=>{!this.ji&&m.AFrameworkApplication.J.$("RtcHostNotificationEnabled")&&(this.vi=!0,Ha.a.instance.resolve(1642))})}dispose(){this.ji||(this.ji=!0,this.vi&&Ha.a.instance.resolve(1643).dispose())}FKm(pa){return pa.my("RtcEventTypesToSubscribe")?pa.pD("RtcEventTypesToSubscribe"):null}static main(){fa.a.instance.Mc(new Aa)}}Object(f.a)(Aa,"RtcHostNotificationSubscriptionPackage",
null,[0,1]);var wa=d(479),va=d(642);class Pa{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf,Fg,ah){this.clientId=pa;this.SkypeChatThreadId=Mb;this.chatThreadDiscoveryUri=Ic;this.inChat=ld;this.localColbaltSessionId=Fb;this.capabilities=Kd;this.email=ue;this.isReadOnly=Ye;this.userName=Bf;this.isAnonymous=Fg;this.presenceStatus=ah}}Object(f.a)(Pa,"SerializablePresenceUserData",null,[]);class Ta extends wa.a{constructor(pa,Fb,Mb,Ic,ld=null,Kd=null,ue=null,Ye=null,Bf=null,Fg=!1,ah=!1,Rg=!1,Dh=null){super(pa,
Fb,Mb,Ic,Kd,ue,Ye,Bf,Fg,ah,Rg);this.YF=ld;this.presenceStatus=Dh}getData(){return new Pa(this.clientId,this.YF,this.pVc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}x8d(pa){return(pa=pa.value)?pa.user:null}clone(){return new Ta(this.clientId,this.userName,this.color,this.capabilities.clone(),this.YF,this.pVc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,
this.presenceStatus)}static KMb(pa){return pa.clientId?new Ta(pa.clientId,pa.userName,null,new va.a(void 0===pa.capabilities?0:pa.capabilities),pa.localColbaltSessionId,pa.SkypeChatThreadId,pa.email,null,pa.chatThreadDiscoveryUri,pa.isAnonymous,pa.inChat,pa.isReadOnly,pa.presenceStatus):null}static o$h(pa,Fb,Mb,Ic=null,ld=null,Kd=null,ue=null,Ye=null,Bf=!1,Fg=!1,ah=!1,Rg=null){return pa?new Ta(pa,Fb,null,new va.a(void 0===Mb?0:Mb),Ic,ld,Kd,ue,Ye,ah,Bf,Fg,Rg):null}}Object(f.a)(Ta,"PresenceUser",wa.a,
[1589,1590,799]);class kb extends Ta{constructor(){super();this.yuc=this.Y5f=null}VBm(){const pa=m.AFrameworkApplication.userName,Fb=m.AFrameworkApplication.J.jb("UserPrincipalName"),Mb=this.Y5f?this.Y5f.YF:null,Ic=m.AFrameworkApplication.g3b||m.AFrameworkApplication.Vta,ld=this.yuc?this.yuc.getStatus():null;return new Ta(this.clientId,pa,this.color,this.capabilities,Mb,this.pVc,Fb,this.client,this.chatThreadDiscoveryUri,Ic,this.inChat,this.isReadOnly,ld)}}Object(f.a)(kb,"MyPresenceUser",Ta,[1596,
799]);var gb=d(20),tb=d(65),hb=d(1018);class Xa{constructor(pa,Fb,Mb,Ic,ld){this.Ne=pa;this._clientId=Fb;this.vuk=ld;this.uyk=Mb||(()=>null);this.vyk=Ic||(()=>null)}get id(){return this.Ne.id}get yQd(){return this.Ne.yQd}get CQd(){return this.Ne.CQd}get BQd(){return this.Ne.BQd}get AQd(){return this.Ne.AQd}get zQd(){return this.Ne.zQd}get EQd(){return this.Ne.EQd}get Rdf(){return this.Ne.Rdf}get wyc(){return this.Ne.wyc}get rAe(){return this.Ne.rAe}get Jke(){return this.Ne.Jke}get clientId(){return this._clientId}get Elc(){return this.uyk}get jWa(){return this.vyk}get PWl(){return this.vuk}static createInstance(pa,
Fb,Mb,Ic,ld=!1){return new Xa(pa,Fb,Mb,Ic,ld)}}Object(f.a)(Xa,"PeoplesWellSettings",null,[]);var $a=d(108),La=d(77),bb=d(180),Gb=d(113),qb=d(208),Sa=d(226),cb=d(414),pb=d(340);class vb extends qb.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(f.a)(vb,"PeopleButtonProps",qb.a,[]);var xb=d(482),Bb=d(16),jc=d(94);class xc{constructor(pa){this.Ttd=new jc.a;this.zvf=null;this.clientId=
pa}F1o(pa){this.Uzo();this.VUo(pa);for(const Fb of pa)Fb.clientId!==this.clientId&&this.ePh(Fb)}get NNg(){const pa=[];for(const Fb of this.Ttd.values){const Mb=this.mLj(Fb);Array.add(pa,Mb)}return pa}get Hvb(){return this.Ttd.count}Sff(pa,Fb){pa=pa.toUpperCase();let Mb;({value:Mb}=this.Ttd.Ec(pa)).returnValue||(Mb=[],this.Ttd.W(pa,Mb));Array.add(Mb,Fb)}Uzo(){this.Ttd=new jc.a}VUo(pa){for(const Fb of pa)if(Fb.clientId===this.clientId){this.zvf=Fb;break}}}Object(f.a)(xc,"UserTracker",null,[1951]);class Qc extends xc{constructor(pa,
Fb){super(pa);this.wyk=Fb}ePh(pa){pa.isAnonymous||!pa.email?this.Sff(pa.clientId,pa):this.zvf&&H.a.vh().equals(this.zvf.email,pa.email)||this.Sff(pa.email,pa)}mLj(pa){let Fb=new Date(0),Mb=0<pa.length?pa[0]:null;for(const Ic of pa)(pa=this.wyk(Ic.clientId))&&Fb.getTime()<pa.vqc.getTime()&&(Fb=pa.vqc,Mb=Ic);return Mb}}Object(f.a)(Qc,"UniqueUserTracker",xc,[]);class fd extends xc{constructor(pa){super(pa)}ePh(pa){this.Sff(pa.clientId,pa)}mLj(pa){return pa[0]}}Object(f.a)(fd,"UserInstanceTracker",xc,
[]);const Ac=(pa,Fb,Mb)=>Mb?new Qc(pa,Fb):new fd(pa);var Nb=d(87),ib=d(1257),Rb=d(12);class ic{constructor(pa,Fb=null,Mb=null){this.pF=null;this.Gaf=new w.a;this.DYn=(Ic,ld,Kd,ue,Ye)=>{this.Gaf.IV(Ye.RenderTime);return 32};this.Ne=pa;this.Vpe=Fb;Mb&&Mb.continueWith(()=>{this.pF=Mb.result;this.pF.cdc(Object($a.a)(this,this.Lga,"onUsersUpdated"));this.zte()});new wa.a(this.settings.clientId,"Anonymous user","#cccccc",new va.a(7));this.vZf=this.KYe=!0;this.oUe=this.g4e=!1;this.ZEa=Ac(this.settings.clientId,
this.settings.jWa,pa.PWl)}get settings(){return this.Ne}get $hn(){return m.AFrameworkApplication.J?m.AFrameworkApplication.J.$("ColorPresenceHashIsEnabled"):!1}get Whn(){return m.AFrameworkApplication.J?m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}Kom(){let pa,Fb,Mb,Ic;var ld=this.Lom();this.ZEa.Hvb?1===this.ZEa.Hvb?(pa=!0,Fb=this.settings.wyc.cluster,Mb=this.settings.wyc.fZd,Ic=this.ZEa.NNg[0].color):(pa=!0,Fb=this.settings.Jke.cluster,Mb=this.settings.Jke.fZd,Ic=""):(pa=
!1,Ic=Mb=Fb="");const Kd=ld[0];ld=ld.slice(1);return{U8n:Kd,V8n:ld,Q8n:pa,diq:Fb,S8n:Mb,R8n:Ic}}Lom(){if(2<=this.ZEa.Hvb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.ZEa.Hvb)];if(1===this.ZEa.Hvb){const pa=this.ZEa.NNg[0],Fb=this.settings.jWa(pa.clientId);return Fb&&2===Fb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,pa.userName]:[pa.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,
pa.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}LRm(pa){return this.MRm(pa)}y_h(pa,Fb,Mb){return Fb?this.Dml(Fb)?(pa=this.settings.jWa(pa))&&2===pa.status?!1:!0:(Mb&&l.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(Mb&&l.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}fNm(pa){return pa.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}MRm(pa){if(!pa.capabilities.RKa(1))return this.fNm(pa);
const Fb=pa.isReadOnly,Mb=this.settings.jWa(pa.clientId);pa=this.settings.Elc(pa.clientId);if(!Mb)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(Mb.status){case 1:return pa?Fb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.cDl(pa)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}kxm(pa){if(this.Vpe.Bad)return this.Vpe.$Mb(pa.email,
"O365",m.AFrameworkApplication.xm,0)}yRm(pa){pa=this.settings.jWa(pa.clientId);return!pa||pa&&1===pa.status?!0:!1}BRm(pa){var Fb=String.format("buttonPeoplesWellUser-{0}",pa.clientId),Mb=pa.clientId,Ic=this.LRm(pa);const ld=pa.userName,Kd=pa.color;var ue=Object,Ye=ue.assign,Bf=new vb,Fg=this.settings.EQd.toString(),ah=this.settings.rAe.cluster,Rg=this.settings.rAe.fZd,Dh=this.nxi(),ej=pa.isAnonymous,ak;if(ak=[ld],ak.length){var df=new Sys.StringBuilder("STRARRY@");for(const dc of ak)df.append(dc?
dc.length:0),df.append(","),df.append(dc),df.append(",");ak=df.toString().slice(0,-1)}else ak=null;Fb=Ye.call(ue,Bf,{Id:Fb,Command:Fg,LabelText:"{0}",Image32by32:ah,Image32by32Class:Rg,MenuItemId:Mb,CommandValueId:Mb,Alt:ld,DisplayMode:Dh,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Ic,ImageBackColor:Kd,IsAnonymous:ej,LabelTextUserGeneratedPlaceholderReplacements:ak,Upn:pa.email});m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.Vpe&&(Mb=this.kxm(pa),Ic=this.yRm(pa),Fb.ImageUrl=Mb,Fb.ActiveStatus=Ic,Fb.JoinTimeInMS=pa.SXa,pa=this.y_h(pa.clientId,this.settings.Elc(pa.clientId),!1),Fb.CanJump=pa,""===Mb&&l.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return Fb}wvm(){return Object.assign(new qb.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}nxi(){return this.$hn?"Initials":
"Menu32"}CRm(pa){const Fb=[];for(const Mb of pa)pa=this.BRm(Mb),Array.add(Fb,pa);return Fb}Bde(){return 0<this.ZEa.Hvb}Kno(pa){if(!this.KYe)return!0;this.vZf||(pa[ib.a.Visible]=!0);const {U8n:Fb,V8n:Mb,Q8n:Ic,S8n:ld,R8n:Kd}=this.Kom();pa[ib.a.LabelText]=Fb;Mb&&Mb.length&&(pa[ib.a.LabelTextUserGeneratedPlaceholderReplacements]=Mb);pa[ib.a.ImageIsVisible]=Ic;pa[ib.a.Image16by16Class]=ld;pa[ib.a.ImageBackColor]=Kd;this.KYe=!1;return!0}Weo(pa){if(0>=this.ZEa.Hvb)return!1;var Fb=this.Bcp(this.ZEa.NNg),
Mb=this.CRm(Fb);Fb=Object.assign(new cb.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});Mb=Object.assign(new pb.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.nxi(),ControlList:Mb});m.AFrameworkApplication.J.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.Vpe&&(Mb.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,Mb.TitleId="menuCoauthorsTitle",Mb.Theme="Light");Array.add(Fb.MenuSectionList,Mb);m.AFrameworkApplication.J.$("DocChatIsEnabled")&&m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")&&
m.AFrameworkApplication.ta&&m.AFrameworkApplication.ta.Hb.Cs&&(Mb=[],Array.add(Mb,this.wvm()),Mb=Object.assign(new pb.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:Mb}),Array.add(Fb.MenuSectionList,Mb));m.AFrameworkApplication.ta&&m.AFrameworkApplication.ta.Hb.Cs?pa.MenuItems=Fb:pa.PopulationXML=Sa.o(Fb);return!0}KNg(pa){l.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");pa=pa.MenuItemId;if(!pa)return!1;const Fb=this.settings.Elc(pa);if(!this.y_h(pa,Fb,
!0))return!1;this.Xxn(Fb);return!0}puo(){const pa=this.Eim();this.ZEa.F1o(pa);this.vZf&&1<=this.ZEa.Hvb&&(l.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.vZf=!1);this.KYe=!0}Lga(){this.oUe||(window.setTimeout(()=>{this.zte();this.oUe=!1},3E3),this.oUe=!0)}Eim(){let pa;pa=this.Dim()||[];for(const Fb of pa)this.VMo(Fb);return pa}VMo(pa){pa.clientId||(pa.clientId=E.a.create().toString());pa.userName||(pa.userName="Anonymous user");pa.capabilities||(pa.capabilities=
new va.a);pa.color||(pa.color="#cccccc");pa.SXa||(pa.SXa=0)}Bcp(pa){const Fb=[];Array.addRange(Fb,pa);Fb.sort(ic.A8n);return Fb}Txo(){m.AFrameworkApplication.J.$("CoauthorGalleryTelemetryIsEnabled")&&!this.g4e&&(m.AFrameworkApplication.va.V2(Rb.a.m4h)&&xb.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||m.AFrameworkApplication.va.fb(Rb.a.m4h,Nb.a.frame,this.DYn,96));this.Uxo();this.g4e=!0;this.zte()}get r1j(){return this.Gaf.task}zte(){if(!this.g4e&&
(this.Gaf.IV((new Date).getTime()),l.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.Whn))return;this.puo();this.quo()}dispose(){this.pF&&(this.pF.xtg(Object($a.a)(this,this.Lga,"onUsersUpdated")),this.pF=null)}static A8n(pa,Fb){return pa.capabilities.RKa(1)&&Fb.capabilities.RKa(1)||!pa.capabilities.RKa(1)&&!Fb.capabilities.RKa(1)?Bb.a.localeCompare(pa.userName,Fb.userName):pa.capabilities.RKa(1)?-1:1}}Object(f.a)(ic,
"APeoplesWell",null,[1892,11]);var kc=d(11);const Jb=()=>!0;class ec extends ic{constructor(pa,Fb,Mb=null,Ic=null){super(pa,Mb,Ic);this.Qin=(ld,Kd,ue,Ye,Bf)=>this.n$a(ue,Bf,()=>this.Bde(),Jb);this.Lno=(ld,Kd,ue,Ye,Bf)=>this.n$a(ue,Bf,Fg=>this.Kno(Fg),Jb);this.Xeo=(ld,Kd,ue,Ye,Bf)=>this.n$a(ue,Bf,Jb,Fg=>this.Weo(Fg));this.Lwl=(ld,Kd,ue,Ye,Bf)=>this.n$a(ue,Bf,Jb,Jb);this.Kwl=(ld,Kd,ue,Ye,Bf)=>this.n$a(ue,Bf,Jb,Jb);this.$Ep=(ld,Kd,ue,Ye,Bf)=>this.n$a(ue,Bf,Jb,Fg=>this.KNg(Fg));this.Bco=(ld,Kd,ue,Ye,
Bf)=>this.n$a(ue,Bf,Jb,()=>{this.zte();return!0});this.ga=Fb}n$a(pa,Fb,Mb,Ic){let ld=!1;switch(pa){case 1:ld=Mb(Fb);break;case 2:ld=Ic(Fb)}return ld?32:8}Uxo(){this.ga.qa(this.settings.yQd,kc.a.application,this.Qin);this.ga.fb(this.settings.CQd,kc.a.application,this.Lno,96);this.ga.fb(this.settings.AQd,kc.a.application,this.Lwl,96);this.ga.fb(this.settings.zQd,kc.a.application,this.Kwl,96);this.ga.fb(this.settings.BQd,kc.a.application,this.Xeo,96);this.ga.qa(this.settings.EQd,kc.a.application,this.$Ep);
this.ga.fb(this.settings.Rdf,kc.a.application,this.Bco,96)}}Object(f.a)(ec,"ABox4PeoplesWell",ic,[]);var qa=d(3),sa=d(119),ab=d(49),eb=d(7),fb=d(25),Cb=d(165);class lc{static isSupported(pa){for(let Fb=0;Fb<lc.SZj.length;Fb++)if(pa===lc.SZj[Fb])return!0;return!1}}lc.SZj=[1];Object(f.a)(lc,"RTTDataVersion",null,[]);var bc=d(1591);const Za=pa=>{if("number"!==typeof pa.RK||"number"!==typeof pa.DK)return!1;let Fb,Mb=!1,Ic=!1,ld=!1;switch(pa.RK){case 0:Ic=Fb=!0;break;case 1:ld=Mb=Ic=Fb=!0;break;case 2:if(null!=
pa.PE&&"number"!==typeof pa.PE)return!1;Fb=!0;break;case 4:Fb=!0;break;case 3:Ic=Fb=!0;break;case 5:Mb=Fb=!0;break;default:return!1}return Fb&&("number"!==typeof pa.PS||"number"!==typeof pa.TS)||Ic&&("object"!==typeof pa.OS||!pa.OS||!bc.validateVersionedCpData(pa.OS))||Mb&&("number"!==typeof pa.PE||"number"!==typeof pa.TE)||ld&&("object"!==typeof pa.OE||!pa.OE||!bc.validateVersionedCpData(pa.OE))?!1:!0},Ib=pa=>{let Fb="";if("number"!==typeof pa.I)return{returnValue:!1,Wla:"Invalid PacketId Type"};
if("number"!==typeof pa.O)return{returnValue:!1,Wla:"Invalid Operation Type"};if("string"!==typeof pa.A)return{returnValue:!1,Wla:"Invalid ClientId Type"};if("object"!==typeof pa.AN)return{returnValue:!1,Wla:"Invalid Anchor Object Type"};if(!pa.AN)return{returnValue:!1,Wla:"Null AnchorObject"};if(!Za(pa.AN)){let Mb;try{Mb=W.c(pa.AN)}catch(Ic){Mb=String.format("Failed to JSON-serialize payload : {0}",Ic)}8E3<Mb.length&&(Mb=String.format("Payload exceeds maximum length: {0} > {1}, not logging",Mb.length,
8E3));Fb="Invalid AnchorObject: "+Mb+", Client: "+pa.C;return{returnValue:!1,Wla:Fb}}return!pa.O&&pa.AN.RK?(Fb="Invalid RangeKind:"+pa.AN.RK+" for Caret",{returnValue:!1,Wla:Fb}):2===pa.O&&("number"!==typeof pa.TF||"undefined"!==typeof pa.TX&&"string"!==typeof pa.TX||1!==pa.AN.RK&&pa.AN.RK)?{returnValue:!1,Wla:"Invalid TypingData"}:3!==pa.O||"object"===typeof pa.AP&&pa.AP&&"number"===typeof pa.AP.TFA&&"number"===typeof pa.AP.PN&&"number"===typeof pa.AP.TN&&2===pa.AN.RK?6!==pa.O||"object"===typeof pa.MP&&
pa.MP&&"number"===typeof pa.MP.PM&&"number"===typeof pa.MP.TM&&5===pa.AN.RK?4!==pa.O||"object"===typeof pa.SP&&pa.SP&&"number"===typeof pa.SP.PA&&"number"===typeof pa.SP.TA&&"number"===typeof pa.SP.PB&&"number"===typeof pa.SP.TBS&&3===pa.AN.RK&&(pa.AN.PS===pa.SP.PA||pa.AN.PS===pa.SP.PB)?7!==pa.O||"object"===typeof pa.SPS&&pa.SPS&&"string"===typeof pa.SPS.SF&&"boolean"===typeof pa.SPS.SL?null!=pa.ISS&&"number"!==typeof pa.ISS?{returnValue:!1,Wla:"invalid StrictlySequentialId"}:{returnValue:!0,Wla:Fb}:
{returnValue:!1,Wla:"Invalid SymbolData"}:{returnValue:!1,Wla:"Invalid SplitParaData"}:{returnValue:!1,Wla:"Invalid RemoveParaData"}:{returnValue:!1,Wla:"Invalid AddParaData"}};var Ub=d(1546);class rc{constructor(pa,Fb=null,Mb=null){this.I4=this.vjg=this.wIg=null;null!=pa&&(this.wIg=pa);null!=Fb&&(this.vjg=Fb);null!=Mb&&(this.I4=Mb)}}Object(f.a)(rc,"AddParaData",null,[]);class yc{constructor(pa=null,Fb=null){this.Nzc=this.ujg=null;null!=pa&&(this.ujg=pa);null!=Fb&&(this.Nzc=Fb)}}Object(f.a)(yc,"MergeRemoveParaData",
null,[]);class rb{constructor(pa,Fb,Mb,Ic,ld,Kd,ue=null,Ye=null,Bf=null,Fg=null,ah=null,Rg=null,Dh=0,ej=null){this.Zqd=this.text=this.R1b=this.j1b=this.Cdd=this.Mcc=this.toa=null;this.packetId=pa;this.client=Mb;this.operationType=Ic;this.clientId=Fb.toLowerCase();this.JW=ld;this.version=Dh;Kd&&(this.toa=Kd);null!=ue&&(this.R1b=ue);void 0!==Ye&&null!==Ye&&(this.text=Ye);Bf&&(this.Mcc=Bf);Fg&&(this.Cdd=Fg);ah&&(this.j1b=ah);Rg&&(this.Zqd=Rg);this.strictlySequentialId=ej}}Object(f.a)(rb,"RTTData",null,
[]);class $c{constructor(pa=null,Fb=null,Mb=null,Ic=null){this.vIg=this.tjg=this.sIg=this.sjg=null;null!=pa&&(this.sjg=pa);null!=Fb&&(this.sIg=Fb);null!=Mb&&(this.tjg=Mb);null!=Ic&&(this.vIg=Ic)}}Object(f.a)($c,"SplitParaData",null,[]);class cd{constructor(pa=null,Fb=null){this.XGg=this.WGg=null;pa&&(this.WGg=pa);null!=Fb&&(this.XGg=Fb)}}Object(f.a)(cd,"SymbolData",null,[]);class Rd{constructor(pa,Fb=null,Mb=null){null!=pa&&(this.TFA=pa);null!=Fb&&(this.PN=Fb);null!=Mb&&(this.TN=Mb)}}Object(f.a)(Rd,
"SerializableAddParaDataV1",null,[]);class ge{constructor(pa=null,Fb=null){null!=pa&&(this.PM=pa);null!=Fb&&(this.TM=Fb)}}Object(f.a)(ge,"SerializableMergeRemoveParaDataV1",null,[]);class Ze{}Object(f.a)(Ze,"SerializableRTTDataV1",null,[]);class De{constructor(pa=null,Fb=null,Mb=null,Ic=null){null!=pa&&(this.PA=pa);null!=Fb&&(this.TA=Fb);null!=Mb&&(this.PB=Mb);null!=Ic&&(this.TBS=Ic)}}Object(f.a)(De,"SerializableSplitParaDataV1",null,[]);class Df{constructor(pa=null,Fb=null){pa&&(this.SF=pa);null!=
Fb&&(this.SL=Fb)}}Object(f.a)(Df,"SerializableSymbolDataV1",null,[]);const zd=pa=>{var Fb;if(!({Wla:Fb}=Ib(pa)).returnValue)return l.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",Fb),null;let Mb=Fb=null,Ic=null,ld=null,Kd=null,ue=null,Ye=null,Bf=null;pa.WD&&(Fb=pa.WD);null!=pa.TF&&(Mb=pa.TF);void 0!==pa.TX&&null!==pa.TX&&(Ic=pa.TX);pa.AP&&(ld=new rc(pa.AP.TFA,pa.AP.PN,pa.AP.TN));pa.MP&&(Kd=new yc(pa.MP.PM,pa.MP.TM));pa.SP&&(ue=new $c(pa.SP.PA,pa.SP.TA,pa.SP.PB,
pa.SP.TBS));pa.SPS&&(Ye=new cd(pa.SPS.SF,pa.SPS.SL));null!=pa.ISS&&(Bf=pa.ISS);return new rb(pa.I,pa.A,pa.C,pa.O,Ub.a(pa.AN),Fb,Mb,Ic,ld,Kd,ue,Ye,1,Bf)},hg=pa=>{let Fb=pa;if("number"===typeof Fb.V){if(1===Fb.V)return zd(pa);l.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let Mb=0,Ic=null;for(let ld=0;ld<pa.length;ld++)Fb=pa[ld],lc.isSupported(Fb.V)&&Fb.V>Mb&&(Mb=Fb.V,Ic=pa[ld]);return 1===Mb?zd(Ic):null},ni=pa=>{if(pa){const Fb=new Ze;Fb.I=pa.packetId;Fb.V=1;Fb.A=pa.clientId;
Fb.C=pa.client;Fb.O=pa.operationType;Fb.AN=Ub.c(pa.JW);pa.toa&&(Fb.WD=pa.toa);null!=pa.R1b&&(Fb.TF=pa.R1b);void 0!==pa.text&&null!==pa.text&&0<pa.text.length&&(Fb.TX=pa.text);pa.Mcc&&(Fb.AP=new Rd(pa.Mcc.wIg,pa.Mcc.vjg,pa.Mcc.I4));pa.Cdd&&(Fb.MP=new ge(pa.Cdd.ujg,pa.Cdd.Nzc));pa.j1b&&(Fb.SP=new De(pa.j1b.sjg,pa.j1b.sIg,pa.j1b.tjg,pa.j1b.vIg));pa.Zqd&&(Fb.SPS=new Df(pa.Zqd.WGg,pa.Zqd.XGg));Fb.ISS=pa.strictlySequentialId;pa=Fb}else pa=null;return pa};var Fd=d(46);class Uc{constructor(pa,Fb,Mb,Ic,ld,
Kd,ue,Ye,Bf){this.LocalCobaltSessionId=pa;this.SkypeChatThreadId=Fb;this.ChatThreadDiscoveryUri=Mb;this.InChat=Ic;this.Capabilities=ld;this.Email=Kd;this.UserName=ue;this.IsAnonymous=Ye;this.PresenceStatus=Bf}}Object(f.a)(Uc,"SerializableWacData",null,[]);class pd{constructor(){this.hNd=this.gNd=0}MCm(){this.hNd===Number.MAX_VALUE&&(this.hNd=0);this.hNd++;return this.hNd}LCm(){this.gNd===Number.MAX_VALUE&&(this.gNd=0);this.gNd++;return this.gNd}static get instance(){return pd.nPk}}pd.nPk=new pd;Object(f.a)(pd,
"StrictlySequentialIdGenerator",null,[869]);var He=d(1445);class rf{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye=0){this.Rxa=null;this.dryDeletion=0;this.cL=pa;this.iSa=Kd;this.zd=ld;this.TJb=ue;this.Zc=Fb;this.shapeId=Ye;this.dNa=Mb;this.hca=ue.create(this,Ic,ld,Kd)}clone(){return new rf(this.cL,this.Zc,this.dNa,this.hca.C3b,this.zd,this.iSa,this.TJb,this.shapeId)}get paragraphId(){return this.Rxa?this.Rxa:this.cL.irb(this.Zc)}Rgg(){this.Rxa||(this.Rxa=this.paragraphId,this.hca.Rgg())}isValid(){return 0<=
this.hca.cp}getData(){const pa=this.hca.C3b;return pa?new He.a(0,this.Zc,this.dNa,pa,null,null,null,0,this.shapeId):null}static KMb(pa,Fb,Mb,Ic,ld){return Fb?new rf(Fb,parseInt(pa.fZa),pa.nfb,pa.eV,Mb,Ic,ld,pa.shapeId):null}}Object(f.a)(rf,"WordPresenceIp",null,[873,218,874]);class Rf{constructor(pa,Fb,Mb){this.W_a=this.hga=this.ILc=!1;this.lkb=pa;this.d3a=Mb;this.user=Fb}get ip(){return this.d3a}get Brc(){return this.ILc}set Brc(pa){(this.ILc=pa)&&this.ip.Rgg()}bOf(){const pa=pd.instance.LCm();return new rb(this.lkb,
this.user.clientId,1,0,this.ip?this.ip.getData():null,new Uc(this.user.YF,this.user.pVc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,pa)}ozi(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():Fd.a.nil.toString())}isValid(){const pa=!!this.user&&this.user.isValid(),Fb=!this.ip||this.ip.isValid();return pa&&Fb}clone(){const pa=
new Rf;pa.lkb=this.lkb;pa.ILc=this.ILc;pa.user=this.user?this.user.clone():null;pa.d3a=this.ip?this.ip.clone():null;pa.hga=this.hga;pa.W_a=this.W_a;return pa}static ttf(pa,Fb,Mb,Ic,ld){if(!pa||!Fb)return null;if(pa.operationType)return l.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",pa.operationType),null;let Kd;Kd=void 0!==pa.toa&&null!==pa.toa?Ta.o$h(pa.clientId,pa.toa.UserName,pa.toa.Capabilities,pa.toa.LocalCobaltSessionId,pa.toa.SkypeChatThreadId,pa.toa.Email,
pa.client,pa.toa.ChatThreadDiscoveryUri,pa.toa.InChat,!1,pa.toa.IsAnonymous,pa.toa.PresenceStatus):Ta.o$h(pa.clientId,null,0,void 0,void 0,void 0,pa.client);return new Rf(pa.packetId,Kd,rf.KMb(pa.JW,Fb,Mb,Ic,ld))}}Object(f.a)(Rf,"WordPresenceInfo",null,[868,218]);class kd extends ec{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf,Fg,ah,Rg,Dh,ej){super(pa,Kd,ej,Fb);this.Mqk=Mb;this.QMk=Ic;this.hLk=ld;this.ib=ue;kd.Sy=Ye;this.cL=Bf;this.zd=Fg;this.iSa=ah;this.rdf=Rg;this.jQa=Dh}KNg(pa){this.jQa.d5i(pa.CommandValueId);
return super.KNg(pa)}Xxn(pa){let Fb;({tmg:Fb}=this.m0f(pa)).returnValue&&(this.QMk(Fb.ip.paragraphId,Fb.ip.hca.cp),m.AFrameworkApplication.J.$("WordEditorMoveIpToUserLocationIsEnabled")&&(pa=kd.ILm(Fb),void 0!==pa&&null!==pa?(l.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.ib.Kc(pa),La.FocusManager.BM()&&La.FocusManager.instance().Eg(bb.AFrame.Jo)):l.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),
pa=new za.a(2,1,0,()=>{this.ga.Pb(qa.a.Rze,2,Fb)}),Gb.a.instance.Yb(pa))}UEi(pa){return pa?(pa=Rf.ttf(hg(pa),this.cL,this.zd,this.iSa,this.rdf.instance))&&pa.isValid()&&pa.ip?pa:null:null}Dml(pa){return this.zrn(pa)?this.Uml(pa)?!0:(l.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(l.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}zrn(pa){return!!this.UEi(pa)}m0f(pa){pa=this.UEi(pa);
return{returnValue:!!pa,tmg:pa}}Uml(pa){let Fb;return({tmg:Fb}=this.m0f(pa)).returnValue?this.Mqk(Fb.ip.paragraphId,Fb.ip.hca.cp):!1}Dim(){if(!this.pF)return[];const pa=[];for(const Fb of this.pF.yqb())Fb.userName?pa.push(Fb):l.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return pa}cDl(pa){let Fb;return({tmg:Fb}=this.m0f(pa)).returnValue&&Fb.user&&Fb.user.presenceStatus&&"0"!==Fb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,Fb.user.presenceStatus):
CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}quo(){this.hLk(this.settings.id)}static createInstance(pa,Fb,Mb,Ic,ld,Kd,ue){const Ye=gb.StaticActiveAppFrame.za().kb,Bf=m.AFrameworkApplication.va,Fg=ab.a.instance,ah=Ha.a.instance.resolve(427);return new kd(pa,Fb,Rg=>Ye.Jc.jj?Ye.Jc.Cnf(Rg,!0):!1,(Rg,Dh)=>{Ye.Jc.jj&&Ye.Jc.y_b(Rg,Dh,!0,!0,!1,!1)},()=>{sa.a.NB.MJ.mtd()},Bf,Fg,Ye,Mb,Ic,ld,Kd,ah,ue)}static ILm(pa){const Fb=kd.Sy.ed.ud.Eb(pa.ip.paragraphId);if(void 0===Fb||null===Fb)return l.ULS.sendTraceTag(20764576,
325,15,"The node could not be obtained"),null;if(!eb.ParagraphReader.Vb(Fb))return l.ULS.sendTraceTag(20764577,325,15,"The obtained node is not a paragraph node"),null;pa=fb.a.Tc(Fb,pa.ip.hca.cp);return new Cb.Selection([pa],!0)}}kd.Sy=null;Object(f.a)(kd,"WordEditorPeoplesWell",ec,[]);class ff{constructor(){this.nz=()=>{m.AFrameworkApplication.Xsj?ff.mva.oD().continueWith(this.Qfd):l.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};
this.Qfd=()=>{ff.Zh=ff.mva.oD().result;if(ff.Zh){var pa=()=>{const Fb=gb.StaticActiveAppFrame.za().kb;return Fb?Fb.ed?Fb.ed.ud:(l.ULS.sendTraceTag(23196876,325,15,"ActivePage is null"),null):(l.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};tb.a.Rsa().continueWith(()=>{const Fb=tb.a.Rsa().result.Ej,Mb=hb.a.GGm(m.AFrameworkApplication.Vs,m.AFrameworkApplication.Vs,m.AFrameworkApplication.Vs,m.AFrameworkApplication.Vs),Ic=Xa.createInstance(Mb,Fb,Object($a.a)(ff.Zh.Ive,ff.Zh.Ive.Elc,"getUserPresence"),
Object($a.a)(ff.Zh.Ive,ff.Zh.Ive.jWa,"getUserStatusInfo"),m.AFrameworkApplication.J.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));Ha.a.instance.ia("RealtimePresenceUI.WordEditorPeoplesWell",()=>kd.createInstance(Ic,Wa.a.iq(ff.Z.Ra(615)),ff.Z.Oa(442),ff.Z.Oa(1235),pa,ff.Z.Ra(1644),ff.Z.resolve(142))).as(1636).ha();ff._instance=Ha.a.instance.resolve(1636);ff._instance.Txo();l.ULS.sendTraceTag(23196877,325,50,"PeoplesWellControl is fully initialized")})}else l.ULS.sendTraceTag(23196873,325,
15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}uc(pa){ff.Z=pa}init(){m.AFrameworkApplication.J.xp(this.nz)}dispose(){ff._instance&&(ff._instance.dispose(),ff._instance=null)}static get mva(){return null!=ff.F3g?ff.F3g:ff.F3g=Ha.a.instance.resolve(545)}}ff._instance=null;ff.Z=null;ff.Zh=null;Object(f.a)(ff,"WordEditorPeoplesWellControlPackage",null,[0,1]);var Te=d(102),xe=d(260);class jf{constructor(pa,Fb,Mb,Ic,
ld,Kd,ue,Ye,Bf=!1){this.Kgb=null;this.DSe=!0;this.N4e=this.gl=this.jLe=null;this.sa=new ea.a;this.$7m=()=>{this.HO.result&&this.jAh.result&&(this.gl=this.HO.result,this.N4e=this.jAh.result,this.gl.Wya(this.gV),this.jLe=new za.a(2,2,this.b$g,this.Nwp,88),jf.Gb.Yb(this.jLe))};this.gV=(Fg,ah)=>{(this.DSe||this.Tqo(ah.hia))&&jf.Gb.l4(this.jLe,0)};this.Nwp=Fg=>{var ah=this.gl.zjc();if(ah){var Rg=new Date,Dh=!1;if(this.DSe){this.Kgb=ah;this.DSe=!1;var ej=this.Kgb;for(var ak in ej){ah=ak;var df=ej[ak];df.vqc<
Rg&&(Rg=df.vqc);2===df.status&&(Dh=!0,this.N4e.Qkd(ah))}Dh&&this.Kyj();jf.Gb.l4(Fg,this.ECi(Rg))}else{df=new R.a;ak=!1;var dc=this.Kgb;for(ej in dc){dc=ej;if(!(dc in this.Kgb)||this.cSa.clientId===dc)continue;var zc=this.Kgb[dc];const je=ah[dc];if(zc&&je){zc=zc.status;const Le=je.status;2===zc&&1===Le?(df.add(dc),l.ULS.sendTraceTag(38052609,392,50,dc+" returned from away")):1===zc&&2===Le&&(ak=Dh=!0,this.N4e.Qkd(dc),l.ULS.sendTraceTag(38052610,392,50,dc+" went away"));1===Le&&je.vqc<Rg&&(Rg=je.vqc)}}this.Kgb=
ah;jf.Gb.l4(Fg,this.ECi(Rg));(0<df.count||Dh)&&this.Kyj();0<df.count&&!this.rLk?(Fg=this.Xmm(df),this.qnp(Fg)):Fg=new R.a;(ak||0<Fg.count)&&this.jKk(Rb.a.rWd,2)}}};this.cSa=pa;this.HO=Fb;this.jAh=Mb;this.cOc=Ic;this.b$g=Kd;jf.Gb=ld;this.jKk=ue;this.t$=Ye;this.rLk=Bf;F.Task.WAA(Fb,Mb).continueWith(this.$7m)}L3k(pa){this.sa.addHandler("u",pa)}Kyj(){this.sa.raiseEvent("u",null,this)}Tqo(pa){for(const Mb in pa){var Fb=this.cOc.x8d({key:Mb,value:pa[Mb]});if(Fb&&Fb.clientId&&(Fb=Fb.clientId.toLowerCase(),
(Fb=this.Kgb[Fb]||this.Kgb[Fb.toUpperCase()])&&2===Fb.status))return!0}return!1}qnp(pa){if(pa.count)for(const Fb of pa)pa=this.t$.zka(String.format(CommonUIStrings.l_EditorsToastArriving,Fb),!1),pa.image=5,pa.Ola="CoAuth_AuthorStatus_16x16x32",this.t$.Pz(pa)}Xmm(pa){const Fb=this.gl.xqb(),Mb=new R.a;for(const Ic in Fb){const ld={key:Ic,value:Fb[Ic]};if(pa.contains(ld.key)){const Kd=this.cOc.x8d(ld);Kd&&(Mb.add(Kd.userName),pa.remove(ld.key))}}Mb.count||l.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");
return Mb}ECi(pa){const Fb=new Date;return Math.max(pa.getTime()+this.b$g-Fb.getTime(),0)}}jf.Gb=null;Object(f.a)(jf,"AwayManager",null,[]);var Gg=d(782);class ng{constructor(pa=0){this.updates=pa}get VSf(){return 0!==this.updates}RKa(pa){return!!(this.updates&pa)}ieb(pa){this.updates|=pa}toString(){if(this.RKa(0))return"none";const pa=new R.a;this.RKa(1)&&pa.add("user(s) joined");this.RKa(2)&&pa.add("user(s) disconnected");this.RKa(4)&&pa.add("user(s) updated");return pa.toArray().join(", ")}}Object(f.a)(ng,
"UserUpdateEvent",null,[]);var pg=d(24);class dh{constructor(pa,Fb,Mb,Ic,ld=null){this.sa=new ea.a;this.MM=this.Zh=null;this.Hvh=this.hwh=this.jm=!1;this.er=new jc.a;this.hNg=()=>{if(this.Zh){var Kd=!1,ue=this.Zh.zjc();for(const Bf in ue){var Ye=ue[Bf];const Fg=Bf;this.users.mb(Fg)&&(Ye=this.d3j(Ye),Kd=this.users.K(Fg).$Lb!==Ye||Kd,this.users.K(Fg).$Lb=Ye)}Kd&&(Kd=new ng(4),this.Nwe(Kd))}};this.coj=(Kd,ue)=>{2===ue.newState&&(Kd=this.h9f(this.Zh.xqb()),Kd.VSf&&this.Nwe(Kd))};this.ffd=(Kd,ue)=>{Kd=
new ng;var Ye=this.MM.Y1c();l.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",Ye.length,ue.pWn,ue.Vgj);const Bf=new jc.a;for(var Fg of Ye){Ye=Fg.Id;const ah=this.Abi(Ye);this.gNg(Kd,ah);Bf.W(Ye,ah)}if((ue=ue.d4f)&&0<ue.length)for(Fg=0;Fg<ue.length;Fg++)l.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,
ue.K(Fg).Id),({value:Ye}=this.users.Ec(ue.K(Fg).Id)).returnValue?Ye?(this.users.remove(ue.K(Fg).Id),Kd.ieb(2),Bf.W(ue.K(Fg).Id,Ye)):l.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",ue.K(Fg).Id):l.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",ue.K(Fg).Id);ue=this.Zh.xqb();for(const ah in ue)Fg=this.cOc.x8d({key:ah,value:ue[ah]}),Bf.W(Fg.clientId,Fg);for(const ah of this.users)Bf.mb(ah.value.clientId)||(l.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",
ah.key),this.users.remove(ah.key),Kd.ieb(2));Kd.VSf&&this.Nwe(Kd)};this.eoj=(Kd,ue)=>{Kd=this.h9f(ue.hia);for(const Ye of ue.xZc)this.users.mb(Ye)&&(Kd.ieb(2),this.users.K(Ye).$Lb=2);Kd.VSf&&this.Nwe(Kd)};pa.continueWith(()=>{this.Zh=pa.result;this.Zh.Wya(this.eoj);this.Zh.a_(this.coj);this.hNg(null,null)});Fb.continueWith(()=>{this.MM=Fb.result;this.MM.rmb(this.ffd)});ld&&ld.continueWith(()=>{ld.result.L3k(this.hNg);this.hNg(null,null)});this.vSa=Mb;this.cOc=Ic}get users(){return this.er}cdc(pa){this.sa.addHandler("UU",
pa)}xtg(pa){this.sa.removeHandler("UU",pa)}d3j(pa){return 1===pa.status?0:1}yqb(){this.users.count||(this.hwh||(pg.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.hwh=!0),this.wfo());const pa=[];for(const Fb of this.users)Array.add(pa,Fb.value);return pa}wfo(){if(this.Zh){var pa=this.Zh.xqb();this.h9f(pa)}if(this.MM){pa=this.MM.Y1c();for(const Fb of pa)Fb.Id&&(pa=this.Abi(Fb.Id),this.gNg(new ng,pa))}}p7f(pa){({value:pa}=this.users.Ec(pa));return pa}dispose(){this.jm||
(this.Zh&&(this.Zh.b_a(this.eoj),this.Zh.KDa(this.coj)),this.MM&&this.MM.ZDj(this.ffd),this.jm=!0)}h9f(pa){const Fb=new ng;if(!pa)return Fb;for(const Ic in pa){var Mb=this.cOc.x8d({key:Ic,value:pa[Ic]});Mb&&(Mb=Mb.clone(),this.gNg(Fb,Mb))}return Fb}gNg(pa,Fb){if(Fb){var Mb=Fb.clientId,Ic=this.rJo(Fb);({value:Fb}=this.users.Ec(Mb)).returnValue?Fb.equals(Ic)||(pa.ieb(4),this.users.W(Mb,Ic)):(l.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,Mb),pa.ieb(1),
this.users.W(Mb,Ic))}}Abi(pa){return this.users.mb(pa)?this.users.K(pa):wa.a.iHl(pa)}rJo(pa){if(!pa||!pa.clientId||!this.MM)return pa;const Fb=pa.clone();Fb.$Lb=this.Wmm(pa);if(pa=this.MM.Qjc(Fb.clientId))Fb.isReadOnly=Fb.isReadOnly||pa.IsReadOnly?!0:!1,Fb.userName=this.qJo(Fb,pa),Fb.capabilities=this.FOn(Fb.capabilities,pa.Capabilities),Fb.email=Fb.email||pa.SIPAddress||pa.EmailAddress,pa.JoinCoauthTime&&(Fb.SXa=pa.JoinCoauthTime);Fb.color=this.vSa.Dlc(new Gg.a(Fb.email,void 0,Fb.userName,void 0,
Fb.isAnonymous,Fb.clientId),3);return Fb}Wmm(pa){if(!this.Zh)return 2;if(pa&&pa.clientId){const Fb=this.Zh.zjc();if(pa.clientId in Fb)return this.d3j(Fb[pa.clientId])}return 2}vyl(pa,Fb){Fb.Name&&pa.userName&&Fb.Name!==pa.userName&&!this.Hvh&&(this.Hvh=!0,pg.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}FOn(pa,Fb){pa=pa||new va.a;Fb&&(Fb.SupportsRealtimeChannel&&pa.ieb(1),Fb.SupportsRename&&pa.ieb(2),Fb.SupportsChat&&pa.ieb(4));return pa}qJo(pa,Fb){this.vyl(pa,Fb);return Fb.Name||
pa.userName||(pa.isAnonymous||Fb.IsAnonymous?CommonUIStrings.l_GuestUserName:null)}Nwe(pa){l.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",pa.toString());this.sa.raiseEvent("UU")}}Object(f.a)(dh,"PeopleInfoProvider",null,[1932,11]);var Hg;(function(pa){pa[pa.QRn=0]="multipleBrowsersImageClassName";pa[pa.zco=1]="peopleImageClassName";pa[pa.Aco=4]="peopleImageClusterPath";pa[pa.PRn=5]="multipleBrowserImageClusterPath";pa[pa.eSb=6]="imageDimension";pa[pa.rtl=8]="rtl";pa[pa.thd=
9]="pointerInputManager";pa[pa.k_=10]="clickInputManager";pa[pa.vertical=11]="vertical";pa[pa.zIndex=12]="zIndex";pa[pa.$Wc=13]="contextMenuInputManager";pa[pa.P6p=14]="imageDomElement";pa[pa.psq=15]="useIdleTooltip";pa[pa.rHp=16]="viewportBoundsCallback";pa[pa.l3p=17]="flipHorizontalDirection";pa[pa.g3p=18]="fixRemoveFadeOutElementCrash";pa[pa.b5m=19]="ignoreEventOnExpandedTooltip";pa[pa.Bfn=20]="ipWidthAdjustForFlyout"})(Hg||(Hg={}));Object(f.b)("PresenceTooltipSettingKeys",Hg);class Zj{constructor(){this.aw=
{}}get(pa,Fb=null){pa=Hg[pa];return"number"===typeof Fb?(Fb=this.aw[pa])?Number.parseInvariant(Fb.toString()):0:this.aw[pa]}add(pa,Fb){this.aw[Hg[pa]]=Fb}BTa(pa,Fb){Hg[pa]in this.aw||(this.aw[Hg[pa]]=Fb)}remove(pa){delete this.aw[Hg[pa]]}}Object(f.a)(Zj,"PresenceTooltipSettings",null,[]);class nh extends ea.a{constructor(pa){super();this._element=null;this.element=pa}get element(){return this._element}set element(pa){this._element=pa}get visible(){return"visible"===this.element.style.visibility}set visible(pa){this.element.style.visibility=
pa?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(pa){this.element.dir=pa?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(pa){this.element.style.zIndex=String(pa)}dispose(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(pa){return this.element.ownerDocument.createElement(pa)}Rna(){return!0}static Oai(pa){return"prControl"+(pa?"Rtl":"")}}Object(f.a)(nh,"BasePresenceControl",
ea.a,[11,1938]);class eh extends Sys.EventArgs{constructor(pa,Fb){super();this.type=pa;this.$o=Fb}}eh.FX="InteractivityChanged";Object(f.a)(eh,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class xf{static eqm(pa){return xf.fqm(pa)}static fqm(pa){const Fb=document.createElementNS(xf.MPg,"svg");Fb.setAttribute("viewBox",String.format(xf.nOl,xf.ebk,xf.dbk));Fb.appendChild(xf.UNm(pa));return Fb}static UNm(pa){const Fb=xf.ebk/pa,Mb=2*Fb,Ic=xf.dbk/2;pa=(pa-12-8)*Fb/2;const ld=document.createElementNS(xf.MPg,
"g");Sys.UI.DomElement.addCssClass(ld,xf.mOl);for(let Kd=1;3>=Kd;Kd++)ld.appendChild(xf.Gmm(Kd,Mb,pa+(6*Kd-2)*Fb,Ic));return ld}static Gmm(pa,Fb,Mb,Ic){const ld=document.createElementNS(xf.MPg,"circle");Sys.UI.DomElement.addCssClass(ld,String.format("{0}-{1}",xf.Nrl,pa));ld.setAttribute("cx",String.format("{0}",Mb));ld.setAttribute("cy",String.format("{0}",Ic));ld.setAttribute("r",String.format("{0}",Fb));return ld}}xf.MPg="http://www.w3.org/2000/svg";xf.mOl="prDancingDots";xf.Nrl="prAnimateCircle";
xf.nOl="0 0 {0} {1}";xf.dbk=40;xf.ebk=120;Object(f.a)(xf,"ModernPresenceTooltipDancingDots",null,[]);var Ig=d(97),Mj=d(96),If=d(10),$b=d(69),wc=d(174),ed=d(76);class Dd extends nh{constructor(pa,Fb){super(pa);this.ZJh=this.vib=this.YMe=this._img=this.tG=this.qx=this.Fg=null;this.PSa=Fb.get(8,!1);this.bib=Fb.get(6,0);this.HSk=Fb.get(15,!1);this.Ne=Fb;this.qhh=0;this.element=pa;this.element.className=Dd.BEf;this._span=document.createElement("span");this.element.appendChild(this._span);this.Wuk=xf.eqm(Fb.get(6,
0));this.YE(Fb);this._state=5}qKb(pa){this.addHandler(eh.FX,pa)}DZb(pa){this.removeHandler(eh.FX,pa)}get user(){return this.ZJh}get state(){return this._state}dispose(){this.element&&(this.Fg.xc(If.a.click,this.element,Object($a.a)(this,this.onClick,"onClick")),this.Fg.xc(If.a.fD,this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")),this.qx.xc(If.a.jt,this.element,Object($a.a)(this,this.LE,"onPointerDown")),this.qx.xc(If.a.zH,this.element,Object($a.a)(this,this.eM,"onPointerOut")),
this.qx.xc(If.a.iM,this.element,Object($a.a)(this,this.mS,"onPointerOver")),this.tG.xc(this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}YE(pa){this.Fg=pa.get(10);this.Fg.nb(If.a.click,this.element,Object($a.a)(this,this.onClick,"onClick"));this.Fg.nb(If.a.fD,this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior"));this.qx=pa.get(9);this.qx.nb(If.a.iM,this.element,Object($a.a)(this,this.mS,"onPointerOver"));this.qx.nb(If.a.zH,
this.element,Object($a.a)(this,this.eM,"onPointerOut"));this.qx.nb(If.a.jt,this.element,Object($a.a)(this,this.LE,"onPointerDown"));this.tG=pa.get(13);this.tG.nb(this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior"))}hide(pa=null,Fb=0,Mb=0){this.HSk&&pa?this.Q9o(pa,Fb,Mb):(3===this.state&&this.ICj(),this.visible=!1,this._state=5)}Q9o(pa,Fb,Mb=0){this.show(pa,Fb,15,4,void 0,Mb)}uUj(pa,Fb,Mb=!1,Ic=!1,ld=!1,Kd=0){this.show(pa,Fb,20,Mb?2:Ic?1:0,ld,Kd)}l9o(pa,Fb,Mb,Ic=!1,
ld=0){this.show(pa,Fb,Mb+20,3,Ic,ld)}show(pa,Fb,Mb,Ic=3,ld=!1,Kd=0){!pa||Ic===this.state&&this.c0m(Fb,Mb)||(this.fWk(Ic,ld,Kd),this.Rja(pa,Ic,Kd),this._state=Ic,4===Kd||0===Kd&&!this.PSa?this.element.style.left=Fb+"px":this.element.style.right=Fb+"px",this.element.style.top=Mb+"px",this.visible=!0)}Rja(pa,Fb,Mb){this.ZJh=pa;ed.a.yF(this._span);wc.a.Ctl(this._span);this._span.id="fly_"+pa.clientId;this._span.style.backgroundColor=pa.color;4!==Fb?(this._span.style.height=this.bib+"px",this._span.style.lineHeight=
this.bib+"px",wc.a.o0b(this._span,"border-radius",this.bib+"px")):4===Mb||0===Mb&&!this.PSa?this._span.style.left="0px":this._span.style.right="0px";2!==Fb&&(4===Fb?ed.a.Rx(this._span,""):1===Fb?this._span.appendChild(this.Wuk):(this._span.setAttribute("dir","auto"),Mb=Bb.a.Ixm(pa.userName),(!pa.isAnonymous||m.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&Mb||0!==Fb?(pa=pa.userName,0===Fb&&(pa=Mb,wc.a.o0b(this._span,"text-align","center")),
ed.a.Rx(this._span,pa)):(this._img||(this._img=this.QEl()),this._span.appendChild(this._img),wc.a.o0b(this._span,"text-align","start"))))}onClick(pa){if(0===this.state)return this.raiseEvent(eh.FX,new eh(1,pa)),!0;3===this.state&&l.ULS.sendTraceTag(50436114,302,50,"User clicked on presence pill.");return!1}eM(pa){3===this.state&&this.raiseEvent(eh.FX,new eh(3,pa));return!1}mS(pa){3!==pa.yg&&this.raiseEvent(eh.FX,new eh(2,pa));return!1}LE(pa){if(3!==pa.yg)return!0;this.raiseEvent(eh.FX,new eh(4,pa));
return!1}QEl(){const pa=document.createElement("img");pa.src=Ig.a.Mea("doughperson_white_glyph.svg");pa.setAttribute("Unselectable","on");$b.a.Is(pa,$b.a.Sh,$b.a.FA);return Mj.createClusteredImageFromClusterWithImageClass(this.bib,this.bib,null,null,Dd.mcm,"",!1,"",this.element.ownerDocument,pa)}fWk(pa,Fb=!1,Mb=0){if(!this.R8c(this.state)||!this.R8c(pa))switch(Sys.UI.DomElement.removeCssClass(this.element,this.YMe),this.state){case 4:3===pa?this.U5a(Dd.CEf,Dd.Vpi):this.R8c(pa)&&this.U5a(Dd.AEf,Dd.Vpi);
break;case 3:4===pa?this.U5a(Dd.FEf,Dd.Upi):this.R8c(pa)&&(Fb&&this.ICj(),this.U5a(Dd.AEf,Dd.Upi,Fb?Dd.lcm:""));break;case 0:case 1:case 2:4===pa?this.U5a(Dd.FEf,Dd.DEf):3===pa&&(Fb&&this.qXk(),this.U5a(Dd.CEf,Dd.DEf,Fb?Dd.Wpi:"",3===Mb?Dd.pcm:Dd.ncm));break;default:4===pa?this.U5a(Dd.FEf):3===pa?this.U5a(Dd.CEf):this.R8c(pa)&&this.U5a(Dd.AEf)}}U5a(...pa){this.YMe=pa.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.YMe)}qXk(){this.qhh=window.setTimeout(()=>{this.element&&(this.vib=this.element.cloneNode(!0),
this.element.parentNode.appendChild(this.vib),this.element.style.zIndex="2",this.vib.style.zIndex="1")},300)}ICj(){window.clearTimeout(this.qhh);this.vib&&(Sys.UI.DomElement.removeCssClass(this.vib,Dd.DEf+" "+Dd.Wpi),Sys.UI.DomElement.addCssClass(this.vib,Dd.kcm),F.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.vib.parentNode&&this.element.parentNode.removeChild(this.vib)}),wc.a.Fvc(this.element,"z-index"))}R8c(pa){return 0===pa||1===pa||2===pa}c0m(pa,Fb){const Mb=
wc.a.F0(this.element.style.top);return wc.a.F0(this.element.style.left)===pa&&Mb===Fb}Cug(pa){3===pa&&wc.a.Dea(this.element,"left")?(pa=wc.a.F0(this.element.style.left),wc.a.Fvc(this.element,"left"),this.element.style.right=-1*pa+"px"):4===pa&&wc.a.Dea(this.element,"right")&&(pa=wc.a.F0(this.element.style.right),wc.a.Fvc(this.element,"right"),this.element.style.left=-1*pa+"px")}}Dd.BEf="prModernFlyout UIFont";Dd.FEf="flyoutIdle";Dd.CEf="flyoutExpanded";Dd.AEf="flyoutCollapsed";Dd.Vpi="flyoutFromIdle";
Dd.Upi="flyoutFromExpanded";Dd.DEf="flyoutFromCollapsed";Dd.Wpi="flyoutStacked";Dd.lcm="flyoutFromStacked";Dd.kcm="flyoutFadeOut";Dd.mcm="cui-img-cont-float cui-img-20by20";Dd.ncm="flyoutLtrDir";Dd.pcm="flyoutRtlDir";Object(f.a)(Dd,"ModernPresenceTooltipFlyoutControl",nh,[]);class ee{constructor(pa,Fb,Mb=2,Ic=4){this.offsetTop=pa;this.offsetLeft=Fb;this.abk=Mb;this.hPi=Ic}}Object(f.a)(ee,"FlyoutsPositioningInfo",null,[]);var me=d(39);class Nf{constructor(pa=!1,Fb=!1){this.Zm=pa;this.ISe=Fb}Yym(pa,
Fb,Mb,Ic,ld){const Kd=ld.y,ue=ld.height;var Ye=this.Wkm(Ic);const Bf=Ye+Fb,Fg=pa*Mb+2*(pa-1);Mb=null;1===pa||this.sml(Ye,Fg,Kd,ue)?pa=new ee(0,0,2):(pa=this.kEf(Bf,Fg,Kd,ue),pa.offsetTop-=Ye);this.ISe?Mb=new ee(0,0,void 0,this.Zm?4:3):(Ic=this.Vkm(Ic,ld),Ye=Math.max(0,ld.x),ld=ld.width,Fb=Ic+Fb,this.tml(Ic,Ye,ld)?Mb=new ee(0,0,void 0,this.Zm?3:4):this.uml(Fb,Ye)&&(Mb=new ee(0,0,void 0,this.Zm?4:3)),Mb||(Mb=this.Yam(Ic,Fb,Ye,ld)));return new ee(pa.offsetTop,Mb.offsetLeft,pa.abk,Mb.hPi)}Wkm(pa){return me.a.qKa(pa)}Vkm(pa,
Fb){return this.Zm?Fb.width-me.a.jui(pa):me.a.DHf(pa)}sml(pa,Fb,Mb,Ic){return pa+Fb<=Mb+Ic}kEf(pa,Fb,Mb,Ic){let ld=1,Kd=Math.max(Mb,pa-Fb);Fb>pa-Mb&&(ld=2,Kd=Fb<Ic?Ic-Fb:Mb);return new ee(Kd,0,ld)}tml(pa,Fb,Mb){return pa+150<=Fb+Mb}uml(pa,Fb){return 150<=pa-Fb}Yam(pa,Fb,Mb,Ic){Ic-Fb>=pa-Mb?pa=4:(Fb=pa,pa=3);return new ee(0,Fb,void 0,pa)}}Object(f.a)(Nf,"ModernPresenceTooltipPositioner",null,[]);class Tf{constructor(pa,Fb,Mb,Ic,ld,Kd,ue){this.wda=pa;this._parent=Fb;this.Nbh=Mb;this.Irk=Ic;this.Nzk=
ld;this.lbc=Kd;this.PSa=ue;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(pa,Fb){if(3!==pa)if(5!==pa&&this.wda&&this.wda.length){if(4===pa){var Mb=this.Nzk;var Ic=(this.lbc-Mb)/2;this.element.style.height=this.lbc+"px";this.element.style.width=this.lbc+"px";pa=wc.a.F0(this.wda[0].element.style.top);Fb=wc.a.F0(this.PSa?this.wda[0].element.style.right:this.wda[0].element.style.left)}else Mb=this.Nbh,Ic=(this.lbc-Mb)/2,this.element.style.height=
this.lbc+"px",this.element.style.width=this.$mm()+2*Ic+"px",pa=wc.a.F0(this.wda[this.wda.length-1].element.style.top),Fb=this.wll(this.wda[this.wda.length-1].element,Mb,Fb);wc.a.o0b(this.element,"border-radius",this.lbc+"px");this.element.style.top=pa-Ic-Mb+"px";this.PSa?this.element.style.right=Fb-Ic+"px":this.element.style.left=Fb-Ic+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}wll(pa,
Fb,Mb){return this.PSa&&!Mb?wc.a.F0(pa.style.right):this.PSa||Mb?this.PSa&&Mb?-wc.a.F0(pa.style.left)-Fb:-wc.a.F0(pa.style.right)-Fb:wc.a.F0(pa.style.left)}$mm(){return this.wda&&this.wda.length?this.Nbh+Math.min(this.wda.length-1,2)*this.Irk:0}}Object(f.a)(Tf,"ModernPresenceTooltipTarget",null,[]);var oi=d(153),Ie=d(190);class ag extends nh{constructor(pa,Fb,Mb){super(pa);this.J$b=this.zRa=this.ymh=this.YDb=!1;this.er=[];this.OYa=(Ic,ld)=>{Ic=this.e2b;this.lel()||2!==ld.type&&(4!==ld.type||3===Ic)?
4===ld.type&&3===Ic?(this.zRa&&(this.zRa=!1),this.Zpf()):3!==ld.type||3!==Ic||this.YDb||(1<this.P8a?(this.zRa=!0,F.Task.delay(250).continueWith(()=>{this.kfc(!0);this.zRa=!1})):this.Zpf()):(this.zRa&&(this.zRa=!1),3!==Ic&&(this.qmi(),3===ld.$o.yg&&this.Zpf(2E3)));this.raiseEvent(eh.FX,ld)};this.Nsc=Ic=>{3===Ic.yg?this.OYa(this,new eh(4,Ic)):Ic.eventName===If.a.iM?this.OYa(this,new eh(2,Ic)):Ic.eventName===If.a.zH&&this.OYa(this,new eh(3,Ic));return!1};this.hDd={};this.Ne=Mb;this.Zm=Mb.get(8,!1);this.klh=
Mb.get(15,!1);this.Otk=Mb.get(12,0);this.fnb=Mb.get(6,0);this.kqa=Fb;this.uKh=Mb.get(16);this.ISe=Mb.get(17,!1);this.Qzk=Mb.get(19,!1);this.$Jk=Mb.get(20,!1);this.WFd=0;this.UJk=new Nf(this.Zm,this.ISe);this.uDc=this.Rwi();this.aHb=!1;this.k4b=[];this.hJc=[];this.element.id=ag.nqb();this.element.className=nh.Oai(this.Zm);this.S7a&&(this.zIndex=this.S7a);this.rtl=this.Zm;this.ozg(Fb);this.W9=this.createElement("div");this.W9.className="prFlyoutContainer";this.element.appendChild(this.W9);this.wda=
[];this.Vib=new Tf(this.g7,this.element,this.fnb,4,6,32,this.Zm);this.qx=Mb.get(9);this.qx.nb(If.a.jt,this.Vib.element,this.Nsc);this.qx.nb(If.a.iM,this.Vib.element,this.Nsc);this.qx.nb(If.a.zH,this.Vib.element,this.Nsc)}get Mqe(){return Ie.a.clone(this.er)}get g7(){return this.wda}get S7a(){return this.Otk}get P8a(){return this.g7?this.g7.length:0}get e2b(){return 0<this.P8a?this.g7[0].state:5}get dZf(){return 3===this.e2b&&!this.YDb}qKb(pa){this.addHandler(eh.FX,pa)}DZb(pa){this.removeHandler(eh.FX,
pa)}dispose(){if(this.dZf)this.aHb=!0;else{if(this.g7)for(const pa of this.g7)pa.DZb(this.OYa),Te.a.LD(pa);this.wda=null;this.qx.xc(If.a.jt,this.Vib.element,this.Nsc);this.qx.xc(If.a.iM,this.Vib.element,this.Nsc);this.qx.xc(If.a.zH,this.Vib.element,this.Nsc);super.dispose()}}kyc(){this.kfc();this.visible=!0}Dpd(){this.visible=!0;this.qmi();this.YDb=!0}jDg(){this.Dpd()}hide(){this.nDj();this.w$a();this.Vib.update(this.e2b,this.J$b)}Rja(pa){const Fb=this.e2b,Mb=this.YDb;pa.clientId||(pa.clientId=(ag.BJc++).toString());
if(pa.clientId in this.hDd){var Ic=this.TOb(pa.clientId);if(0<=Ic){Ic=this.er[Ic];if(Ic.color===pa.color&&Ic.userName===pa.userName)return;this.zdb(pa.clientId)}}this.hide();Ic=new Dd(this.createElement("div"),this.Ne);Ic.qKb(this.OYa);this.W9.insertBefore(Ic.element,this.W9.firstChild);this.hDd[pa.clientId]=Ic;Array.add(this.er,pa);Array.add(this.g7,Ic);this.g$j(Fb,Mb);this.visible=!0}zdb(pa){if(this.dZf)Array.add(this.hJc,pa);else{var Fb=this.e2b,Mb=this.YDb;this.hide();this.Pkd(pa);this.g$j(Fb,
Mb)}}Hfj(pa){const Fb=this.TOb(pa);if(!(0>=Fb)){var Mb=this.er[Fb];pa=this.hDd[pa];Array.removeAt(this.er,Fb);Array.insert(this.er,0,Mb);Array.removeAt(this.g7,Fb);Array.insert(this.g7,0,pa);this.W9.removeChild(pa.element);this.W9.appendChild(pa.element);this.kfc()}}g$j(pa,Fb){0>=this.er.length?this.hide():3===pa&&Fb?this.Dpd():this.kyc()}SBf(pa){if(this.dZf&&this.Qzk)return!1;pa=ag.tNf(pa);if(this.W9!==pa&&ed.a.jXa(this.W9,pa))return!0;for(const Fb of this.g7)if(ed.a.jXa(Fb.element,pa))return!0;
return!1}position(pa,Fb){this.element.style.top=Fb+"px";this.element.style.left=pa+"px"}kfc(pa=!1){if(!pa||this.zRa){this.ymh&&this.kQj(!0);var Fb=Math.min(3,this.P8a)-1;pa=0;var Mb=1,Ic=0;this.J$b&&(pa=this.uDc,Mb=-1,Ic=-this.fnb);for(let ld=this.P8a-1;ld>Fb;ld--)this.g7[ld].uUj(this.er[ld],-4*Fb*Mb+Ic,!0,!1,!0,pa);for(;0<=Fb;Fb--)this.g7[Fb].uUj(this.er[Fb],-4*Fb*Mb+Ic,0<Fb,Array.contains(this.k4b,this.er[Fb].clientId),Fb!==this.WFd,pa);this.WFd=0;this.Vib.update(0,this.J$b);this.zIndex=this.S7a;
this.YDb=!1;this.nDj(0);this.aHb&&this.dispose()}}qmi(){this.ymh&&this.kQj(!1);this.zIndex=this.S7a+1;const {offsetX:pa,offsetY:Fb,gPi:Mb}=this.MXo();for(let Ic=0;Ic<this.P8a;Ic++)this.g7[Ic].l9o(this.er[Ic],pa,Fb+(this.fnb+2)*Ic,Ic!==this.WFd,Mb)}w$a(){let pa=0,Fb=0;this.J$b&&(pa=this.uDc,Fb=-6);for(let Mb=0;Mb<this.P8a;Mb++)this.g7[Mb].hide(this.er[Mb],Fb,pa);this.zIndex=this.S7a;this.visible=this.YDb=!1;this.aHb&&this.dispose()}Zpf(pa=0){pa?(this.zRa=!0,F.Task.delay(pa).continueWith(()=>{this.klh?
this.T1m():this.kfc(!0);this.zRa=!1})):this.klh?this.hide():this.kfc()}T1m(){this.zRa&&this.hide()}lel(){if(m.AFrameworkApplication.ta&&m.AFrameworkApplication.ta.Hb.kCa&&oi.c()){const pa=appChrome.selectors.getShyState();return pa.isActive&&0!==pa.state}return!1}ozg(pa){this.element.style.width=pa+"px";this.element.style.height=this.fnb+"px"}Pkd(pa){this.Jzo(pa);pa=this.TOb(pa);if(!(0>pa)){var Fb=this.er[pa];Array.removeAt(this.er,pa);delete this.hDd[Fb.clientId];Fb=this.g7[pa];this.W9.removeChild(Fb.element);
this.Ne.get(18,!1)&&Fb.DZb(this.OYa);Array.removeAt(this.g7,pa);Fb.dispose()}}nDj(pa=5){if(this.hJc.length){this.visible&&this.w$a();for(let Fb=0;Fb<this.hJc.length;Fb++)this.Pkd(this.hJc[Fb]);Array.clear(this.hJc);0>=this.er.length||5===pa?this.hide():0===pa&&this.kyc()}}TOb(pa){for(let Fb=0;Fb<this.er.length;Fb++)if(this.er[Fb].clientId===pa)return Fb;return-1}Jzo(pa){-1===this.TOb(pa)?l.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.k4b,
pa)&&(Array.remove(this.k4b,pa),this.er[0].clientId===pa&&0<this.k4b.length&&this.Hfj(this.k4b[this.k4b.length-1]),this.er[0].clientId===pa&&1===this.e2b&&this.kfc())}kQj(pa){pa?Sys.UI.DomElement.addCssClass(this.W9,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.W9,"prBackgroundSelection")}MXo(){let pa,Fb;Fb=pa=0;var Mb=this.uDc;if(this.uKh){const Ic=this.uKh(this);if(!Ic)return{offsetX:pa,offsetY:Fb,gPi:Mb};const ld=4===this.e2b;Mb=this.UJk.Yym(this.P8a,ld?6:this.fnb,this.fnb,this.element,
Ic);Fb=Mb.offsetTop;this.WFd=this.wxm(Mb.abk,Mb.offsetTop);Mb=Mb.hPi;Mb!==this.uDc&&(this.Cug(Mb),this.element.dir=3===Mb?"rtl":"ltr",this.uDc=Mb);Mb!==this.Rwi()?(pa=this.$Jk?-2:ld?-6:-this.fnb,this.J$b=!0):this.J$b=!1}return{offsetX:pa,offsetY:Fb,gPi:Mb}}wxm(pa,Fb){if(1===pa)return this.P8a-1;pa=Math.abs(Fb);return 0<pa?pa/(this.fnb+2):0}Cug(pa){for(let Fb=0;Fb<this.P8a;Fb++)this.g7[Fb].Cug(pa)}Rwi(){return this.Zm?3:4}static nqb(){return String.format("{0}-{1}","presencetooltip",ag.BJc++)}static tNf(pa){return pa.Nb.rawEvent.relatedTarget}}
ag.BJc=0;Object(f.a)(ag,"ModernPresenceTooltipControl",nh,[1942,11]);var uf=d(298),Pe=d(300);class Db{constructor(pa){this.Ne=pa;this.Ne.BTa(10,uf.a.instance);this.Ne.BTa(9,xe.a.instance);this.Ne.BTa(6,20);this.Ne.BTa(13,Pe.a.instance);this.Ne.BTa(17,!1)}btf(pa,Fb=!1){this.Ne.BTa(15,Fb);return new ag(pa,20,this.Ne)}}Object(f.a)(Db,"ModernPresenceTooltipFactory",null,[1940]);class Vb extends nh{constructor(pa,Fb){super(pa);this.er=null;this.PSa=Fb.get(8,!1);this.bib=Fb.get(6,0);this.element=pa;this.element.className=
Vb.BEf;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.Fg=Fb.get(10);this.Fg.nb(If.a.click,this.element,Object($a.a)(this,this.onClick,"onClick"));this.qx=Fb.get(9);this.qx.nb(If.a.zH,this.element,Object($a.a)(this,this.eM,"onPointerOut"));this.qx.nb(If.a.jt,this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior"));this.tG=Fb.get(13);this.tG.nb(this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior"))}qKb(pa){this.addHandler(eh.FX,
pa)}DZb(pa){this.removeHandler(eh.FX,pa)}get users(){return this.er}dispose(){this.element&&(this.Fg.xc(If.a.click,this.element,Object($a.a)(this,this.onClick,"onClick")),this.qx.xc(If.a.jt,this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")),this.qx.xc(If.a.zH,this.element,Object($a.a)(this,this.eM,"onPointerOut")),this.tG.xc(this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(pa,Fb,Mb){this.hide();
!pa||0>=pa.length||(this.PSa?this.element.style.right=Fb+"px":this.element.style.left=Fb+"px",this.element.style.top=Mb+"px",this.B0k(pa),this.visible=!0)}B0k(pa){this.er=pa;ed.a.yF(this._ul);for(let Fb=pa.length-1;0<=Fb;Fb--)this.Rja(pa[Fb])}Rja(pa){const Fb=document.createElement("li");Fb.style.backgroundColor=pa.color;Fb.style.height=this.bib+"px";Fb.id="fly_"+pa.clientId;Fb.style.lineHeight=this.bib+"px";ed.a.Rx(Fb,pa.userName);Fb.setAttribute("dir","auto");this._ul.appendChild(Fb)}onClick(){this.hide();
return!1}eM(pa){this.raiseEvent(eh.FX,new eh(3,pa));return!1}}Vb.BEf="prFlyout UIFont";Object(f.a)(Vb,"PresenceTooltipFlyoutControl",nh,[]);class Nc extends nh{constructor(pa,Fb,Mb){super(pa);this._img=null;this.er=[];this.element.className="prGlyph";this.Ne=Fb;this.q$b=this.Ne.get(9);this.ur=this.Ne.get(10);this.tG=this.Ne.get(13);this.C3m();this.Rja(Mb);this.kXe=!1}get jcb(){return this.er.length}get users(){return this.er}qKb(pa){this.addHandler(eh.FX,pa)}DZb(pa){this.removeHandler(eh.FX,pa)}dispose(){this.Aup();
super.dispose()}Rja(pa){Array.add(this.er,pa);2===this.jcb?this.moa(!0):1===this.jcb?this.moa(!1):this.moa(this.kXe)}zdb(pa){this.o9l(pa)&&(1<this.jcb&&this.moa(!0),1===this.jcb?this.moa(!1):1>this.jcb&&this.hide())}show(){this.moa(2<=this.jcb);this.visible=!0}hide(){this.visible=!1}ixm(pa){return pa?this.nvi(0,5):this.nvi(1,4)}o9l(pa){for(let Fb=0;Fb<this.jcb;Fb++)if(this.er[Fb].clientId===pa)return pa=this.er[Fb],Array.removeAt(this.er,Fb),pa;return null}moa(pa){this.kXe!==pa&&(this._img&&this.element.removeChild(this._img),
this._img=this.ixm(pa),this.element.appendChild(this._img),this.kXe=pa);this._img.childNodes[0].style.backgroundColor=this.er[this.er.length-1].color}nvi(pa,Fb){const Mb=this.Ne.get(6,0),Ic=this.Ne.get(14);return Mj.createClusteredImageFromClusterWithImageClass(Mb,Mb,this.Ne.get(pa),this.Ne.get(Fb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Ic?Ic.cloneNode(!0):null)}mS(pa){3!==pa.yg&&this.raiseEvent(eh.FX,new eh(2,pa));return!1}onClick(pa){this.raiseEvent(eh.FX,new eh(1,
pa));return!0}eM(pa){3!==pa.yg&&this.raiseEvent(eh.FX,new eh(3,pa));return!1}Aup(){this.element&&(this.q$b.xc(If.a.jt,this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")),this.q$b.xc(If.a.iM,this.element,Object($a.a)(this,this.mS,"onPointerOver")),this.q$b.xc(If.a.zH,this.element,Object($a.a)(this,this.eM,"onPointerOut")),this.ur.xc(If.a.fD,this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")),this.ur.xc(If.a.click,this.element,Object($a.a)(this,
this.onClick,"onClick")),this.tG.xc(this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")))}C3m(){this.element&&(this.q$b.nb(If.a.jt,this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")),this.q$b.nb(If.a.iM,this.element,Object($a.a)(this,this.mS,"onPointerOver")),this.q$b.nb(If.a.zH,this.element,Object($a.a)(this,this.eM,"onPointerOut")),this.ur.nb(If.a.fD,this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")),
this.ur.nb(If.a.click,this.element,Object($a.a)(this,this.onClick,"onClick")),this.tG.nb(this.element,Object($a.a)(this,this.Rna,"stopPropagationAndPreventDefaultBehavior")))}}Object(f.a)(Nc,"PresenceTooltipGlyph",nh,[]);class td extends nh{constructor(pa,Fb,Mb){super(pa);this.er=[];this.aN=[];this.eSa=0;this.jQc=this.x7b=!1;this.u8g=null;this.OYa=(Ic,ld)=>{var Kd=Object(z.a)(Nc,Ic);Kd=Kd?this.qoi(Kd):-1;if(2===ld.type||1===ld.type&&-1!==Kd&&!this.ofa[Kd].visible)this.Eqe(Ic);else if(1===ld.type)this.w$a(),
this.x7b=!1;else if(3===ld.type){if(this.SBf(ld.$o))return;this.x7b||this.w$a()}this.raiseEvent(eh.FX,ld)};this.iDd={};this.Ne=Mb;this.Zm=Mb.get(8,!1);this.Hpa=Mb.get(11,!1);pa=Mb.get(12,0);this.eSb=Mb.get(6,0);this.kqa=Fb;this.element.id=td.nqb();this.element.className=nh.Oai(this.Zm);pa&&(this.zIndex=pa);this.rtl=this.Zm;this.ozg(Fb);this.mGa=this.createElement("div");this.mGa.className=this.Hpa?"prContainerV":"prContainerHr";this.element.appendChild(this.mGa);this.Aih=Array(this.eSa);for(Fb=0;Fb<
this.eSa;Fb++)this.ofa[Fb]=new Vb(this.createElement("div"),this.Ne),this.ofa[Fb].qKb(this.OYa),this.element.appendChild(this.ofa[Fb].element)}get Mqe(){return Ie.a.clone(this.er)}get ofa(){return this.Aih}get sMh(){return this.u8g}get zAe(){return this.eSb+2}get width(){return this.Hpa?this.zAe:this.kqa}get height(){return this.Hpa?this.kqa:this.zAe}qKb(pa){this.addHandler(eh.FX,pa)}DZb(pa){this.removeHandler(eh.FX,pa)}dispose(){if(this.ofa)for(const pa of this.ofa)pa.DZb(this.OYa),Te.a.LD(pa);Te.a.Hwg(this.aN);
this.aN=this.Aih=null;super.dispose()}kyc(){this.w$a();this.wDg();this.visible=!0;this.x7b=!1}Dpd(){!this.aN||1>this.aN.length||(this.w$a(),this.visible=!0,this.wDg(),this.Eqe(this.aN[this.aN.length-1]),this.x7b=!0)}jDg(){if(this.aN&&!(1>this.aN.length)){this.visible=!0;this.wDg();var pa=0;for(const Fb of this.aN)this.Eqe(Fb,pa++);this.x7b=!1;this.jQc=!0}}hide(){this.visible=!1;this.w$a();for(let pa=0;pa<this.aN.length;pa++)this.aN[pa].hide();this.x7b=!1}E1h(){if(!this.jQc)return!1;let pa=0;for(const Fb of this.ofa)Fb.visible&&
pa++;return this.jQc=0<pa&&(this.er.length<=this.eSa?pa===this.er.length:pa===this.eSa)}Rja(pa){if(!(0>=this.eSa)){pa.clientId||(pa.clientId=(td.BJc++).toString());if(pa.clientId in this.iDd){var Fb=this.TOb(pa.clientId);if(0<=Fb){Fb=this.er[Fb];if(Fb.color===pa.color&&Fb.userName===pa.userName)return;this.zdb(pa.clientId)}}Fb=this.E1h();var Mb=0;if(this.er.length<this.eSa){var Ic=new Nc(this.createElement("div"),this.Ne,pa);Ic.qKb(this.OYa);this.Zm&&!this.Hpa&&0<this.er.length?this.mGa.insertBefore(Ic.element,
this.mGa.firstChild):(this.mGa.appendChild(Ic.element),Mb=this.aN.length);Array.add(this.aN,Ic)}else this.Zm&&!this.Hpa?Ic=this.aN[0]:(Mb=this.aN.length-1,Ic=this.aN[Mb]),Ic.Rja(pa);Ic.show();this.iDd[pa.clientId]=Ic;Array.add(this.er,pa);this.J7j(Ic,Mb);Fb&&this.jDg()}}zdb(pa){const Fb=this.E1h();Fb&&this.w$a();this.Pkd(pa);this.er.length>=this.eSa&&this.aN.length<this.eSa&&this.Zqo();0>=this.er.length?this.hide():Fb&&this.jDg()}Hfj(){}Pkd(pa){var Fb=this.TOb(pa);0>Fb||(pa=this.er[Fb],Array.removeAt(this.er,
Fb),Fb=this.iDd[pa.clientId],delete this.iDd[pa.clientId],Fb.zdb(pa.clientId),this.J7j(Fb),0>=Fb.jcb&&(this.mGa.removeChild(Fb.element),Array.remove(this.aN,Fb),Fb.dispose()))}Zqo(){var pa=this.JEm();!pa||1>=pa.users.length||(pa=Array.clone(this.er),pa.forEach(Fb=>{this.Pkd(Fb.clientId)}),pa.forEach(Fb=>{this.Rja(Fb)}))}TOb(pa){for(let Fb=0;Fb<this.er.length;Fb++)if(this.er[Fb].clientId===pa)return Fb;return-1}JEm(){return this.Zm&&!this.Hpa?this.aN[0]:this.aN[this.aN.length-1]}position(pa,Fb){this.element.style.top=
Fb+"px";this.element.style.left=pa+"px"}wDg(){for(let pa=0;pa<this.aN.length;pa++)this.aN[pa].show()}w$a(){for(let pa=0;pa<this.eSa;pa++)this.ofa[pa].hide();this.jQc=!1}Eqe(pa,Fb=0){if(pa)if(this.u8g=pa,this.Hpa){const Mb=this.eSb;if(1<pa.users.length)this.ofa[Fb].show(pa.users,Mb,this.height-this.eSb);else{const Ic=this.mGa.children.length;for(let ld=0;ld<this.mGa.children.length;ld++)pa.element===this.mGa.children[ld]&&this.ofa[Fb].show(pa.users,Mb,this.height-(Ic-ld)*this.zAe+2)}}else this.ofa[Fb].show(pa.users,
this.width,0)}SBf(pa){pa=td.tNf(pa);let Fb=!1;for(const Mb of this.ofa)if(ed.a.jXa(Mb.element,pa)){Fb=!0;break}return this.mGa!==pa&&ed.a.jXa(this.mGa,pa)||Fb}J7j(pa,Fb=0){const Mb=this.Mfn(pa);Mb&&0>=pa.jcb?this.ofa[Fb].hide():Mb?this.Eqe(pa):this.ofa[Fb].hide()}qoi(pa){let Fb=0;for(const Mb of this.aN){if(pa===Mb)return Fb;Fb++}return-1}Mfn(pa){const Fb=this.qoi(pa);return!!this.sMh&&pa===this.sMh&&-1!==Fb&&this.ofa[Fb].visible}ozg(pa){this.eSa=pa===this.eSb?1:Math.floor(pa/this.zAe);this.Hpa?(this.element.style.height=
pa+"px",this.element.style.width=this.eSb+"px"):(this.element.style.width=pa+"px",this.element.style.height=this.eSb+"px")}static nqb(){return String.format("{0}-{1}","presencetooltip",td.BJc++)}static tNf(pa){pa=pa.Nb.rawEvent;return pa.relatedTarget||pa.toElement}}td.BJc=0;Object(f.a)(td,"PresenceTooltipControl",nh,[1942,11]);class Ke{constructor(pa){this.Ne=pa;this.Ne.BTa(10,uf.a.instance);this.Ne.BTa(9,xe.a.instance);this.Ne.BTa(6,16);this.Ne.BTa(13,Pe.a.instance)}btf(pa){return new td(pa,16,
this.Ne)}}Object(f.a)(Ke,"PresenceTooltipFactory",null,[1940]);var sf=d(257),qh=d(125),Ef=d(53),jg=d(5),Fi=d(110),hf=d(6),Ph=d(127),mg=d(74),el=d(525),Tg=d(311),jh=d(251);class xg extends Sys.EventArgs{constructor(pa,Fb){super();this.paragraphId=pa;this.XAn=Fb}}Object(f.a)(xg,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class Of extends nh{constructor(pa,Fb,Mb,Ic,ld,Kd=null,ue=null){super(null);this.bDd=this.ho=null;this.xbd=!1;this.awa=0;this.tq=pa;this.lRc=Fb;this.qx=Mb;this.Wj=Ic;this.jQa=
ld;Of.pEb=0;this.LRh=new jc.a;this.nHj=new jc.a;this.JZ=Kd;this.Ga=ue;this.Owk=this.Ga.fc("PresenceIpRenderedFloodgateTimeLapseSec",30);this.SRk=this.Ga.fc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.Hhb=0}get Wbb(){return m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")}l1k(pa){this.addHandler("CR",pa)}XDj(pa){this.removeHandler("CR",pa)}bte(){this.raiseEvent("CR",new xg(this.tq.ip.paragraphId,this.xbd))}f$f(){if(Object(jh.a)(ag,this.ho)){const pa=Object(z.a)(ag,this.ho);
Of.pEb=0<Of.pEb?Of.pEb+1:pa.S7a+1;pa.zIndex=Of.pEb;this.element.style.zIndex=String(Of.pEb)}}vIo(){if(Object(jh.a)(ag,this.ho)){const pa=Object(z.a)(ag,this.ho);Of.pEb=pa.S7a;pa.zIndex=pa.S7a;this.element.style.zIndex=String(pa.S7a)}}raj(){this.JZ&&!this.Dqp()&&this.JZ.continueWith(()=>{this.JZ.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.Owk)&&this.Hhb++})}Dqp(){return this.Hhb>=this.SRk}static K$i(){Of.kih||(Of.kih=!0,l.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static nqb(pa){return Of.T4m+
pa.ozi()}}Of.kvj="data-presence-control";Of.Jqj="OverlayControlElementOwner";Of.T4m="ipId_";Of.lvj="WacPresence";Of.Q9n="PresenceIpPaddingDiv";Of.kih=!1;Of.pEb=0;Object(f.a)(Of,"APresenceControl",nh,[1623,11]);class Zh{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.Beb=!1}}Object(f.a)(Zh,"PresenceImageControlStyle",null,[1622]);var Ei=d(184);class Pf extends Of{constructor(pa,Fb,Mb,Ic,ld,Kd=null,ue=null){super(pa,Fb,Mb,Ic,ld,Kd,ue);this.eM=()=>{this.Kej();return!1};this.moe=
Ye=>{this.ho&&3===Ye.yg&&(2!==this.awa?(this.f$f(),this.b1b()):this.Kej());return!1}}zdb(pa){this.ho&&this.ho.zdb(pa)}RFe(){return this.ho?this.ho.Mqe.length:0}updatePosition(pa){if(this.element&&this.element.parentNode){var Fb=this.Qzi(pa);if(Fb){var Mb=Sys.UI.DomElement.getBounds(this.element.parentNode),Ic,ld;({left:Mb,top:Ic,height:ld,width:Fb}=this.uHm(Fb,Mb,this.element.parentNode,this.Wj.instance));this.element.style.top=Ic+"px";this.element.style.left=Mb+"px";this.element.style.height=ld+
"px";this.element.style.width=Fb+"px";Mb=this.Wzi(pa);wc.a.L8(this.element,Mb);pa=this.KKf(pa,this.tq.ip.shapeId);this.OQj(Mb,Fb,this.isSelected(pa),m.AFrameworkApplication.isRtl);this.b1b()}}}K0(){this.element&&(ed.a.Fy(this.element),this.ho.zdb(this.tq.user.clientId),this.bte())}Y5h(pa,Fb,Mb,Ic){Fb=new Zh;if(!Ic||!Mb)return Fb;Mb=this.Qzi(pa);if(!Mb)return Fb;Fb.top=Mb.y;Fb.left=Mb.x;Fb.height=Mb.height;Fb.width=Mb.width;Fb.rotation=this.dKm(pa);Fb.Beb=!0;return Fb}TEj(pa,Fb,Mb,Ic){Of.K$i();this.bDd=
pa;if(Ic){const ld=this.KKf(pa,this.tq.ip.shapeId);if(!ld)return;const Kd=!this.element;Kd&&this.ftf(Fb.ownerDocument,pa);Kd||!this.element.parentNode?ld.appendChild(this.element):this.element.parentNode!==ld&&(this.element.parentNode.removeChild(this.element),ld.appendChild(this.element));this.ho.Rja(this.tq.user);this.element.style.borderColor=this.tq.user.color;this.element.id=Of.nqb(this.tq);Mb.Beb&&(this.element.style.height=Mb.height+"px",this.element.style.top=Mb.top+"px",this.element.style.left=
Mb.left+"px",this.element.style.width=Mb.width+"px",wc.a.L8(this.element,Mb.rotation),wc.a.L8(this.ho.element,-1*Mb.rotation),this.OQj(Mb.rotation,Mb.width,this.isSelected(ld),m.AFrameworkApplication.isRtl),this.b1b())}this.xbd=!Ic;this.bte()}dKm(pa){return this.element&&this.element.parentNode&&this.oGi(wc.a.getTransform(this.element.parentNode))?this.oGi(wc.a.getTransform(this.element)):this.Wzi(pa)}oGi(pa){return pa&&-1<pa.indexOf("deg")&&(pa=parseInt(pa.substring(pa.indexOf("(")+1,pa.indexOf("deg"))),
!isNaN(pa))?pa:0}j7j(pa){this.element.style.borderColor=this.tq.user.color;this.element.id=Of.nqb(this.tq);this.updatePosition(pa)}ftf(pa,Fb){this.element=pa.createElement("div");this.element.setAttribute(Of.kvj,!0);qh.a.Im(this.element,Of.Jqj,this);this.element.className=Pf.yho;(pa=Fb.Cb)&&pa.eU&&(this.element.style.pointerEvents="none");this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.ho=this.lRc.btf(this.createElement("div"),!0);this.ho.Rja(this.tq.user);this.ho.hide();this.qx.nb(If.a.zH,
this.ho.element,this.eM);this.qx.nb(If.a.jt,this.ho.element,this.moe);this.ho.element.classList.add(Of.lvj);this.element.appendChild(this.ho.element)}uHm(pa,Fb,Mb,Ic){let ld=pa.y,Kd=pa.x,ue=pa.height;pa=pa.width;(1<Math.abs(Fb.width-Mb.offsetWidth)||1<Math.abs(Fb.height-Mb.offsetHeight))&&Ic&&(ld=Math.round(ld/Ic.Cj),Kd=Math.round(Kd/Ic.Cj),ue=Math.round(ue/Ic.Cj),pa=Math.round(pa/Ic.Cj));return{left:Kd,top:ld,height:ue,width:pa}}isSelected(pa){return pa.classList.contains(Tg.a.Jgc)}OQj(pa,Fb,Mb,
Ic){this.ho.element.style.left="auto";this.ho.element.style.top="auto";this.ho.element.style.right="auto";this.ho.element.style.bottom="auto";Mb=Mb?Math.round(.5*Pf.$va)+Pf.jop:0;0<=pa&&90>pa||360===pa?(this.ho.element.style.top=-.5*Pf.$va-Mb+"px",Ic?this.ho.element.style.right=Fb-.5*Pf.$va+"px":this.ho.element.style.left=Fb-.5*Pf.$va+"px"):90<=pa&&180>pa?(this.ho.element.style.left=-.5*Pf.$va-Mb+"px",Ic?this.ho.element.style.bottom=-.5*Pf.$va+"px":this.ho.element.style.top=-.5*Pf.$va+"px"):180<=
pa&&270>pa?(this.ho.element.style.bottom=-.5*Pf.$va-Mb+"px",Ic?this.ho.element.style.left=Fb-.5*Pf.$va+"px":this.ho.element.style.right=Fb-.5*Pf.$va+"px"):(this.ho.element.style.right=-.5*Pf.$va-Mb+"px",Ic?this.ho.element.style.top=-.5*Pf.$va+"px":this.ho.element.style.bottom=-.5*Pf.$va+"px")}Yi(pa,Fb){const Mb=this.R6d(pa,Fb);return Mb?Mb.properties:(pa=this.Vzi(pa,Fb))?pa.properties:null}KKf(pa,Fb){var Mb=this.R6d(pa,Fb);return Mb&&(Mb=Mb.aBa(pa.Jh,pa))?Mb.element:(Fb=this.Vzi(pa,Fb))?Object(z.a)(el.a,
Fb).Ce(pa.sc).htmlElement:null}R6d(pa,Fb){pa=mg.i(pa.Cb,5);for(const Mb of pa)if(Mb.properties.getValue(jg.a.bpb)===Fb)return Mb;return null}Vzi(pa,Fb){pa=hf.a.Za(pa.Cb);let Mb=pa.Ub(6);for(;Mb;){const Ic=Mb.properties.getValue(jg.a.bpb);if(Ph.a.Lt(Mb)&&Ic===Fb)return Mb;Mb=pa.Nf(6)}return null}Ywm(pa){const Fb=Ef.a.xf(Ph.a.cC(pa),0);pa=Ef.a.xf(Ph.a.nD(pa),1);return{woa:Fb,k1m:pa}}Wzi(pa){pa=this.Yi(pa,this.tq.ip.shapeId);return Ph.a.Z2(pa)}Qzi(pa){var Fb=this.tq.ip;if(!Fb||!Fb.shapeId)return null;
var Mb=this.Yi(pa,Fb.shapeId);const Ic=this.KKf(pa,Fb.shapeId);if(!Mb||!Ic)return null;let ld=pa=1,Kd;({woa:Fb,k1m:Kd}=this.Ywm(Mb));Object(Ei.d)(Mb)?(Mb=Ph.a.Asa(Mb),pa=Ef.a.xf(Mb[Fi.a.left],0),ld=Ef.a.xf(Mb[Fi.a.top],1)):Mb.hasProperty(jg.a.Uga)?(Mb=Mb.getValue(jg.a.Uga),pa+=Ef.a.xf(Mb[Fi.a.left],0),ld+=Ef.a.xf(Mb[Fi.a.top],1)):(pa+=0<Ic.offsetWidth?(Ic.offsetWidth-Fb)/2:2,ld+=0<Ic.offsetHeight?(Ic.offsetHeight-Kd)/2:2);return new Sys.UI.Bounds(Math.round(pa),Math.round(ld),Math.round(Fb),Math.round(Kd))}Kej(){this.ho&&
(this.ho.kyc(),this.awa=1)}b1b(){for(const pa of this.ho.Mqe)if(pa.clientId===this.tq.user.clientId&&!pa.equals(this.tq.user)){this.ho.Rja(this.tq.user);break}if(this.tq.W_a||2===this.awa)this.ho.Dpd(),this.tq.W_a=!1,this.tq.hga=!0,this.awa=2;this.tq.hga&&1!==this.awa||(this.ho.kyc(),this.tq.hga=!0,this.awa=1)}}Pf.yho="WACImgPresenceHighlight";Pf.$va=20;Pf.jop=6;Object(f.a)(Pf,"PresenceImageControl",Of,[]);var Gi=d(274);class Xk{constructor(){this.height=this.top=this.left=this.WUi=0;this.Beb=!1;
this.ww=this.Lh=null}}Object(f.a)(Xk,"PresenceIpControlStyle",null,[1622]);var Sf=d(60);class Pi extends Of{constructor(pa,Fb,Mb,Ic,ld,Kd=null,ue=null,Ye=null){super(pa,Fb,Mb,Ic,ld,Kd,ue);this.sQc=this.e3a=this.Kac=null;this.mS=Bf=>{!this.ho||this.Wbb&&!this.ho.SBf(Bf)||(this.f$f(),this.ewe(Bf));this.j7j(this.bDd);return!1};this.eM=()=>{this.ho&&this.FU();return!1};this.moe=Bf=>{this.ho&&3===Bf.yg&&(2!==this.awa?(this.f$f(),this.ewe(Bf)):this.FU());return!1};this.pF=Ye}ftf(pa){this.element=pa.createElement("div");
this.element.setAttribute(Of.kvj,!0);qh.a.Im(this.element,Of.Jqj,this);this.element.className=Of.Q9n;this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.qx.nb(If.a.iM,this.element,this.mS);this.Wbb&&(this.qx.nb(If.a.zH,this.element,this.eM),this.qx.nb(If.a.jt,this.element,this.moe));this.e3a=this.createElement("div");this.e3a.className=Pi.zho;this.Wbb||(this.sQc=this.createElement("div"),this.sQc.className=Pi.Cho,this.e3a.appendChild(this.sQc));this.ho=this.lRc.btf(this.createElement("div"),
this.Wbb);pa=this.Ga.$("NoPresenceUserLookUpBeforeRender");this.pF&&!pa&&(this.tq.user=this.pF.p7f(this.tq.user.clientId)||this.tq.user);this.ho.Rja(this.tq.user);this.ho.hide();this.ho.element.classList.add(this.Wbb?Of.lvj:Pi.rco);this.e3a.appendChild(this.ho.element);this.element.appendChild(this.e3a)}ARl(){this.Kac&&(Gb.a.instance.uf(this.Kac),this.Kac=null)}b1b(pa){for(var Fb of this.ho.Mqe)if(Fb.clientId===this.tq.user.clientId&&!Fb.equals(this.tq.user)){this.ho.Rja(this.tq.user);break}Fb=!1;
Pi.gPl===this.tq.user.color?({value:Fb}=this.LRh.Ec(this.tq.user.clientId,!1),Fb||(this.LRh.W(this.tq.user.clientId,!0),l.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.tq.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:Fb}=this.nHj.Ec(this.tq.user.clientId,!1),Fb||(this.nHj.W(this.tq.user.clientId,!0),l.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.tq.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return pa||this.tq.W_a||2===this.awa?(this.raj(),this.ho.Dpd(),
this.tq.W_a=!1,this.tq.hga=!0,this.awa=2,Pi.Mmp):this.tq.hga&&1!==this.awa?0:(this.raj(),this.ho.kyc(),this.tq.hga=!0,this.awa=1,Pi.Lmp)}ewe(pa=null){this.ARl();const Fb=this.b1b(!!pa);this.Wbb&&pa&&pa.eventName===If.a.iM||this.jOo(Fb)}FU(){this.ho&&this.awa&&(this.vIo(),this.ho.hide(),this.awa=0)}jOo(pa){this.Kac=new za.a(2,1,pa,()=>{this.Kac=null;this.FU()},56);Gb.a.instance.Yb(this.Kac)}updatePosition(pa){if(this.element&&this.element.parentNode){var Fb=this.GAi(pa);if(Fb){pa=Sys.UI.DomElement.getBounds(this.element.parentNode);
Fb=new Sys.UI.Bounds(Fb.x-pa.x,Fb.y-pa.y,Pi.$Ui,Fb.height);var Mb;({left:pa,top:Fb,height:Mb}=this.xHm(Fb,pa,this.element.parentNode,this.Wj.instance));this.element.style.height=2*Pi.Btc+Mb+"px";this.element.style.top=Fb-Pi.Btc+"px";this.element.style.left=pa-Pi.Btc+"px";this.e3a.style.height=Math.max(Pi.yej,Mb)+"px";this.ewe()}}}K0(){this.element&&(ed.a.Fy(this.element),this.bte())}Y5h(pa,Fb,Mb,Ic,ld){const Kd=new Xk;if(!Ic||!Mb)return Kd;Ic=this.GAi(pa);if(!Ic)return Kd;var ue=Mb;Mb=pa;if(pa.Mj){var Ye=
pa.ic;ue=pa.og.mlc(this.tq.ip.hca.cp);0>ue&&0==ue;pa.ic.TBa?ed.a.jXa(Ye.editingElement,pa.og.Dj.K(ue))||(Mb=Object(Sf.a)().Ad.Wl(pa.source),Fb=Mb.og.Dj.K(ue)):Fb=Mb.og.Dj.K(ue);ue=Fb.getBoundingClientRect()}ue=new Sys.UI.Bounds(Ic.x-ue.x,Ic.y-ue.y,Pi.$Ui,Ic.height);pa=ue.y;Ic=ue.x;ue=ue.height;Ye=this.Wj.instance;ld&&Ye&&(ld=Ye.Cj,pa=Math.round(pa/ld),Ic=Math.round(Ic/ld),ue=Math.round(ue/ld));Kd.top=pa-Pi.Btc;Kd.left=Ic-Pi.Btc;Kd.height=2*Pi.Btc+ue;Kd.WUi=Math.max(Pi.yej,ue);Kd.Beb=!0;Kd.Lh=Fb;Kd.ww=
Mb;return Kd}TEj(pa,Fb,Mb,Ic){Of.K$i();this.bDd=pa;pa=Mb.Lh;Fb=Mb.ww;if(pa&&Fb){if(Ic){const ld=!this.element;ld&&this.ftf(pa.ownerDocument);ld||!this.element.parentNode?pa.appendChild(this.element):this.element.parentNode!==pa&&(this.element.parentNode.removeChild(this.element),pa.appendChild(this.element));this.bDd=Fb;pa=this.tq.user.color;this.e3a.style.borderColor=pa;this.Wbb||(this.sQc.style.borderColor=pa);this.element.id=Of.nqb(this.tq);Mb.Beb&&(this.element.style.height=Mb.height+"px",this.element.style.top=
Mb.top+"px",this.element.style.left=Mb.left+"px",this.e3a.style.height=Mb.WUi+"px",this.ewe())}this.xbd=!Ic;this.bte()}else l.ULS.sendTraceTag(520950942,302,50,`Skip IpControl rendering due to paragraphElement is null:${!pa} or paragraphViewElement is null:${!Fb}`)}dispose(){this.element&&(this.K0(),this.qx.xc(If.a.iM,this.element,this.mS),this.Wbb&&(this.qx.xc(If.a.zH,this.element,this.eM),this.qx.xc(If.a.jt,this.element,this.moe)),Te.a.LD(this.ho),this.element=this.ho=null);super.dispose()}j7j(pa){const Fb=
this.tq.user.color;this.e3a.style.borderColor=Fb;this.Wbb||(this.sQc.style.borderColor=Fb);this.element.id=Of.nqb(this.tq);this.updatePosition(pa)}xHm(pa,Fb,Mb,Ic){let ld=pa.y,Kd=pa.x;pa=pa.height;(1<Math.abs(Fb.width-Mb.offsetWidth)||1<Math.abs(Fb.height-Mb.offsetHeight))&&Ic&&(ld=Math.round(ld/Ic.Cj),Kd=Math.round(Kd/Ic.Cj),pa=Math.round(pa/Ic.Cj));return{left:Kd,top:ld,height:pa}}GAi(pa){const Fb=this.tq.ip;if(!Fb)return null;let Mb;try{const Ic=Fb.hca.cp;Mb=Gi.a.t2(Ic,pa,0<Ic,!1,!1,!1)}catch(Ic){l.ULS.sendTraceTag(4301318,
302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",Gb.a.instance.iz,Ic.message,Ic.stack),Mb=null}return Mb}}Pi.rco="WacPawn";Pi.$Ui=2;Pi.Lmp=7E3;Pi.Mmp=2E3;Pi.Btc=5;Pi.zho="presenceIp";Pi.Cho="PresenceSmallBox";Pi.yej=10;Pi.gPl="0xcccccc";Object(f.a)(Pi,"PresenceIpControl",Of,[]);class El{constructor(pa,Fb,Mb,Ic,ld=null,Kd=null,ue=null){this.TFc={};this.RFc={};this.qbh={};this.lRc=pa;this.qx=Fb;this.io=Mb;this.jQa=Ic;this.JZ=ld;this.Ga=Kd;this.pF=ue}get CNl(){return this.TFc}get eci(){return this.RFc}tHm(pa){const Fb=
!!this.Ga&&this.Ga.$("PeoplesWellExtraButtonInfoIsEnabled");return pa.ip.shapeId&&Fb?this.yHm(pa):this.zHm(pa)}yHm(pa){const Fb=pa.ip.shapeId.toString();this.qbh[pa.user.clientId]=Fb;const Mb=this.RFc[Fb];return Mb?(Mb.tq=pa,{returnValue:Mb,OFe:!0}):{returnValue:this.RFc[Fb]=new Pf(pa,this.lRc,this.qx,this.io,this.jQa,this.JZ,this.Ga),OFe:!1}}zHm(pa){const Fb=pa.user.clientId,Mb=this.TFc[Fb];return Mb&&Mb.tq.user.equals(pa.user)?(Mb.tq=pa,{returnValue:Mb,OFe:!0}):{returnValue:this.TFc[Fb]=new Pi(pa,
this.lRc,this.qx,this.io,this.jQa,this.JZ,this.Ga,this.pF),OFe:!1}}HAi(pa){return this.TFc[pa]}Uwm(pa){return(pa=this.RFc[this.qbh[pa]])&&!pa.RFe()?pa:null}YWl(){var pa=this.TFc;for(const Fb in pa)pa[Fb].dispose();pa=this.RFc;for(const Fb in pa)pa[Fb].dispose()}}Object(f.a)(El,"PresenceControlProvider",null,[]);var Kh=d(618);class Vi{constructor(){this.lkb=0}JCi(){this.lkb++;this.lkb===Number.MAX_VALUE&&(this.lkb=1);return this.lkb}static get instance(){return Vi.qNc}}Vi.qNc=new Vi;Object(f.a)(Vi,
"PacketIdGenerator",null,[860]);class Bj{constructor(pa,Fb,Mb){this.xOo=pa;this.y6m=Fb;this.S5i=Mb}}Object(f.a)(Bj,"SuccessfulInboundReplicationCallbackData",null,[]);class ci{constructor(pa,Fb,Mb,Ic,ld,Kd,ue){this.VLo=(Ye,Bf)=>{Bf.type||(Ye=this.im.Qii>=this.$uk,this.gRk&&Ye?(Ye=this.FTe())?Ye.lBf():l.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.RA())};this.L5n=Ye=>{if(Ye=Object(z.a)(Bj,Ye)){var Bf=Ye.y6m.Hi.toString(),Fg=
this.FTe(),ah=Fg.lr,Rg="";ah!==Ye.S5i&&(l.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",Ye.xOo.toString()),Rg=this.rCm(Fg,ah,Ye.S5i));l.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",Rg,Bf)}else l.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.TLo=pa;this.FTe=Fb;this.im=Mb;this.gRk=ld;this.$uk=Kd;this.H8b=Ic;this.Sp=ue;this.TLo.TO(this.VLo)}RA(){const pa=this.FTe();if(!pa)l.ULS.sendTraceTag(19682514,
500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.H8b()&&pa.abd){let Fb=-1;null!=pa&&(Fb=pa.dva());const Mb=this.Sp.Xf("Task","ShoulderTapInboundReplicationTimer");pa.RA(this.L5n,null,new Bj(Fb,Mb,pa.lr))}}rCm(pa,Fb,Mb){const Ic=new Sys.StringBuilder;pa=pa.node.ud.store.getRevision(Fb);if(!pa)return l.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:Fb}),"";for(Ic.append(pa.id.Jt);Fb!==
Mb;){Ic.append(", ");Ic.append(Fb.Jt);pa=pa.ym;if(!pa)break;Fb=pa.id}return Ic.toString()}}Object(f.a)(ci,"ContentNotificationManager",null,[]);class Mg extends ci{constructor(pa,Fb,Mb,Ic,ld,Kd,ue){super(pa,Fb,Mb,Ic,ld,Kd,ue)}static get mva(){return null!=Mg.H3g?Mg.H3g:Mg.H3g=Ha.a.instance.resolve(545)}static init(){if(gb.StaticActiveAppFrame.za()){var pa=gb.StaticActiveAppFrame.za().kb;pa&&(pa.Sja(Mg.Sed),pa=pa.ed)&&(Mg.AJ=pa.xg,Mg.AJ&&tb.a.Rsa().continueWith(Mg.Feg))}}static Feg(){Mg.dyd=tb.a.Rsa().result;
Mg.dyd&&Mg.dyd.wn&&Mg.mva.oD().continueWith(Mg.Qfd)}static Qfd(){Mg.Zh=Mg.mva.oD().result;if(Mg.Zh){var pa=m.AFrameworkApplication.J,Fb=pa.$("Box4ThrottleInboundRequests");pa=pa.fc("Box4ThrottleInboundsAtUserCount",20);Mg.AJ.glc=()=>Mg.Zh.Lba;Mg.ayd=Mg.ayd||new Mg(Mg.Zh,()=>Mg.AJ,Mg.dyd,()=>m.AFrameworkApplication.Xl,Fb,pa,gb.StaticActiveAppFrame.za().$r);Mg.ayd.RA()}}static Sed(pa){Mg.ayd||(pa.Bdb(Mg.Sed),Mg.init())}}Mg.ayd=null;Mg.Zh=null;Mg.AJ=null;Mg.dyd=null;Object(f.a)(Mg,"WordContentNotificationManager",
ci,[]);class ij{constructor(pa,Fb,Mb,Ic,ld,Kd){this.Vyd=null;this.hAh=pa;this.zd=Mb;this.iSa=Ic;this.HC=ld;this.pi=Kd;this.C3b=Fb}clone(){return new ij(this.hAh,this.C3b.clone(),this.zd,this.iSa,this.HC,this.pi)}get cp(){if(null!=this.Vyd)return this.Vyd;var pa=this.hAh.paragraphId;if(pa.equals(Fd.a.nil))return 0;var Fb=this.iSa();if(!Fb)return 0;pa=Fb.Eb(pa);if(!pa)return l.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;Fb=this.zd.FMb(this.zd.mZa(pa.characterData,
pa.ra),this.C3b);if(this.HC){const Mb=fb.a.Tc(pa,Fb);this.pi&&pa.Pv&&(Mb.Fb=this.pi.YLf(pa,Fb,this.C3b.SIa));Fb=this.HC.Lza(Mb,!0)}return Fb}Rgg(){null==this.Vyd&&(this.Vyd=this.cp)}equals(pa){return pa?this.C3b.isEqual(pa.C3b,!1):!1}}Object(f.a)(ij,"WordPresenceCp",null,[875,218,876]);class fl{constructor(pa,Fb){this.HC=pa;this.pi=Fb}create(pa,Fb,Mb,Ic){return new ij(pa,Fb,Mb,Ic,this.HC,this.pi)}}Object(f.a)(fl,"Factory",null,[859]);class Mi extends Sys.EventArgs{constructor(pa,Fb,Mb){super();this.paragraphId=
pa;this.WI=Fb;this.vXf=Mb}}Object(f.a)(Mi,"ParagraphChangedEventArg",Sys.EventArgs,[]);class dk{constructor(pa){this.cp=pa}equals(pa){return pa?this.cp===pa.cp:!1}clone(){return new dk(this.cp)}}Object(f.a)(dk,"PresenceCp",null,[875,218]);class zg{constructor(pa,Fb,Mb,Ic,ld){this.paragraphId=pa;this.cp=Fb;this.length=Mb;this.shapeId=Ic;this.dryDeletion=ld}}Object(f.a)(zg,"SerializablePresenceIpData",null,[]);class Gf{constructor(pa,Fb,Mb,Ic=0,ld=0){this.Rxa=null;pa&&(this.Rxa=Fd.a.Af(pa));this.gAh=
new dk(Fb);this.dNa=Mb;this.HEh=Ic;this.Wfh=ld}get paragraphId(){return this.Rxa}get hca(){return this.gAh}get shapeId(){return this.HEh}get dryDeletion(){return this.Wfh}isValid(){return 0<=this.hca.cp&&!!this.paragraphId&&!this.paragraphId.equals(Fd.a.nil)}getData(){return new zg(this.paragraphId.toString(),this.hca.cp,this.dNa,this.shapeId,this.dryDeletion)}clone(){const pa=new Gf;pa.Rxa=this.paragraphId;pa.gAh=this.hca?this.hca.clone():null;pa.dNa=this.dNa;pa.HEh=this.shapeId;pa.Wfh=this.dryDeletion;
return pa}static KMb(pa){return pa.paragraphId&&void 0!==pa.cp&&null!==pa.cp&&void 0!==pa.length&&null!==pa.length?new Gf(pa.paragraphId,pa.cp,pa.length,void 0,pa.dryDeletion):null}}Object(f.a)(Gf,"PresenceIp",null,[873,218]);class Ag{constructor(pa,Fb){this.ip=pa;this.user=Fb}}Object(f.a)(Ag,"SerializablePresenceData",null,[]);class Ti{constructor(pa,Fb){this.W_a=this.hga=this.Brc=!1;this.d3a=Fb;this.user=pa}get ip(){return this.d3a}bOf(){return new Ag(this.ip?this.ip.getData():null,this.user.getData())}ozi(){return this.user.clientId+
(this.d3a?this.d3a.paragraphId.toString():Fd.a.nil.toString())}isValid(){const pa=!!this.user&&this.user.isValid(),Fb=!this.ip||this.ip.isValid();return pa&&Fb}clone(){const pa=new Ti;pa.user=this.user?this.user.clone():null;pa.d3a=this.d3a?this.d3a.clone():null;pa.hga=this.hga;pa.Brc=this.Brc;pa.W_a=this.W_a;return pa}static KMb(pa){return pa?new Ti(Ta.KMb(pa.user),pa.ip?Gf.KMb(pa.ip):null):null}}Object(f.a)(Ti,"PresenceInfo",null,[868,218]);class em extends ea.a{constructor(){super();this.CNc={};
this.J1a={};this.fih=!1}get W$n(){return this.CNc}get c0i(){return!!m.AFrameworkApplication.J&&m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled")}nQh(pa){this.addHandler("PPC",pa)}CEj(pa){this.removeHandler("PPC",pa)}m4c(pa){return pa.ip.paragraphId.toString()}pff(pa,Fb=!1){this.fih||(this.fih=!0,l.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var Mb=({Aho:Ic}=this.awn(pa)).returnValue;if(Ic&&!Fb)(Mb=this.J1a[pa.user.clientId])&&0<=Mb.length&&(Mb[Mb.length-
1].ip.dNa=pa.ip.dNa);else{Mb||this.sDj(pa.user.clientId);this.c0i&&Mb&&this.Izp(pa);Fb=this.m4c(pa);var Ic=pa.user.clientId;var ld=this.CNc[Fb]||[],Kd=this.J1a[Ic]||[];Kd.length>=em.kdj&&(Kd=Kd.splice(-em.vVn,em.kdj));Mb||ld.push(Ic);Kd.push(pa);this.CNc[Fb]=ld;this.J1a[Ic]=Kd;pa.ip.paragraphId.equals(Fd.a.nil)||this.Tpg(pa.ip.paragraphId,pa,!0)}}awn(pa){var Fb=this.J1a[pa.user.clientId];const Mb=!Fb||0>=Fb.length?null:Fb[Fb.length-1],Ic=!!Mb&&this.m4c(Mb)===this.m4c(pa);Fb=Ic&&Mb.ip.hca.equals(pa.ip.hca)&&
Mb.user.equals(pa.user);this.c0i&&Fb&&Mb.ip.shapeId&&pa.ip.shapeId&&Mb.ip.shapeId!==pa.ip.shapeId&&(Fb=!1);return{returnValue:Ic,Aho:Fb}}Izp(pa){const Fb=this.PNl(pa);Fb&&Fb.ip.shapeId&&(pa.ip.shapeId&&pa.ip.shapeId===Fb.ip.shapeId||this.Tpg(Fb.ip.paragraphId,Fb,!1))}PNl(pa){pa=this.J1a[pa.user.clientId];return!pa||0>=pa.length?null:pa[pa.length-1]}sDj(pa){const Fb=this.J1a[pa];if(Fb&&0<Fb.length){const Mb=Fb[0].ip.paragraphId,Ic=this.m4c(Fb[0]);delete this.J1a[pa];this.vBo(Ic,pa);Mb.equals(Fd.a.nil)||
this.Tpg(Mb,Fb[0],!1)}}gvi(pa){return this.CNc[pa]}b2c(pa,Fb,Mb,Ic=!1){const ld=[],Kd=this.gvi(pa);if(!Kd)return ld;for(let ue=0;ue<Kd.length;ue++){const Ye=Kd[ue],Bf=this.J1a[Ye];let Fg=!1;for(let ah=Bf.length-1;0<=ah;ah--){const Rg=Bf[ah];if(Ic){if(Rg.hga&&Rg.ip.paragraphId.equals(Fd.a.Af(pa))){Fg=!0;ld.push(Rg);break}}else if(Object(jh.a)(Ti,Rg)?Rg.ip.dNa===Fb:Rg.ip.dNa===Mb){Fg=!0;Rg.Brc=!0;ld.push(Rg);this.J1a[Ye]=Bf.splice(ah,Bf.length);break}}!Fg&&0<Bf.length&&Bf[0].Brc&&Bf[0].ip.paragraphId.equals(Fd.a.Af(pa))&&
ld.push(Bf[0])}return ld}uim(pa){if(!pa||!pa.Qa||!pa.Qa.node)return null;pa=this.b2c(pa.Qa.node.id.toString(),0,0,!0);pa=this.QRm(pa);pa.sort((Fb,Mb)=>{if(!(Fb&&Fb.userName&&Mb&&Mb.userName))return l.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return pa}QRm(pa){if(!pa||!pa.length)return[];const Fb=[],Mb=new C.a(H.a.vh());for(let Ic=0;Ic<pa.length;Ic++){const ld=pa[Ic].user;ld.isAnonymous&&Mb.contains(ld.clientId)||!ld.isAnonymous&&ld.email&&Mb.contains(ld.email)||
(Fb.push(ld),Mb.add(ld.isAnonymous?ld.clientId:ld.email))}return Fb}Tpg(pa,Fb,Mb){this.raiseEvent("PPC",new Mi(pa,Fb,Mb))}vBo(pa,Fb){Array.remove(this.CNc[pa],Fb)}}em.kdj=10;em.vVn=2;Object(f.a)(em,"PresenceDataManager",ea.a,[1591]);class Eg extends em{constructor(pa){super();this.CG=pa}pff(pa,Fb=!1){super.pff(pa,Fb)}m4c(pa){return pa.ip.Zc.toString()}gvi(pa){pa=this.CG.Eb(Fd.a.Af(pa));if(!pa)return null;pa=pa.ka(jg.a.Zc,0);return this.W$n[pa.toString()]}}Object(f.a)(Eg,"WordPresenceDataManager",
em,[]);var Md=d(1370),Re=d(1266),Vm=d(1902),um=d(36),ce=d(1277);class nd{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf,Fg,ah,Rg,Dh,ej,ak,df,dc,zc,je,Le,Ed,rj,ad,$f){this.lTa=Array(5);this.dcf=this._started=this.m8e=!1;this.K4e=null;this.IAh=new C.a(H.a.vh());this.jJd={};this.nYe=!1;this.D$n=()=>{if(!this.dcf&&!this.Hl.vz){var dg=new za.a(0,1,20,()=>{const Wg=new R.a;var Ji=this.ykb.CNl;for(var Gl in Ji){const ma=Ji[Gl];ma.xbd&&Wg.add(ma.tq.ip.paragraphId)}if(this.Lle){Ji=this.ykb.eci;for(const ma in Ji)Gl=
Ji[ma],Gl.xbd&&!Wg.contains(Gl.tq.ip.paragraphId)&&Wg.add(Gl.tq.ip.paragraphId)}this.nti(Wg);this.dcf=!1},72);this.Gb.Yb(dg);this.dcf=!0}};this.ulj=()=>{this.m8e&&(this.Vxg(),this.m8e=!1)};this.m8=(dg,Wg)=>{this.qMj(Wg.Tm.currentSelection)};this.gV=(dg,Wg)=>{dg=Wg.hia;for(var Ji in dg){const Gl=dg[Ji];this.Ga.$("CashTelemetryIsEnabled")&&this.C_c(Gl,new Date,null);Gl.ip?this.gff(Gl):this.Qkd(Gl.user.clientId)}Wg=Wg.xZc;for(Ji=0;Ji<Wg.length;++Ji)this.nSl(Wg[Ji]);this.tue()};this.Sgg=(dg,Wg)=>{Wg.paragraphId?
this.KBp(Wg.paragraphId.toString(),Wg.XAn,this.jJd):l.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.mvj=(dg,Wg)=>{Wg.paragraphId&&(dg=this.MK.Eb(Wg.paragraphId))&&((Object(jh.a)(Ti,Wg.WI)?this.vTe(dg):this.wTe(dg))===Wg.WI.ip.dNa&&this.qOo(Wg.paragraphId),this.Lle&&this.Bho(Wg))};this.Yp=pa;this.ib=Ic;this.pF=ld;this.jHb=Kd;this.Hl=Bf;this.Yuk=Fg;this.ykb=ah;this.MK=Mb;this.vTe=Dh;this.wTe=ej;this.$mk=ue;this.avk=Ye;this.cSa=ak;this.Pq=df;this.Qc=dc;this.Gb=zc;this.ZHh=rj;this.aLk=$f;this.L4e=
Le;this.Ga=Ed;this.NId=Fb;nd.QJd=new jc.a;for(pa=0;pa<this.NId.length;pa++)this.NId[pa].Jxo(this);this.jHb.nQh(this.mvj);this.Yp.Wya(this.gV);ad&&this.Hl.r6(this.D$n);this.Yp.Ite(this)}get Lle(){return!!this.Ga&&this.Ga.$("PeoplesWellExtraButtonInfoIsEnabled")}tue(pa=!1){this.ZHh&&!pa||this.PEj()}PEj(){const pa=new R.a,Fb=this.jJd;for(const Mb in Fb)pa.add(Fd.a.Af(Mb));this.nti(pa);this.jJd={}}Vxg(){this.ib.gb&&this.qMj(this.ib.gb.currentSelection,!0)}qMj(pa,Fb=!1){this.aLk||(this.MK.Am.pma||Fb?pa?
(Fb=this.kKl(pa))?this.Yp.hyg(Fb):(this.Yp.hyg(null),l.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",pa.Qa.contextId)):this.Yp.hyg(null):this.m8e=!0)}kKl(pa){if(!this.Lle||!pa.fub)if(pa=um.a.yk(pa,!0,!1),!um.a.Fm(pa))return null;return this.aYh(pa)}aYh(pa){const Fb=pa.Qa.cpBegin,Mb=pa.Qa.node.id;pa=this.vTe(pa.Qa.node);return new Gf(Mb.toString(),Fb,pa)}C_c(pa,Fb,Mb){if(this.L4e)if(pa&&pa.user&&pa.user.clientId){var Ic=pa.user.clientId;this.IAh.contains(Ic)||(this.K4e?(this.K4e.C_c(Ic,
Fb,null,nd.nKm(Mb||pa.user.client)),this.IAh.add(Ic)):this.L4e.continueWith(()=>{this.K4e=this.L4e.result;this.C_c(pa,Fb,Mb)}))}else l.ULS.sendTraceTag(42262876,302,15,"invalid presence")}vHm(pa){const Fb=new R.a;for(let Mb=0;Mb<pa.length;Mb++)Fb.add(this.HRm(pa[Mb]));return Fb}gff(pa){var Fb=null;pa&&pa.user&&(Fb=pa.user.client);pa=pa.clone();pa.user=this.pF.p7f(pa.user.clientId)||pa.user;this.Ga.$("CashTelemetryIsEnabled")&&this.C_c(pa,new Date,Fb);pa.isValid()&&!pa.user.FN()&&(Fb=pa.user.clientId,
nd.QJd.mb(Fb)||this.bMi(Fb),this.zBp(Fb),pa.user.userName=CommonUIStrings.l_AnonymousUserName);this.jHb.pff(pa,!1)}zBp(pa){const {value:Fb}=nd.QJd.Ec(pa,!1);Fb||(nd.QJd.W(pa,!0),l.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+pa+'" , "Event" : "CreateAnonymousGrayPawn"}'))}bMi(){}Qkd(pa){this.jHb.sDj(pa)}nSl(pa){this.Qkd(pa);const Fb=this.ykb.HAi(pa);Fb&&(Fb.XDj(this.Sgg),Fb.dispose());this.Lle&&(pa=this.ykb.Uwm(pa))&&(pa.XDj(this.Sgg),pa.dispose())}Okc(pa){if(12!==pa.type)return new R.a;pa=
this.jHb.b2c(pa.id.toString(),this.vTe(pa),this.wTe(pa));return 0>=pa.length?new R.a:this.vHm(pa)}KBp(pa,Fb,Mb){!Fb&&pa in Mb&&delete Mb[pa]}dispose(){this.stop();this.jHb.CEj(this.mvj);this.Yp.b_a(this.gV);this.Yp.tLg(this);for(let pa=0;pa<this.NId.length;pa++)this.NId[pa].wvp(this);Te.a.Hwg([this.$mk,this.avk,this.Yp]);this.ykb.YWl()}HRm(pa){let Fb=!1;pa=({OFe:Fb}=this.ykb.tHm(pa)).returnValue;Fb||pa.l1k(this.Sgg);return pa}aKi(pa){pa=this.MK.Eb(pa);if(!pa)return this.lTa[0]||(l.ULS.sendTraceTag(4281420,
302,50,"Could not find the node in object space"),this.lTa[0]=!0),null;if(!eb.ParagraphReader.Vb(pa))return this.lTa[1]||(l.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.lTa[1]=!0),null;if(!pa.Ce(this.Hl.sc))return this.lTa[2]||(l.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.lTa[2]=!0),null;if(!pa.anchor)return this.lTa[3]||(l.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.lTa[3]=!0),null;this.lTa[4]||(l.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),
this.lTa[4]=!0);return pa}YCj(pa){pa=this.jHb.b2c(pa.toString(),-1,-1,!0);if(!Ie.a.Uf(pa))for(const Fb of pa)(pa=this.ykb.HAi(Fb.user.clientId))&&pa.element&&pa.K0()}nti(pa){if(pa.count){var Fb=new R.a;for(var Mb of pa)(pa=this.aKi(Mb))?Fb.add(pa):this.YCj(Mb);if(Fb.count){Mb=this.Qc.Lc(2);try{Mb.set(this.Pq);for(const Ic of Fb)this.lhi(Ic)}finally{Mb&&Mb.dispose()}}}}lhi(pa){pa.PL(this.Hl.sc,32,!0);pa.PL(this.Yuk,32,!0)}qOo(pa){this.jJd[pa.toString()]=null;this.ZHh&&!this.nYe&&(pa=new za.a(0,1,200,
()=>{this.nYe=!1;this.PEj()},70),this.Gb.Yb(pa),this.nYe=!0)}Bho(pa){if(pa.WI.ip.shapeId&&!pa.vXf){var Fb=this.ykb.eci[pa.WI.ip.shapeId.toString()];Fb&&Fb.zdb(pa.WI.user.clientId)}}stop(){this._started&&(this._started=!1,this.ib.hha(this.m8),ce.a.instance.xEj(this.ulj))}start(){if(!this._started){this._started=!0;this.ib.BA(this.m8);ce.a.instance.HRd(this.ulj);var pa=this.Yp.xqb();delete pa[this.cSa.clientId];this.gV(null,new Vm.a(pa,[]));this.Vxg()}}Rze(pa){if(pa&&pa.isValid()&&pa.ip){var Fb=this.jHb.b2c(pa.ip.paragraphId.toString(),
-1,-1),Mb=!1,Ic=null;for(let ld=0;ld<Fb.length;ld++)if(Ic=Fb[ld],Ic.user.clientId===pa.user.clientId){Mb=Ic.W_a=!0;break}if(Mb)if(Fb=Ic.ip.paragraphId,pa=this.aKi(Fb)){Fb=this.Qc.Lc(2);try{Fb.Ab(pa),this.lhi(pa)}finally{Fb&&Fb.dispose()}}else this.YCj(Fb)}}static nKm(pa){return pa?pa?1===pa?1:2===pa?2:0:2:0}}nd.QJd=null;Object(f.a)(nd,"PresenceManager",null,[1592,11,826,1593,1594,1595]);class Sk{constructor(pa,Fb,Mb,Ic){this.c6b=null;this._started=this.OWe=!1;this.BJb=null;this.uua=(ld,Kd)=>{if(!m.AFrameworkApplication.Xl&&
(ld=this.l8j(Kd.Tm),this.c6b&&ld)){ld=this.lPe.b2c(this.c6b.toString(),-1,-1,!0);for(Kd=0;Kd<ld.length;Kd++)this.BJb[ld[Kd].user.clientId]=ld[Kd];0>=ld.length||(ld=this.FGl(ld),this.Vp.sendNotification(ld,!0))}};this.gnj=(ld,Kd)=>{this.ib.gb&&!m.AFrameworkApplication.Xl&&this.OWe&&this.c6b&&this.c6b.equals(Kd.paragraphId)&&(ld=null,!Kd.vXf||Kd.WI.user.clientId in this.BJb?Kd.vXf||(ld=this.xai(Kd.WI.user.userName,!1),delete this.BJb[Kd.WI.user.clientId]):(ld=this.xai(Kd.WI.user.userName,!0),this.BJb[Kd.WI.user.clientId]=
Kd.WI),ld&&this.Vp.sendNotification(ld,!0))};this.Zh=Ic;this.ib=Fb;this.lPe=pa;this.Vp=Mb;this.Zh.Ite(this)}start(){this._started||(this._started=!0,this.BJb={},this.lPe.nQh(this.gnj),this.ib.BA(this.uua),this.l8j(this.ib.gb))}stop(){this._started&&(this._started=!1,this.BJb=null,this.lPe.CEj(this.gnj),this.ib.hha(this.uua))}FGl(pa){if(1===pa.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,pa[0].user.userName);const Fb=[],Mb=pa.length;for(let Ic=0;Ic<Mb;Ic++)Fb.push(pa[Ic].user.userName);
return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,Fb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}xai(pa,Fb){return String.format(Fb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,pa)}dispose(){this.Zh.tLg(this);this.stop()}l8j(pa){if(!pa)return!1;pa=pa.currentSelection;if(!pa)return!1;pa=pa.Qa;if(!pa)return!1;this.OWe=um.a.qf(pa);pa=pa.node.id;if(pa.equals(this.c6b)||!this.OWe)return!1;this.c6b=pa;this.BJb={};return!0}}Object(f.a)(Sk,
"PresenceAccessibilityManager",null,[11,826]);class tg{constructor(pa,Fb){this._started=!1;this.MM=null;this.iEd=!1;this.ffd=()=>{this._started&&this.bMj()};this.Zh=pa;Fb&&(this.MM=Fb,this.MM.rmb(this.ffd));this.Zh.Ite(this)}start(){this._started||(this._started=!0,this.MM?this.bMj():this.Zh.tC(1,this.c$h()))}bMj(){const pa=this.iEd;(this.iEd=!!this.MM.kz)&&!pa&&this.Zh.tC(1,this.c$h())}c$h(){const pa={};pa.Id="{"+m.AFrameworkApplication.userSessionId.toUpperCase()+"}";pa.HQ=!1;pa.NT=1;pa.WEB=!0;
return pa}stop(){this._started&&(this._started=this.iEd=!1)}dispose(){this.Zh.tLg(this);this.MM&&this.MM.ZDj(this.ffd)}}Object(f.a)(tg,"EditorsTableNotifier",null,[11,826]);var Bk=d(338),jj=d(18);class af extends nd{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf,Fg,ah,Rg,Dh,ej,ak,df,dc,zc,je,Le,Ed,rj,ad,$f,dg,Wg,Ji,Gl,ma,db,Ob){super(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf,Fg,ah,Dh,ej,ak,df,je,Le,Ed,rj,ad,$f,dg,Wg,ma);this.im=null;this.O_l=Qb=>{const sc=!!this.im.nA.Qjc(Qb);l.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",
Qb,sc)};this.N_l=(Qb,sc)=>{l.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",sc,Qb)};this.Tma=()=>{if(2===af.Zh.connectionState&&!Na.SessionStatusManager.instance.pba){const Qb={};Qb.qs=m.AFrameworkApplication.rootQuerySignature;af.Zh.o9(Qb)}};Rg.fb(jj.a.D$o,kc.a.application,af.FZk,64);Rg.fb(jj.a.Csg,kc.a.application,af.Csg,64);Rg.fb(jj.a.mpg,kc.a.application,af.mpg,96);Rg.fb(qa.a.Rze,kc.a.application,af.C$o,64);this.cL=dc;this.zd=zc;this.TJb=Ji;
this.cSa.yuc=Gl;this.cSa.yuc.o3k(af.hnj);db.continueWith(()=>{this.im=db.result});l.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");(this.Y1=Ob)&&this.Y1.execute(Qb=>{Qb.DTa(this.Tma)})}Ukc(pa){if(!pa||!pa.anchor)return null;for(pa=pa.anchor.Lr;pa;pa=pa.jC)if(pa.GLa)return pa.gt.node;return null}aYh(pa){var Fb=null;Fb=m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled");var Mb=pa.Qa.cpBegin,Ic=pa.Qa.node;Fb&&Ph.a.Lt(Ic)&&(Ic=this.Ukc(Ic));if(!Ic)return l.ULS.sendTraceTag(51242309,
302,15,"selectedNode is null"),null;Ic=this.wTe(Ic);const ld=pa.Qa.node.ka(jg.a.Zc,0);if(!this.cL)return l.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var Kd=this.cL.value.irb(ld);const ue=af.CG.Eb(Kd);if(!ue)return l.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+Kd),null;Mb=this.zd.$Bc(this.zd.mZa(ue.characterData,ue.ra),Mb);Mb.SIa=-1===pa.Qa.Fb?0:pa.Qa.Fb;Kd=0;Fb&&pa.fub&&(Kd=this.aMm(pa));return Fb=new rf(this.cL.value,ld,Ic,Mb,this.zd,()=>af.CG,this.TJb,Kd)}aMm(pa){const Fb=
Ph.a.AKa(pa.Qa);return Fb?Fb.properties.ka(jg.a.bpb,0):pa.Qa.node.properties.ka(jg.a.bpb,0)}bMi(pa){this.im&&this.im.asa&&this.im.asa.RA(this.O_l,this.N_l,pa)}dispose(){this.Y1&&this.Y1.execute(pa=>{pa.HZb(this.Tma)});super.dispose()}static get Gw(){return Ha.a.instance.resolve(25)}static oD(){return af.CJc.task}static get_instance(){return af.PJd.task}static AHm(){return af.iAh.task}static get mva(){return null!=af.G3g?af.G3g:af.G3g=Ha.a.instance.resolve(545)}static init(){af.PJd||(af.PJd=new w.a);
af.rih&&(l.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),af.rih=!1);if(gb.StaticActiveAppFrame.za()){var pa=gb.StaticActiveAppFrame.za().kb;pa?(pa.Sja(af.Sed),af.xNc=pa.Jc,pa.zta()?(af.KQ=pa.ed.xg,af.KQ?(af.CG=pa.ed.ud,af.CG?af.mva.oD().continueWith(af.H4n):l.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):l.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):
l.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):l.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else l.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static H4n(){af.Zh=af.mva.oD().result;if(af.Zh){var pa=[af.xNc.tgd,af.xNc.Ke.tgd],Fb=ab.a.instance,Mb=Ha.a.instance.resolve(1645),
Ic=new Sk(Mb,Fb,af.Gw,af.Zh),ld=m.AFrameworkApplication.J.$("DoNotAddToEditorsTableOnFrameIsEnabled")?tb.a.vd().nA:null;ld=new tg(af.Zh,ld);var Kd=Ha.a.instance.rf(700),ue=Ha.a.instance.resolve(1235),Ye=Ha.a.instance.resolve(615);af._instance=new af(af.Zh,pa,af.CG,Fb,Ye,Mb,Ic,ld,af.xNc,af.xNc.Ke.sc,Ha.a.instance.resolve(1646),m.AFrameworkApplication.va,af.KQ,eb.ParagraphReader.textLength,eb.ParagraphReader.bsa,Ha.a.instance.resolve(1647),Kd,ue,sa.a.ff.Pl,new Bk.a,Gb.a.instance,Md.a.get_instance(),
Wa.a.iq(Ha.a.instance.Ra(1641)),m.AFrameworkApplication.J,m.AFrameworkApplication.J.$("Box4ThrottleAndBatchPresenceRendering"),m.AFrameworkApplication.J.$("Box4DoNotRenderPresenceOutOfView"),Ha.a.instance.resolve(1644),Ha.a.instance.resolve(1648),!sa.a.yt&&!sa.a.nn,tb.a.Rsa(),Ha.a.instance.Ra(723));l.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");af.PJd.hg(af._instance);af.CJc.hg(af._instance);af.iAh.hg(af._instance);pa=Ha.a.instance;pa.ia(1649,()=>af._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").ha();
pa.resolve(1649)}else l.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static Sed(pa){af._instance||(l.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(pa=Object(z.a)(858,pa))&&pa.Bdb(af.Sed),af.init())}static hnj(){af._instance.Vxg()}static FZk(pa,Fb,Mb,Ic,ld){Mb=ld.split(",");if(!Mb||3!==Mb.length)return 8;pa=Mb[0].trim();Fb=Mb[1].trim();Mb=Number.parseInvariant(Mb[2].trim());
pa=new Ti(new Ta(pa),new Gf(Fb,Mb,-1));if(!af.CJc.task.isCompleted)return 8;Fb=af.oD().result;Fb.gff(pa);Fb.tue();return 32}static Csg(pa,Fb,Mb,Ic,ld){if(!af.CJc.task.isCompleted)return 8;pa=af.oD().result;pa.Qkd(ld);pa.tue();return 32}static C$o(pa,Fb,Mb,Ic,ld){if(!af.CJc.task.isCompleted)return 8;pa=af.oD().result;if(!pa)return 8;pa.Rze(ld);return 32}static mpg(pa,Fb,Mb,Ic,ld){if(1===Mb)return 32;if(!af.mva.oD().isCompleted)return 8;pa=af.mva.oD().result;if(!pa)return l.ULS.sendTraceTag(4301136,
302,10,"rtcProxy is null when trying to display RTC connection status"),8;ld[Re.a.Value]=2===pa.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===pa.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:"";return 32}}af._instance=null;af.rih=!0;af.PJd=new w.a;af.CJc=new w.a;af.iAh=new w.a;af.CG=null;af.xNc=null;af.KQ=null;af.Zh=null;Object(f.a)(af,"WordPresenceManager",nd,[]);class di{constructor(pa){this.sa=new ea.a;this.v1=pa;this.v1.CWR(()=>this.v1.result.n1k(()=>{this.sa.raiseEvent("X")}))}o3k(pa){this.sa.addHandler("X",
pa)}QDo(pa){this.sa.removeHandler("X",pa)}getStatus(){return this.v1.isCompleted&&this.v1.result?this.v1.result.qZd.toString():"0"}}Object(f.a)(di,"WordPresenceStatusProvider",null,[857]);class Fl{constructor(pa,Fb,Mb,Ic){this.Zh=null;this.jih=this.a0e=!1;this.I4n=()=>{this.HO.isCompleted&&this.HO.result?(this.Zh=this.HO.result,this.Zh.Wya(this.gV),l.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):l.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};
this.gV=(ld,Kd)=>{ld=Kd.hia;for(const ue in ld)if(Kd=ld[ue],!this.a0e&&Kd.user.YF&&Kd.user.YF!==this.TH.YF){l.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.TH.YF,Kd.user.YF);this.a0e=!0;break}this.a0e&&this.Zh.b_a(this.gV);this.jih||(l.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.jih=!0)};this.im=pa;this.TH=Fb;this.HO=Mb;Mb.continueWith(this.I4n);this.XFk=Ic;this.XFk.Y5f=this.TH}}Object(f.a)(Fl,"WordPresenceUpdateMonitor",
null,[]);var kh=d(423),Xf=d(1624),fh=d(1358),Cj=d(221),Dj=d(1906),Vl=d(1907),kj=d(1776);class ql{constructor(pa,Fb,Mb,Ic,ld,Kd,ue){this.sa=new ea.a;this.bph=this.$qh=this.nZe=this.Sth=!1;this.jcf=this.xPd=0;this.Pbc=null;this.cSa=Kd;this.cSa.clientId=pa.clientId;this.gl=pa;this.jda=Fb;this.Hda=Ic;this.axk=ld;this.Gb=Mb;this.Xhb=new Cj.a;this.Aq=ue;this.jda&&this.jda.continueWith(()=>{this.jda.yp||this.jda.ij||this.jda.result.mPh(Object($a.a)(this,this.vjj,"onAmIAloneChanged"))})}get connectionState(){return this.gl.connectionState}Wya(pa){this.sa.addHandler("PU",
pa)}b_a(pa){this.sa.removeHandler("PU",pa)}a_(pa){this.sa.addHandler("CSC",pa)}KDa(pa){this.sa.removeHandler("CSC",pa)}vmb(pa){this.sa.addHandler("PSU",pa)}rxb(pa){this.sa.removeHandler("PSU",pa)}umb(pa){this.sa.addHandler("PSC",pa)}qxb(pa){this.sa.removeHandler("PSC",pa)}gyg(){}get clientId(){return this.gl.clientId}TO(pa){this.sa.addHandler("UN",pa)}MDa(pa){this.sa.removeHandler("UN",pa)}q8m(){this.Pbc=Array(12);for(let pa=0;12>pa;pa++)this.Pbc[pa]=0;this.$qh=this.Aq?this.Aq.$("UpdateNotificationTaskExperimentIsEnabled"):
!0;m.AFrameworkApplication.JH(()=>{this.OIn()})}init(){this.gl.a_(Object($a.a)(this,this.mK,"onConnectionStateChanged"));this.gl.Wya(Object($a.a)(this,this.gV,"onPresenceUpdated"));this.gl.vmb(Object($a.a)(this,this.Iga,"onPersistentStateUpdated"));this.gl.umb(Object($a.a)(this,this.TYa,"onPersistentStateCleared"));this.gl.TO(Object($a.a)(this,this.nS,"onUpdateNotificationReceived"));this.n6h();this.q8m()}Ite(pa){this.Xhb.contains(pa,(Fb,Mb)=>Fb===Mb)||(this.Xhb.add(pa),2===this.connectionState&&
pa.start())}tLg(pa){for(let Fb=0;Fb<this.Xhb.length;Fb++)if(this.Xhb.K(Fb)===pa){this.Xhb.oI(Fb);break}}connect(){this.nZe||this.gl.connect()}disconnect(){this.gl.disconnect()}get Ive(){return this.gl}Yei(pa){return Ti.KMb(pa)}Fyg(pa,Fb){return(new Ti(pa,Fb)).bOf()}hyg(pa){pa&&pa.isValid()&&!this.Hda()?this.gl.gyg(this.Fyg(this.cSa.VBm(),pa)):F.Task.j7(null)}cEa(pa,Fb){return this.gl.cEa(pa,Fb)}wqb(pa){return this.gl.wqb(pa)}zjc(){return this.gl.zjc()}tC(pa,Fb,Mb=!1){return this.gl.tC(pa,Fb,Mb)}xqb(){return this.T9h(this.gl.xqb())}o9(pa){const Fb=
new w.a;kj.a.getInstance().ete(pa,Fb);return Fb.task}get Lba(){return this.gl.Lba}mK(pa,Fb){2===Fb.newState&&this.Xhb.forEach(Mb=>{Mb.start();return!0});Fb.newState||this.Aq.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.nZe||this.Xhb.forEach(Mb=>{Mb.stop();return!0});this.sa.raiseEvent("CSC",Fb)}mEf(pa){return pa.toLowerCase()}gV(pa,Fb){if(!this.Hda()){pa=this.T9h(Fb.hia);Fb=this.V9h(Fb.xZc);var Mb=new Vm.a(pa,Fb);Fb=new za.a(0,1,0,()=>{this.sa.raiseEvent("PU",Mb)},57);this.Gb.Yb(Fb)}}T9h(pa){const Fb=
{};for(const Ic in pa){var Mb=Ic;const ld=this.Yei(pa[Ic]);ld&&ld.isValid()?Fb[this.mEf(Mb)]=ld:l.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",Mb)}return Fb}V9h(pa){const Fb=Array(pa.length);for(let Mb=0;Mb<pa.length;Mb++)Fb[Mb]=this.mEf(pa[Mb]);return Fb}Iga(pa,Fb){if(!this.Hda()){var Mb={};pa=Fb.hia;for(var Ic in pa)Mb[this.mEf(Ic)]=pa[Ic];Ic=new za.a(0,1,0,()=>{this.sa.raiseEvent("PSU",new Dj.a(Fb.type,Mb))},80);this.Gb.Yb(Ic)}}TYa(pa,Fb){if(!this.Hda()){pa=this.V9h(Fb.Hnb);var Mb=new Vl.a(pa);
pa=new za.a(0,1,0,()=>{this.sa.raiseEvent("PSC",Mb)},81);this.Gb.Yb(pa)}}nS(pa,Fb){this.$qh?this.spj(Fb):(pa=new za.a(0,1,0,()=>{this.spj(Fb)},58),this.Gb.Yb(pa))}spj(pa){var Fb=Date.now();this.sa.raiseEvent("UN",pa);Fb=Date.now()-Fb;500<=Fb&&(this.xPd++,l.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",pa.type,Fb),this.lam(pa));this.jcf++}lam(pa){0>pa.type||21<=pa.type?l.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",
pa.type):this.Pbc[pa.type]++}OIn(){if(!this.bph){var pa={};pa.TC=this.jcf;pa.HRC=this.xPd;this.Pbc&&0<this.xPd&&(pa.TBC=this.Pbc);this.xPd=this.jcf=0;this.Pbc=null;l.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",pa);this.bph=!0}}dispose(){this.Xhb=new Cj.a;this.gl.KDa(Object($a.a)(this,this.mK,"onConnectionStateChanged"));this.gl.b_a(Object($a.a)(this,this.gV,"onPresenceUpdated"));this.gl.rxb(Object($a.a)(this,this.Iga,"onPersistentStateUpdated"));this.gl.qxb(Object($a.a)(this,
this.TYa,"onPersistentStateCleared"));this.gl.MDa(Object($a.a)(this,this.nS,"onUpdateNotificationReceived"));this.jda&&this.jda.continueWith(()=>{this.jda.yp||this.jda.ij||this.jda.result.RCo(Object($a.a)(this,this.vjj,"onAmIAloneChanged"))});this.gl.disconnect();l.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}vjj(){this.n6h()}n6h(){let pa=!1;this.jda?this.jda.continueWith(()=>{this.jda.yp||this.jda.ij||(pa=!this.jda.result.Eq);this.gl.connectionState||!pa&&!this.axk()?2!==this.gl.connectionState||
pa||(this.disconnect(),l.ULS.sendTraceTag(4564937,302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),l.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.Sth&&pa&&(l.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.Sth=!0)}):(this.connect(),l.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}ahc(){this.nZe=!0;this.disconnect();l.ULS.sendTraceTag(4564938,
302,50,"DisconnectForever")}}Object(f.a)(ql,"RtcProxy",null,[1586,11,1587,1588]);class Pl extends ql{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf,Fg,ah,Rg,Dh){super(pa,Fb,Mb,Ic,ld,Kd,Dh);this.a6=null;this.cL=ue;this.zd=Ye;this.iSa=Bf;this.qNc=Fg;this.Z9e=ah;this.TJb=Rg}get IH(){return this.a6||(this.a6=this.Z9e())}mK(pa,Fb){2===Fb.newState&&l.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.$Bp();super.mK(pa,Fb)}$Bp(){this.IH&&this.IH.sS("RtcConnectionStatusLabel")}Yei(pa){return Rf.ttf(hg(pa),this.cL,
this.zd,this.iSa,this.TJb)}Fyg(pa,Fb){return Object(jh.a)(rf,Fb)?(pa=new Rf(this.qNc.JCi(),pa,Fb),ni(pa.bOf())):super.Fyg(pa,Fb)}}Object(f.a)(Pl,"WordRtcProxy",ql,[]);class on{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf,Fg,ah,Rg,Dh){this.Sq=new w.a;this.pFh=!0;this.Zd=Fb;this.Gb=Mb;this.Hda=Ic;this.cSa=ld;this.cL=Kd;this.Gya=ue;this.iSa=Ye;this.qNc=Bf;this.Z9e=Fg;this.Y1=ah;this.TJb=Rg;this.Ga=Dh}oD(){this.krp();return this.Sq.task}hQb(){return kh.a.then(this.oD(),pa=>pa)}krp(){if(this.pFh)if(this.pFh=
!1,sa.a.f1f()&&sa.a.c_f()){var pa=m.AFrameworkApplication.Ge;if(pa){var Fb="{"+m.AFrameworkApplication.userSessionId+"}",Mb=m.AFrameworkApplication.userSessionId,Ic=m.AFrameworkApplication.zwg,ld=this.Ga.$("RtcAlwaysOnEnabled"),Kd=Ye=>{const Bf=new Pl(Ye,ld?null:tb.a.Rsa(),this.Gb,this.Hda,on.Adm,this.cSa,this.cL,this.Gya,this.iSa,this.qNc,this.Z9e,this.TJb,m.AFrameworkApplication.J);fh.a.b_o(Bf);this.Axo(Bf);Bf.init();Kh.a.PNa=Bf;this.Y1.execute(Fg=>{Fg.tmb(()=>{Bf.ahc()})});this.Sq.hg(Bf)};if(m.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoadRtcFrom1JS",
!1))Promise.all([d.e(4),d.e(2),d.e(10)]).then(d.bind(null,2140)).then(Ye=>{ue=Ye.RealtimeChannelNetCore.createInstance(Fb,Mb,Ic,pa,this.Y1,1,this.Zd,this.Ga.jb("RtcEndpointUrl"),void 0,void 0,null,this.Ga.$("FindSessionOnBootIsEnabled")?Ha.a.instance.resolve(156):null,this.Ga.jb("RtcBootToken"));Kd(ue)});else{var ue=Xf.RealtimeChannel.createInstance(Fb,Mb,Ic,pa,this.Y1,1,this.Zd,this.Ga.jb("RtcEndpointUrl"),void 0,void 0,null,this.Ga.$("FindSessionOnBootIsEnabled")?Ha.a.instance.resolve(156):null,
this.Ga.jb("RtcBootToken"));Kd(ue)}}else l.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else l.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}Axo(pa){const Fb=Ha.a.instance;Fb.ia("WordEditor.Presence.WordRtcProxy",()=>pa).as("Box4.Presence.IRtcProxy").as(138).ha();Fb.resolve(138)}static Adm(){return!1}}Object(f.a)(on,"WordRtcProxyProvider",null,[855,856]);class vl{constructor(){this.Z=
null;this.jm=!1}get name(){return"WordEditor.Presence"}init(){l.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");sa.a.Cck&&(this.Z.resolve(1650).oD(),af.init(),this.Z.resolve(1651));sa.a.VWc&&Mg.init();this.Z.resolve(1652);this.Z.resolve(615);if(vl.Poh){const pa=this.Z.resolve(76);pa.sKb(this.mtc);vl.UXe=1===pa.Et||2===pa.Et}}dispose(){if(!this.jm){this.jm=!0;af.oD().continueWith(()=>{Te.a.LD(af.oD().result)});var pa=this.Z.resolve(1647);pa&&pa.yuc&&pa.yuc.QDo(af.hnj)}}uc(pa){this.Z=pa;this.Z.ia(1647,
()=>new kb).as(1653).as(1654).as(1655).ha();pa.ia(1644,()=>new fl(pa.resolve(17),pa.resolve(13))).ha();pa.ia(1651,()=>new Fl(new V.a(()=>tb.a.vd()),sf.a.instance,pa.resolve(1650).hQb(),pa.resolve(1653))).ha();pa.ia(1650,()=>new on(m.AFrameworkApplication.buildVersion,gb.StaticActiveAppFrame.za().$r,Gb.a.instance,()=>m.AFrameworkApplication.Xl,Ha.a.instance.resolve(1653),Ha.a.instance.Oa(442),Ha.a.instance.resolve(1235),()=>m.AFrameworkApplication.ta&&gb.StaticActiveAppFrame.za().kb&&gb.StaticActiveAppFrame.za().kb.ed?
gb.StaticActiveAppFrame.za().kb.ed.ud:null,Vi.instance,()=>Ha.a.instance.Oa(586),Ha.a.instance.Ra(723),Ha.a.instance.resolve(1644),m.AFrameworkApplication.J)).ha().as(545).as(140);pa.ia(1646,()=>new El(vl.mMl(),xe.a.instance,Ha.a.instance.Ra(6),Ha.a.instance.resolve(427),Wa.a.iq(Ha.a.instance.Ra(618)),m.AFrameworkApplication.J,pa.resolve(615))).ha();pa.ia(1652,()=>new jf(Ha.a.instance.resolve(1654),Ha.a.instance.resolve(1650).hQb(),af.AHm(),Ha.a.instance.resolve(1655),Gb.a.instance,m.AFrameworkApplication.J.$("AwayStatusOneMinuteTimeoutIsEnabled")?
6E4:m.AFrameworkApplication.J.fc("AwayCoauthorThresholdMs",9E5),Object($a.a)(m.AFrameworkApplication.va,m.AFrameworkApplication.va.Ob,"processAction"),gb.StaticActiveAppFrame.za().lK,m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled"))).ha();pa.ia("WordEditor.Presence.WordPresenceStatusProvider",()=>new di(Wa.a.iq(Ha.a.instance.Ra(1622)))).as(1648).ha();pa.ia("Common.App.Presence.PeopleInfoProvider",()=>new dh(pa.resolve(1650).hQb(),tb.a.Rsa().CWR(()=>tb.a.Rsa().result.nA),pa.resolve(151),
pa.resolve(1655),Wa.a.iq(pa.Ra(1652)))).as(615).ha();pa.ia(1645,()=>new Eg(gb.StaticActiveAppFrame.za().kb.ed.ud)).as(1083).ha()}mtc(pa,Fb){gb.StaticActiveAppFrame.za()&&gb.StaticActiveAppFrame.za().nG&&(vl.KId=null,vl.UXe=1===Fb.AMa||2===Fb.AMa)}static get zqj(){!vl.KId&&gb.StaticActiveAppFrame.za()&&gb.StaticActiveAppFrame.za().nG&&(vl.KId=Kh.a.Pm.nG.getElementsByClassName(vl.UXe&&vl.Poh?"PaginatedContentContainerDisplayWrapper":"OutlineContainerDisplayWrapper")[0]);return vl.KId}static mMl(){const pa=
m.AFrameworkApplication.J.$("PeoplesWellExtraButtonInfoIsEnabled"),Fb=m.AFrameworkApplication.J.$("PresenceIgnoreEventOnExpandedTooltip"),Mb=m.AFrameworkApplication.J.$("PresenceIpWidthAdjustForFlyout"),Ic=new Zj;Ic.add(Hg.QRn,Mj.getImageClassWithCluster(m.AFrameworkApplication.Nfa,"MoreUsersGlyph16"));Ic.add(Hg.PRn,m.AFrameworkApplication.Vs);Ic.add(Hg.zco,Mj.getImageClassWithCluster(m.AFrameworkApplication.Nfa,pa?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Ic.add(Hg.Aco,m.AFrameworkApplication.Vs);
Ic.add(Hg.zIndex,1);Ic.add(Hg.rtl,m.AFrameworkApplication.isRtl);Ic.add(Hg.rHp,vl.tSm);Ic.add(Hg.b5m,Fb);Ic.add(Hg.Bfn,Mb);return pa?new Db(Ic):new Ke(Ic)}static tSm(){return vl.zqj?me.a.getElementBounds(vl.zqj):null}}vl.UXe=!0;vl.Poh=m.AFrameworkApplication.J.$("FlippedFlyoutForPaginationViewIsEnabled");vl.KId=null;Object(f.a)(vl,"WordPresencePackage",null,[0,1]);var co=d(1033),fm=d(1286),Hk=d(1043),gn=d(196);class Mm{constructor(pa,Fb){this.hff=pa;this.paragraphId=Fb}get opType(){return 2}get operation(){return this.hff}}
Object(f.a)(Mm,"RttAppliedAddParagraphOp",null,[865]);class sk{constructor(pa,Fb){this.fGo=pa;this.paragraphId=Fb}get opType(){return 6}get operation(){return this.fGo}}Object(f.a)(sk,"RttAppliedReplaceSymbolRangeOp",null,[865]);class km{constructor(pa,Fb){this.jGo=pa;this.paragraphId=Fb}get opType(){return 1}get operation(){return this.jGo}}Object(f.a)(km,"RttAppliedReplaceTextRangeOp",null,[865]);class jk{constructor(pa,Fb,Mb){this.FXj=pa;this.yAe=Fb;this.mYc=Mb}get opType(){return 4}get operation(){return this.FXj}get eUk(){return this.FXj.Yfc()?
this.mYc:this.yAe}}Object(f.a)(jk,"RttAppliedSplitParagraphOp",null,[865]);class gm{constructor(){this.Wgb=new jc.a}Q2f(pa){return pa.toString()}vSc(pa,Fb){pa=this.Q2f(pa);this.Wgb.mb(pa)||this.Wgb.W(pa,new R.a);this.Wgb.K(pa).add(Fb)}zgg(pa){switch(pa.opType){case 1:var Fb=Object(z.a)(km,pa);this.vSc(Fb.paragraphId,pa);break;case 6:Fb=Object(z.a)(sk,pa);this.vSc(Fb.paragraphId,pa);break;case 4:Fb=Object(z.a)(jk,pa);this.vSc(Fb.yAe,pa);this.vSc(Fb.mYc,pa);break;case 2:Fb=Object(z.a)(Mm,pa),this.vSc(Fb.paragraphId,
pa)}}j0n(pa){return this.Tvb(pa)}Tvb(pa){pa=this.Q2f(pa);if(!this.Wgb.mb(pa))return new R.a;const Fb=this.Wgb.K(pa);this.Wgb.remove(pa);for(const Mb of Fb)Mb.operation&&(Mb.operation.W$=null);return Fb}cEm(pa){let Fb;return({value:Fb}=this.Wgb.Ec(this.Q2f(pa),Fb)).returnValue?Fb:new R.a}Ehm(pa){for(const Fb of this.Wgb.values){if(!Fb.count)continue;if(2!==Fb.K(0).opType)continue;const Mb=Fb.K(0);if(Mb.hff.dcg===pa)return Mb}return null}}Object(f.a)(gm,"RttAppliedOpTracker",null,[885]);var wi=d(253),
Nm;(function(pa){pa[pa.F5l=0]="expired";pa[pa.w0p=1]="dried"})(Nm||(Nm={}));Object(f.b)("RemoveChangeReason",Nm);class Ej{constructor(){this.eFa=new wi.a}aWk(pa){if(!pa)return l.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const Fb=pa.Zc,Mb=pa.Vj;this.eFa.mb(Fb)||this.eFa.add(Fb,new wi.a);this.eFa.K(Fb).W(Mb,pa);return this.lOl(Fb,Mb)?(l.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",Fb),this.eFa.K(Fb).remove(Mb),
!1):!0}bMf(pa,Fb){if(!this.eFa.mb(pa))return null;pa=this.eFa.K(pa);return pa.mb(Fb)?pa.K(Fb):null}T7d(pa){const Fb=new R.a;for(const Mb of this.eFa.keys){const Ic=this.eFa.K(Mb);for(const ld of Ic.keys){const Kd=Ic.K(ld);pa(Kd)&&Fb.add(Kd)}}return Fb}jDj(pa,Fb){let Mb=null;({value:Mb}=this.eFa.Ec(pa.Zc,Mb)).returnValue?(pa.activity.zeg(Nm[Fb]),Mb.remove(pa.Vj),Mb.count||this.eFa.remove(pa.Zc)):l.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",
pa.Zc,Fb)}ksg(pa){this.jDj(pa,1)}nsg(pa){this.jDj(pa,0)}lOl(pa,Fb){if(!this.eFa.mb(pa))return!1;pa=this.eFa.K(pa);if(!pa.mb(Fb))return!1;for(var Mb=pa.K(Fb);Mb;){Mb=Mb.I4;if(Mb===Fb)return!0;if(!pa.mb(Mb))break;Mb=pa.K(Mb)}return!1}}Object(f.a)(Ej,"RttDataStore",null,[831,832]);var wl=d(283),rl=d(40),ug=d(271),Yk=d(199),te=d(13),Un=d(58);class Wh{constructor(pa,Fb){this.Jme=(Mb,Ic)=>{4===this.Do.opType?l.ULS.shipAssertTag(9204866,355,12===Ic.node.type||11===Ic.node.type,"Unexpected graph modification detected during RTT edit"):
l.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.Tvb=()=>{l.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")};this.vlj=()=>{l.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.Do=pa;if(this.Lm=Fb)pa=this.Lm.jf(12),pa.wt(this.Jme),pa.ly(this.Tvb),pa.ro(this.vlj)}dispose(){if(this.Lm){const pa=this.Lm.jf(12);pa.vS(this.Jme);pa.bva(this.Tvb);pa.XP(this.vlj)}}}Object(f.a)(Wh,
"GraphChangeValidator",null,[11]);class cj{constructor(pa,Fb,Mb,Ic){this.id=pa;this.cpBegin=Fb;this.cpEnd=Mb;this.gpl=Ic}XFp(pa){var Fb=this.id===pa.id;Fb&&(Fb=this.gpl.replace("\u00a0"," "),pa=pa.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),Fb=Fb===pa);return Fb}}Object(f.a)(cj,"RttOpValidator",null,[881]);class Kf{constructor(pa,Fb){this.W$=this.EBc=this.activity=null;this.opType=pa;this.metadata=Fb}$Of(){return""}serialize(){return null}}Object(f.a)(Kf,"RttOp",
null,[854]);class nf extends Kf{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf){super(Bf,Ye);this.Zc=pa;this.Vj=Fb;this.eV=Mb;this.f8=Ic;this.I4=ld;this.Uzb=Kd;this.SJ=ue}Wai(){return this.eV.isEqual(this.f8,!0)?new He.a(0,this.Zc,this.Vj,this.eV,void 0,void 0,void 0,this.SJ):new He.a(1,this.Zc,this.Vj,this.eV,this.Zc,this.Vj,this.f8,this.SJ)}static Z3j(pa){let Fb,Mb;var Ic=pa.JW;if(1===Ic.jte&&(Ic.fZa!==Ic.$Ma||Ic.nfb!==Ic.Mzc))return l.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),
Mb=Fb=null,pa=Ic=-1,{returnValue:!1,eV:Mb,f8:Fb,Zc:pa,Vj:Ic};if(Ic.SJ)return Mb=Fb=null,pa=Ic=-1,{returnValue:!1,eV:Mb,f8:Fb,Zc:pa,Vj:Ic};Fb=Mb=Ic.eV;1===Ic.jte&&(Fb=Ic.f8);pa=Ic.fZa;Ic=Ic.nfb;return{returnValue:!0,eV:Mb,f8:Fb,Zc:pa,Vj:Ic}}}Object(f.a)(nf,"RttReplaceRangeOp",Kf,[]);var bg=d(1285),Qg=d(462),ob=d(996),Lb=d(512),fc=d(448);class Jc extends Lb.a{constructor(){super();this.RttStatusRecords=this.FileId=null}en(){return fc.a.ZLo}static Qea(pa,Fb){const Mb=new Jc;Mb.FileId=pa;Mb.RttStatusRecords=
Fb;return Mb}}Object(f.a)(Jc,"RttStatusRequest",Lb.a,[]);class Tc{}Object(f.a)(Tc,"RttStatusOp",null,[]);class qd{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(f.a)(qd,"WireRttStatusOpRecord",null,[]);class Wc extends Qg.a{constructor(){super();this.eac=new R.a;this.r7e=new R.a;this.ll=new bg.a(m.AFrameworkApplication.J.fc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=
1;Kh.a.U0.register(this)}Ojk(){const pa=Date.now();for(const Fb of this.eac)Fb.oXb&&1===Fb.oXb&&(Fb.oXb=2,Fb.timeToRender=pa-Fb.metadata.OIg)}qHe(pa){const Fb=new Tc;Fb.metadata=pa.operation.metadata;Fb.opType=pa.opType;Fb.oXb=1;this.eac.add(Fb)}get Hma(){return"RttStatusReplicator"}dba(){return this.le&&this.le.status===ob.a.xS?!0:1===this.enabled&&this.ll.S_()?this.pH():!1}pH(){for(const pa of this.eac)if(pa.oXb&&2===pa.oXb)return!0;return!1}CNa(){if(1===this._state){this._state=3;const Fb=this.eac.toArray().filter(Mb=>
2===Mb.oXb);var pa=this.$Fl(Fb);pa=Jc.Qea(m.AFrameworkApplication.rootQuerySignature,pa);Fb.forEach(Mb=>this.eac.remove(Mb));Fb.forEach(Mb=>this.r7e.add(Mb));this.le.Zq=pa;this.le.RE="RttStatusRequest";this.le.status=ob.a.DH}else 3===this._state&&this.le&&this.le.status===ob.a.xS&&(this.ll.R4(),2!==this.le.statusCode&&this.eac.wD(0,this.r7e),this.r7e.clear(),this._state=1)}$Fl(pa){const Fb=[];pa.forEach(Mb=>{const Ic=new qd;Ic.clientId=Mb.metadata.clientId;Ic.clientType=Mb.metadata.clientType;Ic.packetId=
Mb.metadata.packetId;Ic.packetVersion=Mb.metadata.packetVersion;Ic.strictlySequentialId=Mb.metadata.strictlySequentialId;Ic.contentType=Mb.opType;Ic.contentState=Mb.oXb;Ic.timeToRender=Mb.timeToRender;Fb.push(Ic)});return Fb}N0b(){return!0}RA(){}jD(){}}Object(f.a)(Wc,"RttStatusReplicator",Qg.a,[]);class Zd{constructor(pa,Fb,Mb,Ic,ld,Kd){this.packetId=pa;this.clientId=Fb;this.clientType=Mb;this.OIg=Ic;this.packetVersion=ld;this.strictlySequentialId=Kd}static create(pa){let Fb=null;null!=pa.strictlySequentialId&&
(Fb=pa.strictlySequentialId);return new Zd(pa.packetId,pa.clientId,pa.client,Date.now(),pa.version,Fb)}}Object(f.a)(Zd,"RttOpMetadata",null,[]);class ie extends Kf{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf){super(4,Bf);this.I4=0;this.Zc=pa;this.Vj=Fb;this.offset=Mb;this.SJ=Ic;this.qPg=ld;this.tIg=Kd;this.SGe=ue;this.uIg=Ye;this.qPg===this.Zc?this.I4=this.tIg:this.SGe===this.Zc?this.I4=this.uIg:(l.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.I4=0)}Yfc(){return this.Zc===
this.SGe}get wlp(){return this.I4}get PJp(){return this.Yfc()?this.qPg:this.SGe}get J0j(){return this.Yfc()?this.tIg:this.uIg}serialize(){const pa=new He.a(3,this.Zc,this.Vj,this.offset,null,null,null,this.SJ),Fb=new $c(this.qPg,this.tIg,this.SGe,this.uIg);return new rb(this.metadata.packetId,this.metadata.clientId,1,4,pa,null,void 0,void 0,void 0,void 0,Fb,void 0,void 0,this.metadata.strictlySequentialId)}static create(pa){const Fb=pa.JW,Mb=pa.j1b;return new ie(Fb.fZa,Fb.nfb,Fb.eV,Fb.SJ,Mb.sjg,Mb.sIg,
Mb.tjg,Mb.vIg,Zd.create(pa))}static wKm(pa,Fb,Mb){if(1!==pa.type)return null;const Ic=Mb.mZa(pa.g8.characterData,pa.g8.ra);return new ie(pa.g8.Zc,pa.g8.Vj,Mb.$Bc(Ic,pa.rXj),pa.SJ,pa.WJb.Zc,pa.WJb.Vj,pa.fUc.Zc,pa.fUc.Vj,Fb)}}Object(f.a)(ie,"RttSplitParagraphOp",Kf,[829,854]);class vf{constructor(pa,Fb,Mb,Ic){this.iXn=()=>{this.aIb.Ojk()};this.Ooa=pa;this.LMc=Fb;this.ypa=Mb;this.aJb=Ic;null!=m.AFrameworkApplication.J&&m.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",
!1)&&(this.aIb=new Wc,wl.a.instance.lPh(this.iXn))}I9k(pa,Fb,Mb,Ic=null){if(Fb.isDirty)return Ic&&Ic.properties.W(vf.Lrj,"1"),!1;const ld=new Wh(pa,Fb.qk);try{if(1===pa.opType||6===pa.opType){const Ye=Object(z.a)(nf,pa),Bf=this.BBl(Ye,Fb);var Kd=Bf.node.characterData;const Fg=10<=Bf.cpBegin?Bf.cpBegin-10:0;let ah=Bf.cpEnd+10<=Kd.length?Bf.cpEnd+10:Kd.length;const Rg=Kd.substr(Fg,Bf.cpBegin-Fg),Dh=Kd.substr(Bf.cpEnd,ah-Bf.cpEnd);ah=ah+Ye.Uzb.length-(Bf.cpEnd-Bf.cpBegin);var ue=new cj(Bf.node.id,Fg,
ah,Rg+Ye.Uzb+Dh);const ej=6===Ye.opType;Kd="";ej&&(Kd=Ye.font);if(!this.PFo(Bf,Ye.Uzb,ej,Kd,Ic))return!1;let ak;ak=1===pa.opType?new km(Ye,Fb.id):new sk(Ye,Fb.id);Fb.bsa=pa.I4;Ye.EBc=ue;pa.W$=ak;Mb.zgg(ak);null!=this.aIb&&this.aIb.qHe(ak)}else return 4===pa.opType?this.H9k(pa,Fb,Mb):!1}finally{ld&&ld.dispose()}return!0}H9k(pa,Fb,Mb){const Ic=Object(z.a)(ie,pa);var ld=this.aJb.mZa(Fb.characterData,Fb.ra);ld=this.aJb.FMb(ld,Ic.offset);if(!this.T1i(fb.a.createTextRange(Fb,0,eb.ParagraphReader.textLength(Fb))))return!1;
var Kd=hf.a.Za(Fb);Kd.vb(10);if(this.lfe(Kd))return!1;let ue;Kd=this.ypa.Lc(3);try{Kd.Ab(Fb);const Ye=Fb.S0();try{const Bf=hf.a.Za(Fb);Bf.vb(10);Bf.fd(11);let Fg=Bf.currentNode;Ic.Yfc()&&(Bf.iZf?Fg=null:(Bf.bK(),Fg=Bf.currentNode));Bf.rc();const ah=this.LMc.tob();Bf.eK(ah,Fg,89);Bf.Yj(ah);ue=Fb.clone();const Rg=ue.S0();try{ue.setValue(jg.a.Zc,Ic.PJp);ue.setValue(jg.a.Vj,Ic.J0j);ue.isDirty=!1;Bf.Wf(ue,2);Bf.Yj(ue);this.xDl(Fb,ue);const Dh=Ic.Yfc()?ue:Fb,ej=Ic.Yfc()?Fb:ue;Dh.dR=!0;ej.dR=!0;this.Ooa.eug(this.aJa(Dh,
ld,eb.ParagraphReader.textLength(Dh)),"",!1,"");this.Ooa.eug(this.aJa(ej,0,ld),"",!1,"");Fb.bsa=Ic.wlp;ue.bsa=Ic.J0j}finally{Rg&&Rg.dispose()}}finally{Ye&&Ye.dispose()}Kd.y_a()}finally{Kd&&Kd.dispose()}Fb=new jk(Ic,Fb.id,ue.id);pa.W$=Fb;Mb.zgg(Fb);null!=this.aIb&&this.aIb.qHe(Fb);return!0}lfe(pa){const Fb=new hf.a;Fb.kd(pa);Fb.fd(11);return rl.ListItemReader.Dg(Fb)?(l.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}p$l(pa,Fb,Mb){var Ic=Fb.irb(pa.Zc);if(Ic.equals(Fd.a.nil))return null;
Ic=Mb.Eb(Ic);if(!Ic||!eb.ParagraphReader.Vb(Ic)||!Ic.isConnected)return null;const ld=hf.a.Za(Ic);if(!ld.vb(23))return null;if(pa.pPg){pa=Fb.irb(pa.pPg);if(pa.equals(Fd.a.nil))return null;Mb=Mb.Eb(pa);if(!Mb||!eb.ParagraphReader.Vb(Mb)||!Mb.isConnected)return null;Mb=hf.a.Za(Mb);if(!Mb.vb(23))return null;Mb.fd(11);Mb.bK();Mb.$d();if(Mb.currentNode!==Ic)return null}return this.lfe(ld)?null:ld}crp(pa,Fb,Mb,Ic){const ld=Fb.currentNode,Kd=this.ypa.Lc(3);try{Kd.Ab(ld);Fb.fd(11);const ue=Fb.currentNode;
Fb.rc();const Ye=this.LMc.tob();Fb.eK(Ye,ue,89);Fb.Yj(Ye);const Bf=ug.a.instance.createInstance(Un.a.paragraphNode),Fg=Bf.S0();try{Bf.setValue(te.a.Yn,""),Bf.HLa=!0,Ic.BZb(Bf),Ic=[0],Bf.setValue(jg.a.Mq,Ic),Bf.setValue(jg.a.Ot,Ic),Bf.HLa=!1,Bf.setValue(jg.a.Zc,pa.dcg),Bf.setValue(jg.a.Vj,pa.ccg),Bf.isDirty=!1,Fb.Wf(Bf,2),Bf.dR=!0,Bf.bsa=pa.ccg}finally{Fg&&Fg.dispose()}Kd.y_a();pa.W$=new Mm(pa,Bf.id);Mb.zgg(pa.W$);null!=this.aIb&&this.aIb.qHe(pa.W$)}finally{Kd&&Kd.dispose()}return!0}aJa(pa,Fb,Mb){return Fb===
Mb?fb.a.Tc(pa,Fb):fb.a.createTextRange(pa,Fb,Mb)}PFo(pa,Fb,Mb,Ic,ld=null){const Kd=pa.node;if(pa.cpBegin!==pa.cpEnd&&!this.T1i(pa))return ld&&ld.properties.W(vf.Y5j,"1"),!1;ld=this.ypa.Lc(3);try{ld.Ab(Kd);const ue=Kd.S0();try{Kd.dR=!0,this.Ooa.eug(pa,Fb,Mb,Ic)}finally{ue&&ue.dispose()}ld.y_a()}finally{ld&&ld.dispose()}return!0}xDl(pa,Fb){Fb.HLa=!0;Fb.vva(pa.characterData);Fb.bsa=pa.bsa;Fb.ra.clear();for(var Mb=0;Mb<pa.ra.length;Mb++){const Ic=pa.ra.K(Mb).ora(Fb);Fb.ra.add(Ic)}Fb.Ql();if(Fb.qe.length)for(pa=
0;pa<Fb.ra.length;pa++){if((Mb=Fb.ra.K(pa).formatting)&&-1!==Mb.te)for(;Fb.qe.length<=Mb.te;)Fb.qe.DX(Fb.qe.length-1,256)}else l.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");Fb.HLa=!1}o2f(pa){pa=hf.a.Za(pa);pa.vb(23);pa.rc();return{returnValue:89===pa.role,iterator:pa}}Xsg(pa){const Fb=new hf.a;Fb.kd(pa);Fb.rc();const Mb=this.ypa.Lc(3);try{Mb.Ab(Fb.currentNode),pa.Tg()}finally{Mb&&Mb.dispose()}}Wzo(pa){if(pa.anchor)if(({iterator:Fb}=this.o2f(pa)).returnValue)this.Xsg(Fb);
else{var Fb=pa.Ic.Am;var Mb=this.ypa.Lc(3);try{Mb.Ab(pa),pa.load(Object(Yk.d)(Fb).Eb(pa.id)),pa.anchor.f0(4)}finally{Mb&&Mb.dispose()}}}Rvg(pa,Fb,Mb){for(let Kd=Fb.count-1;0<=Kd;Kd--){var Ic=Fb.K(Kd);switch(Ic.opType){case 4:Ic=Object(z.a)(jk,Ic);if(!pa.id.equals(Ic.yAe)){l.ULS.shipAssertTag(9204885,355,pa.id.equals(Ic.mYc));continue}Ic=Mb.Eb(Ic.mYc);if(!Ic)break;if(!Ic||!eb.ParagraphReader.Vb(Ic)){l.ULS.shipAssertTag(9204886,355,!1);break}if(!Ic.isConnected)continue;var ld=({iterator:Ic}=this.o2f(Ic)).returnValue;
l.ULS.shipAssertTag(9204887,355,ld);ld&&this.Xsg(Ic);break;case 2:(Ic=Object(z.a)(Mm,Ic),pa.id.equals(Ic.paragraphId))?pa.isConnected&&(ld=({iterator:Ic}=this.o2f(pa)).returnValue,l.ULS.shipAssertTag(16820002,355,ld),ld&&this.Xsg(Ic)):l.ULS.shipAssertTag(16820001,355,!1)}}}BBl(pa,Fb){const Mb=this.aJb.mZa(Fb.characterData,Fb.ra),Ic=this.aJb.FMb(Mb,pa.eV);pa=this.aJb.FMb(Mb,pa.f8);return Ic===pa?fb.a.Tc(Fb,Ic):fb.a.createTextRange(Fb,Ic,pa)}T1i(pa){const Fb=pa.node.ra,Mb=pa.cpBegin;pa=pa.cpEnd;for(let Ic=
0;Ic<Fb.length;Ic++){const ld=Fb.K(Ic);if(ld.cp>=pa)break;if(ld.cp>=Mb){if(ld.mf)return l.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(ld.blob)return l.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(ld.nc||ld.ZTb||ld.hoc)return l.ULS.sendTraceTag(8242649,355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}vf.Lrj="ParagraphAlreadyDirty";vf.Y5j="UnsafeWetChange";Object(f.a)(vf,"RttEditor",null,
[833]);var vg=d(17),Ch=d(1328),ek=d(254);class dj{constructor(){this.wwd=new R.a}add(pa){this.wwd.add(pa);return!0}T7d(pa){const Fb=new R.a;for(const Mb of this.wwd)pa(Mb)&&Fb.add(Mb);return Fb}ksg(pa){pa.activity.zeg("dried");this.wwd.remove(pa)}nsg(pa){pa.activity.zeg("expired");this.wwd.remove(pa)}}Object(f.a)(dj,"RttAddParagraphDataStore",null,[]);class Cd extends Kf{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye){super(2,Ye);this.Zc=pa;this.Vj=Fb;this.I4=Mb;this.pPg=Ic;this.dcg=ld;this.ccg=Kd;this.SJ=ue}serialize(){const pa=
new He.a(2,this.Zc,this.Vj,null,this.pPg,null,null,this.SJ),Fb=new rc(this.I4,this.dcg,this.ccg);return new rb(this.metadata.packetId,this.metadata.clientId,1,3,pa,null,void 0,void 0,Fb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(pa){const Fb=pa.JW,Mb=pa.Mcc;let Ic=null;null!=pa.JW.$Ma&&(Ic=pa.JW.$Ma);return new Cd(Fb.fZa,Fb.nfb,Mb.wIg,Ic,Mb.vjg,Mb.I4,Fb.SJ,Zd.create(pa))}static sKm(pa,Fb){return 3!==pa.type?null:new Cd(pa.qua.Zc,pa.qua.Vj,pa.BSn.Vj,pa.JYa?pa.JYa.Zc:
null,pa.KCa.Zc,pa.KCa.Vj,pa.SJ,Fb)}}Object(f.a)(Cd,"RttAddParagraphOp",Kf,[]);class gh{constructor(pa){this.PY=pa}Pzj(){this.PY&&this.PY.properties.W(gh.Umi,"1")}qro(pa){this.PY&&(this.PY.properties.mb(gh.r$f)||this.PY.properties.W(gh.r$f,(pa-this.PY.startTime).toString()))}zeg(pa){this.PY&&(this.PY.properties.W(gh.EEj,pa),this.PY.end())}Qso(pa){this.PY&&this.PY.properties.W(gh.Pqj,pa.toString())}Oso(pa){this.PY&&this.PY.properties.W(gh.jqj,pa)}static dVf(pa){pa.F8(jj.a.o_b,gh.Umi,Ch.a.NZj);pa.F8(jj.a.o_b,
gh.U6l,Ch.a.NZj);pa.F8(jj.a.o_b,gh.r$f,Ch.a.Gcl);pa.F8(jj.a.o_b,gh.EEj,Ch.a.Nza);pa.F8(jj.a.o_b,gh.Pqj,Ch.a.Nza);pa.F8(jj.a.o_b,gh.jqj,Ch.a.Nza)}static create(pa){if(!pa)return null;pa=pa.wq(jj.a.o_b,gh.xIp);return new gh(pa)}}gh.Umi="FailedToFindInitialParaID";gh.U6l="FailedToFindInitialTextID";gh.r$f="MsecUntilApplied";gh.EEj="RemovedBecause";gh.Pqj="PacketVersions";gh.jqj="OperationType";gh.xIp=48E4;Object(f.a)(gh,"RttOpActivity",null,[]);var Xe;(function(pa){pa[pa.unknown=0]="unknown";pa[pa.Rkq=
1]="replaceTextRangeOp";pa[pa.oVp=2]="addParagraphOp";pa[pa.p_p=3]="deleteParagraphOp";pa[pa.mpq=4]="splitParagraphOp";pa[pa.B$p=5]="mergeParagraphOp";pa[pa.Qkq=6]="replaceSymbolRangeOp"})(Xe||(Xe={}));Object(f.b)("RttOpType",Xe);var xh=d(103);class Pj extends nf{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf,Fg,ah){super(Ic,ld,Kd,ue,Ye,Bf,Fg,ah,6);this.font=pa;this.ZAn=Fb}$Of(){return"OffsetStart: "+this.eV+"OffsetEnd: "+this.f8}serialize(){const pa=this.Wai();return new rb(this.metadata.packetId,this.metadata.clientId,
1,7,pa,null,this.I4,this.Uzb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(pa){let Fb,Mb,Ic,ld;if(!({eV:Fb,f8:Mb,Zc:Ic,Vj:ld}=nf.Z3j(pa)).returnValue)return null;let Kd,ue;if(1===pa.text.length)Kd=!1,ue=xh.AParagraphNode.YB;else if(2===pa.text.length)if(Bb.a.aZi(pa.text,0)&&Bb.a.bB(pa.text,1))Kd=!0,ue=pa.text;else return l.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",pa.operationType),null;else return l.ULS.sendTraceTag(8914773,
355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",pa.operationType),null;const Ye=pa.Zqd,Bf=Zd.create(pa);return new Pj(Ye.WGg,Ye.XGg,Kd,Ic,ld,Fb,Mb,pa.R1b,ue,pa.JW.SJ,Bf)}}Object(f.a)(Pj,"RttReplaceSymbolRangeOp",nf,[829,854]);class tj extends nf{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye){super(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,1)}$Of(){return"OffsetStart: "+this.eV+"OffsetEnd: "+this.f8+"TextAddedLength: "+this.Uzb.length}serialize(){const pa=this.Wai();return new rb(this.metadata.packetId,
this.metadata.clientId,1,2,pa,null,this.I4,this.Uzb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(pa){let Fb,Mb,Ic,ld;if(!({eV:Fb,f8:Mb,Zc:Ic,Vj:ld}=nf.Z3j(pa)).returnValue)return null;let Kd="";pa.text&&(Kd=pa.text);const ue=Zd.create(pa);return new tj(Ic,ld,Fb,Mb,pa.R1b,Kd,pa.JW.SJ,ue)}static uJm(pa,Fb,Mb){if(pa.type)return null;const Ic=Mb.mZa(pa.g8.characterData,pa.g8.ra);return new tj(pa.g8.Zc,pa.g8.Vj,Mb.$Bc(Ic,pa.cpBegin),Mb.$Bc(Ic,pa.cpEnd),pa.KCa.Vj,
pa.Oba,pa.SJ,Fb)}}Object(f.a)(tj,"RttReplaceTextRangeOp",nf,[829,854]);class Fj{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye,Bf,Fg,ah,Rg,Dh,ej,ak,df,dc,zc,je,Le,Ed){this.eA=Le;this.Eic=Ed;this.gl=null;this.oYe=this.RKh=!1;this.oAd=!0;this.Ewh=0;this.gEh=this.n8e=this.iEh=this.fEh=this.hEh=!1;this.fhg=()=>{l.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.gl=this.HO.result;l.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.gl.TO(this.nS)};this.nS=(rj,ad)=>
{if(3===ad.type||10===ad.type)if(10===ad.type)this.Ewh="boolean"===typeof ad.pA?ad.pA?1:0:ad.pA;else{if(sa.a.Lna){if(sa.a.Fk&&sa.a.Fk.Trb){l.ULS.sendTraceTag(508351552,355,15,"RTT channel did not get disconnected on lock release");return}}else if(this.q9b.value&&!this.q9b.value.Trb){l.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");return}if(!ad.pA)l.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty");else if(!this.Eic||2!==this.eA.Et)if(this.cto(),(rj=
this.FSl(ad.pA))&&1!==rj.metadata.clientType&&(this.bto(),(!this.Hp||this.Hp.xba||vg.a.Zsb||vg.a.bS||vg.a.Zsb||vg.a.bS)&&2!==this.Ewh))switch(this.oAd&&(this.dac.$zj(),this.oAd=!1),this.RKh||this.s8m(),rj.opType){case 1:case 6:case 4:if(!({Qg:rj}=this.bWk(rj)).returnValue)break;this.$Hh?this.vKj(rj):this.$4j(rj);break;case 2:this.BDc.add(rj),this.uRi(rj),this.$Hh?this.vKj(Fd.a.nil):this.Z4j(rj)}}};this.E5l=()=>{const rj=this.Fi.value;if(rj){var ad=this.mF()-Fj.hAo,$f=this.WCb.T7d(Wg=>Wg.metadata.OIg<
ad);0<$f.count&&this.rro();var dg=new ek.a;for(const Wg of $f)if(this.WCb.nsg(Wg),Wg.W$)switch(Wg.W$.opType){case 1:dg.add(Wg.W$.paragraphId.toString());break;case 6:dg.add(Wg.W$.paragraphId.toString());break;case 4:dg.add(Wg.W$.yAe.toString()),dg.add(Wg.W$.mYc.toString())}$f=this.BDc.T7d(Wg=>Wg.metadata.OIg<ad);for(const Wg of $f)this.BDc.nsg(Wg),Wg.W$&&dg.add(Wg.W$.paragraphId.toString());for(const Wg of dg)(dg=rj.Eb(Fd.a.Af(Wg)))?dg.dR?(this.$Hb.Wzo(dg),dg.dR||this.mLc.value.UDj(dg)):l.ULS.sendTraceTag(8765829,
355,15,"Expiring wet change from paragraph with no applied changes"):l.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.Fi.WSf&&l.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.$Hb=pa;this.WCb=Fb;this.mLc=Mb;this.q9b=Ic;this.cL=ld;this.HO=Kd;this.Fi=ue;this.Gb=Ye;this.mF=Bf;this.aJb=Fg;this.yd=ah;this.O4e=Dh;this.Qc=ej;this.$Hh=ak;this.dac=df;this.OBb=dc;this.rdf=zc;this.DNc=new C.a(H.a.vh());this.BDc=
new dj;Rg.execute(Fj.dVf);this.Hp=je}s8m(){const pa=new za.a(3,2,Fj.qCo,this.E5l);this.Gb.Yb(pa);this.RKh=!0}init(){return this.HO?this.HO.continueWith(this.fhg):F.Task.j7(!1)}FSl(pa){pa=hg(pa);if(!pa)return null;switch(pa.operationType){case 2:return tj.create(pa);case 7:return Pj.create(pa);case 4:return ie.create(pa);case 3:return Cd.create(pa);default:return l.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",pa.operationType),null}}bWk(pa){let Fb=Fd.a.nil;if(!this.WCb.aWk(pa))return{returnValue:!1,
Qg:Fb};this.uRi(pa);if(!this.cL)return{returnValue:!1,Qg:Fb};const Mb=this.cL.irb(pa.Zc);if(Mb.equals(Fd.a.nil)||!this.Fi.value.Eb(Mb))return pa.activity.Pzj(),{returnValue:!1,Qg:Fb};this.bAj();return{returnValue:!0,Qg:Mb}}vKj(pa){pa.equals(Fd.a.nil)||this.DNc.add(pa.toString());this.oYe||(pa=new za.a(0,1,200,()=>{this.btp();this.oYe=!1},71),this.Gb.Yb(pa),this.oYe=!0)}eOo(pa){pa=new za.a(0,1,0,pa,71);this.Gb.Yb(pa)}uRi(pa){pa.activity=gh.create(this.yd);pa.activity.Qso(pa.metadata.packetVersion);
pa.activity.Oso(Xe[pa.opType])}btp(){var pa=this.BDc.T7d(Mb=>!Mb.W$);for(const Mb of pa)this.Z4j(Mb);if(this.DNc.count){pa=null;for(var Fb of this.DNc){Fb=Fd.a.Af(Fb);pa=this.Fi.value.Eb(Fb);break}Fb=this.Qc.Lc(3);try{Fb.Ab(pa);for(const Mb of this.DNc)this.$4j(Fd.a.Af(Mb))}finally{Fb&&Fb.dispose()}this.DNc.clear()}}$4j(pa){pa=this.Fi.value.Eb(pa);let Fb;const Mb=this.Qc.Lc(3);try{Mb.Ab(pa);Fb=this.yd.wq(jj.a.uTh);const Ic=this.zTh(pa,Fb);Fb.end();Ic&&this.EZk(Ic)}finally{Mb&&Mb.dispose(),this.dac.Fqg(1),
this.oAd=!0}}Z4j(pa){var Fb=this.$Hb.p$l(pa,this.cL,this.Fi.value);Fb&&(this.bAj(),this.$Hb.crp(pa,Fb,this.OBb,Ha.a.instance.resolve(349))&&(Fb=this.Fi.value.Eb(pa.W$.paragraphId),this.STh(Fb,pa),this.dac.Fqg(1),this.oAd=!0))}EZk(pa){this.O4e.continueWith(()=>{if(1===pa.opType){var Fb=this.wHm(pa);Fb&&(this.O4e.result.gff(Fb),this.O4e.result.tue(!0))}})}wHm(pa){const Fb=pa.serialize();if(2!==Fb.operationType||Fb.JW.$Ma&&Fb.JW.fZa!==Fb.JW.$Ma)return null;const Mb=pa.eV.clone();0<pa.Uzb.length&&(Mb.n3h(),
Mb.cp+=pa.Uzb.length);Fb.operationType=0;Fb.text=null;Fb.JW.jte=0;Fb.JW.eV=Mb;Fb.JW.nfb=Fb.R1b;Fb.JW.$Ma=null;Fb.JW.Mzc=null;Fb.JW.f8=null;Fb.R1b=null;return Rf.ttf(Fb,this.cL,this.aJb,()=>this.Fi.value,this.rdf.instance)}STh(pa,Fb){return this.mLc.value?this.mLc.value.KUk(pa,Fb.metadata.clientId).returnValue?!0:(l.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(l.ULS.shipAssertTag(7866378,355,!!this.mLc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}yTh(pa,
Fb){this.zTh(pa,Fb)}zTh(pa,Fb){if(!pa)return null;if(!pa.anchor)return Fb&&Fb.properties.W(Fj.Ahj,"1"),null;if(!pa.hasProperty(jg.a.Zc))return l.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),null;if(!pa.hasProperty(jg.a.Vj))return l.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(pa.hasProperty(jg.a.pgi)&&pa.getValue(jg.a.pgi))return l.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const Mb=pa.getValue(jg.a.Zc);
var Ic=pa.bsa;Fb&&(Fb.properties.W(Fj.BTn,Ic.toString()),Fb.properties.W(Fj.DTn,Mb.toString()));Ic=this.WCb.bMf(Mb,Ic);if(!Ic)return Fb&&Fb.properties.W(Fj.ohj,"1"),null;if(!this.STh(pa,Ic))return Fb&&Fb.properties.W(Fj.S8h,"1"),null;let ld=0,Kd=null;for(;Ic;){if(!this.$Hb.I9k(Ic,pa,this.OBb,Fb)){Fb&&Fb.properties.W(Fj.Rbk,"1");break}ld++;Ic.activity.qro(this.mF());Kd=Ic;Ic=pa.bsa;Ic=this.WCb.bMf(Mb,Ic)}0<ld&&this.Czj();Fb&&Fb.properties.add(Fj.Sbk,ld.toString());return Kd}Yte(pa){if(pa.hasProperty(jg.a.Zc)&&
pa.hasProperty(jg.a.Vj)){var Fb=pa.getValue(jg.a.Zc),Mb=pa.ka(jg.a.Vj,0),Ic=this.yd.wq(jj.a.ZBj),ld=this.OBb.j0n(pa.id);0<ld.count&&(this.$Hb.Rvg(pa,ld,this.Fi.value),this.EAo(pa,ld,Mb));var Kd=this.OBb.Ehm(Fb);if(Kd&&!pa.id.equals(Kd.paragraphId)){const ue=this.Fi.value;this.eOo(()=>{const Ye=this.OBb.Tvb(Kd.paragraphId),Bf=ue.Eb(Kd.paragraphId);l.ULS.shipAssertTag(16820032,355,!!Bf,"Could not find added graph node");Bf&&(this.$Hb.Rvg(Bf,Ye,ue),this.BDc.ksg(Kd.hff))})}this.WCb.bMf(Fb,Mb)||this.mLc.value.UDj(pa);
this.yTh(pa,Ic);Ic.end()}}EAo(pa,Fb,Mb){let Ic=!1;for(let Kd=Fb.count-1;0<=Kd;Kd--){var ld=Fb.K(Kd);switch(ld.opType){case 1:case 6:case 4:ld=Object(z.a)(829,ld.operation);break;default:continue}ld.I4===Mb&&(Ic=!0,ld.EBc&&!ld.EBc.XFp(pa)&&l.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",ld.opType,ld.$Of(),pa.id,ld.EBc.id,ld.EBc.cpBegin,ld.EBc.cpEnd));Ic&&this.WCb.ksg(ld)}Ic&&
this.Czj()}Cfd(pa){const Fb=this.OBb.Tvb(pa.id);0<Fb.count&&(2===Fb.K(0).opType&&Fb.removeAt(0),this.$Hb.Rvg(pa,Fb,this.Fi.value))}Rye(pa){var Fb=this.OBb.cEm(pa.id);for(const Mb of Fb)if(4===Mb.opType&&(Fb=Object(z.a)(jk,Mb),pa.id.equals(Fb.eUk)))return!0;return!1}cto(){this.hEh||(l.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.hEh=!0)}bto(){this.fEh||(l.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.fEh=!0)}bAj(){this.iEh||(l.ULS.sendTraceTag(17147533,
355,50,"Received a usable wet change"),this.iEh=!0)}Czj(){this.n8e||(l.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.n8e=!0)}rro(){this.n8e||this.gEh||(l.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this.gEh=!0)}static dVf(pa){const Fb=[jj.a.uTh,jj.a.ZBj];for(const Mb of Fb)pa.F8(Mb,Fj.Sbk,Ch.a.Nza),pa.F8(Mb,Fj.ohj,Ch.a.Nza),pa.F8(Mb,Fj.Ahj,Ch.a.Nza),pa.F8(Mb,Fj.S8h,Ch.a.Nza),pa.F8(Mb,Fj.Rbk,Ch.a.Nza),pa.F8(Mb,vf.Lrj,Ch.a.Nza),pa.F8(Mb,vf.Y5j,
Ch.a.Nza);gh.dVf(pa)}}Fj.qCo=6E4;Fj.hAo=18E4;Fj.Sbk="WetChangeCount";Fj.ohj="NoChangesToApply";Fj.Ahj="NodeNotConnected";Fj.S8h="CouldNotGetLock";Fj.Rbk="WetChangeBlocked";Fj.DTn="NodeWordId";Fj.BTn="NodeTextId";Object(f.a)(Fj,"RttManager",null,[830]);class lm{constructor(pa,Fb){this.bJj=0;this.sk=pa;this.YLo=Fb}$zj(){this.bJj=this.sk()}Fqg(pa){const Fb=this.sk()-this.bJj;0<=Fb&&this.YLo.track(Math.round(Fb),0===pa?"CTB":"RTP")}}Object(f.a)(lm,"RttPerfCounter",null,[828]);var Oa=d(2018);class cc{constructor(){this.iPc=
new Oa.a}i_k(pa,Fb){this.iPc.back()&&Fb&&this.iPc.back().f7a(pa)||this.iPc.enqueue(pa)}vCm(){return this.iPc.isEmpty?null:this.iPc.dequeue()}}Object(f.a)(cc,"RttSendDataStore",null,[827]);class Lc extends Kf{constructor(pa,Fb,Mb,Ic){super(3,Ic);this.Zc=pa;this.Vj=Fb;this.SJ=Mb}get I4(){return 0}serialize(){const pa=new He.a(4,this.Zc,this.Vj,null,null,null,null,this.SJ);return new rb(this.metadata.packetId,this.metadata.clientId,1,5,pa,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(pa){const Fb=
pa.JW;return new Lc(Fb.fZa,Fb.nfb,Fb.SJ,Zd.create(pa))}static tKm(pa,Fb){return 4!==pa.type?null:new Lc(pa.Ogc.Zc,pa.Ogc.Vj,pa.SJ,Fb)}}Object(f.a)(Lc,"RttDeleteParagraphOp",Kf,[829,854]);class rd extends Kf{constructor(pa,Fb,Mb,Ic,ld,Kd,ue,Ye){super(5,Ye);this.oPg=pa;this.I0j=Fb;this.OJp=Mb;this.xlp=Ic;this.SJ=ld;this.Gck=Kd;this.Nzc=ue}get Zc(){return this.oPg}get Vj(){return this.I0j}get I4(){return this.oPg===this.Gck?this.Nzc:0}serialize(){const pa=new He.a(5,this.oPg,this.I0j,null,this.OJp,this.xlp,
null,this.SJ),Fb=new yc(this.Gck,this.Nzc);return new rb(this.metadata.packetId,this.metadata.clientId,1,6,pa,null,void 0,void 0,void 0,Fb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(pa){const Fb=pa.JW,Mb=pa.Cdd;return new rd(Fb.fZa,Fb.nfb,Fb.$Ma,Fb.Mzc,Fb.SJ,Mb.ujg,Mb.Nzc,Zd.create(pa))}static uKm(pa,Fb){return 2!==pa.type?null:new rd(pa.qua.Zc,pa.qua.Vj,pa.JYa.Zc,pa.JYa.Vj,pa.SJ,pa.Lje.Zc,pa.Lje.Vj,Fb)}}Object(f.a)(rd,"RttMergeParagraphOp",Kf,[829,854]);class Oe{constructor(pa,
Fb,Mb,Ic,ld,Kd){this.NPc=this.Zh=null;this.Zia=!1;this.gbf=this.yIh=0;this.GNd=this.NJh=!1;this.q7e=0;this.fhg=()=>{l.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.Zh=this.HO.result;this.Zh.Ite(this)};this.Vmj=(ue,Ye)=>{if(this.Zh&&(m.AFrameworkApplication.nd("i100g733;fbhi3553"),!(m.AFrameworkApplication.J.getBooleanFeatureGate("StopRTTMessageWhenAlone",!1)&&this.hgn()||2!==this.Zh.connectionState)&&(ue=Ye.nH,ue.length)))if(Ye.eaa)100>this.gbf&&(this.gbf++,l.ULS.sendTraceTag(8270467,
355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",Ye.oel,this.yIh,this.gbf));else{for(Ye=0;Ye<ue.length;Ye++)if(!this.pwn(ue[Ye]))return;for(Ye=0;Ye<ue.length;Ye++){const Bf=ue[Ye];this.kDh.i_k(Bf,!Bf.type&&!Ye)}this.NPc||this.xmj(this.NPc,this.Zh)}};this.HO=pa;this.kDh=Fb;this.Fjb=Mb;this.Sy=Ic;this.Gya=ld;this.dac=Kd}get Ln(){return this.Fjb.value}init(){return this.HO?this.HO.continueWith(this.fhg):F.Task.j7(!1)}start(){this.Zia||(this.Sy.ed?(this.Sy.ed.nH.i3k(this.Vmj),
this.Zia=!0):l.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.Zia&&(this.Zia=!1,this.Sy.ed.nH.MDo(this.Vmj))}hgn(){return this.Ln&&this.Ln.nA.ZLa?!0:!1}pwn(pa){return pa&&-1!==pa.SJ?pa.type&&3!==pa.type&&1!==pa.type?!1:!0:!1}$Hn(){this.GNd||(this.NJh||(l.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.NJh=!0),!this.GNd&&5>=this.q7e&&this.q7e++)}nIn(){!this.GNd&&5>=this.q7e&&(l.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.GNd=
!0)}xmj(pa,Fb){this.$Hn();pa&&(pa.ij||pa.yp)&&l.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",pa.zk);this.dac.$zj();(pa=this.vKm(this.kDh.vCm()))?(this.yIh++,this.NPc=Fb.tC(3,ni(pa.serialize())),this.nIn(),this.dac.Fqg(0),this.NPc.continueWith(Mb=>{this.xmj(Mb,Fb)})):this.NPc=null}vKm(pa){if(!pa)return null;if(!this.Ln)return l.ULS.sendTraceTag(8245957,355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const Fb=new Zd(Vi.instance.JCi(),
this.Ln.Ej,1,0,0,pd.instance.MCm());let Mb=null;switch(pa.type){case 0:Mb=tj.uJm(pa,Fb,this.Gya);break;case 4:Mb=Lc.tKm(pa,Fb);break;case 3:Mb=Cd.sKm(pa,Fb);break;case 2:Mb=rd.uKm(pa,Fb);break;case 1:Mb=ie.wKm(pa,Fb,this.Gya)}return Mb}}Object(f.a)(Oe,"RttSendManager",null,[826]);class xd{constructor(){this.Z=null;this.lAm=()=>tb.a.vd()&&tb.a.vd().Fk?tb.a.vd().Fk:(l.ULS.sendTraceTag(7866377,304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}uc(pa){const Fb=
Wa.a.iq(pa.Ra(16)),Mb=Wa.a.iq(pa.Ra(23)),Ic=Wa.a.iq(pa.Ra(181)),ld=Wa.a.iq(pa.Ra(1235)),Kd=Wa.a.iq(pa.Ra(267));this.Z=pa;const ue=new Bk.a;F.Task.WAA.call(null,Fb,Mb,Ic,ld,Kd).continueWith(()=>{pa.ia(1656,()=>new vf(pa.resolve(323),pa.resolve(16),ue,pa.resolve(1235))).ha();pa.register(lm,"WordEditor.RttPerfCounter").as(1657).ha().Sd(()=>new lm(me.a.Le,co.a.jH(17,1,new fm.a(new Hk.a(.25)))));pa.ia(1658,()=>new Fj(pa.resolve(1656),new Ej(gn.a.instance),new V.a(this.lAm),new V.a(()=>sa.a.EV),pa.resolve(442),
pa.resolve(545).oD(),new V.a(()=>gb.StaticActiveAppFrame.za().kb&&gb.StaticActiveAppFrame.za().kb.ed?gb.StaticActiveAppFrame.za().kb.ed.ud:(l.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),Gb.a.instance,()=>Date.now(),pa.resolve(1235),gn.a.instance,pa.Ra(181),af.oD(),ue,m.AFrameworkApplication.J.$("WordEditorThrottleAndBatchRTTRendering"),pa.resolve(1657),new gm,pa.Ra(1644),pa.resolve(267),pa.resolve(76),pa.resolve(114).Eic)).as(684).ha();pa.ia(1659,()=>new Oe(pa.resolve(545).oD(),
new cc,new V.a(()=>tb.a.vd()),gb.StaticActiveAppFrame.za().kb,pa.resolve(1235),pa.resolve(1657))).ha();this.eVf()})}eVf(){this.Z.resolve(1658).init();this.Z.resolve(1659).init()}init(){}dispose(){}static main(){fa.a.instance.Mc(new xd)}}Object(f.a)(xd,"WordEditorRealTimeTypingPackage",null,[0,1]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");
Type.registerNamespace("WordEditor.Presence");null!=m.AFrameworkApplication.J&&m.AFrameworkApplication.J.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoadRtcFrom1JS",!1)?Promise.all([d.e(4),d.e(2),d.e(10)]).then(d.bind(null,2140)).then(pa=>pa.initRealtimechannel()):Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");Ma.main();Type.registerNamespace("Common.App.CollabControls");Ta.prototype.toString=wa.a.prototype.toString;kb.prototype.toString=wa.a.prototype.toString;
fa.a.instance.Mc(new vl);xd.main();Type.registerNamespace("RealtimePresenceUI");fa.a.instance.Mc(new ff);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");Aa.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/22809443/wdjs/WordEditorDSReduceInitialBundle.collab.js.map